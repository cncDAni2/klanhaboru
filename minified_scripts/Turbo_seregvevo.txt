if(void 0!==FENNTART)var dupla=!0;else dupla=!1;var FENNTART=0,MAXIDO=80,MAX_NYERS=new Array(0,0,0),LANDZSA=0,KARDOS=0,BARDOS=0,IJASZ=0,KEM=0,KL=0,IL=0,NL=0,KOS=0,KATA=0;dupla&&(init2(),exit(0));var worker=createWorker((function(e){e.addEventListener("message",(function(e){setTimeout((()=>{postMessage(e.data)}),e.data.time)}),!1)}));function createWorker(e){var t=new Blob(["("+e.toString()+")(self)"],{type:"text/javascript"});return new Worker(window.URL.createObjectURL(t))}function init2(){for(var e=document.getElementById("kik_divbox"),t=new Array(LANDZSA,KARDOS,BARDOS,IJASZ,KEM,KL,IL,NL,KOS,KATA,MAXIDO,FENNTART,MAX_NYERS[0],MAX_NYERS[1],MAX_NYERS[2]),r=0;r<t.length;r++)e.getElementsByTagName("input")[r].value=t[r]}function setLoadmask(e){document.getElementById("TTloadmask").innerHTML=e}function init(){$("body").append('<div style="background-color: white; background-image: url(\'https://raw.githubusercontent.com/cncDAni2/klanhaboru/main/images/Turbo_kikepzo.png\'); width:870px; color: #006; background-position:left top; background-repeat:no-repeat; position: absolute; right:0px; top:260px; border:3px solid blue; padding: 5px; z-index:200; margin-bottom: 50px;" id="kik_divbox"><div id="kik_boxhead"><br><br></div>\t<table style="padding: 0px; margin-left:25px; border: 0" id="kik_beall"><tr><td style="padding-right: 15px"></td><td style="padding-right: 15px"></td><td style="padding-right: 15px"></td><td style="padding-right: 15px"></td></tr></table>\t<input type="button" onclick="kikepzo_nyit()" value="1) Lapmegnyitás"> <input type="button" onclick="kikepzo_kepez()" value="2) Kiképzés"> <input type="button" onclick="kikepzo_zar()" value="3) Lapbezárás"> <img height="20px" src="https://raw.githubusercontent.com/cncDAni2/klanhaboru/main/images/kuka.png" title="Eredménytábla tartalmának ürítése" alt="Ürít" onclick="kik_urit()" style="cursor: pointer; cursor: hand;" >&nbsp;&nbsp;&nbsp;<p id="TTloadmask" style="display:inline;font-weight: bold;font-size: 125%;"></p>\t<table id="eredmeny" style="border: 1px solid black;" width="850px"><tr style="color: #0A0;text-shadow: 1px 1px 3px #0F0; font-weight:bold;"><td><a href="javascript: rendez(0)">No.</a></td><td>Falu</td><td><a href="javascript: rendez(2)">Képzés +</a></td><td><a href="javascript: rendez(3)">Képzés össz</a></td><td>Kiképzett sereg</td><td><a href="javascript: rendez(5)" style="width:300px">Eredmény</a></td></tr></table>\tC&amp;C Műhely ~ cncDAni2<div style="height: 50px; margin: 0 0 -50px 0; background:transparent;"></div>');for(var e=new Array(LANDZSA,KARDOS,BARDOS,IJASZ,KEM,KL,IL,NL,KOS,KATA),t=new Array("spear","sword","axe","archer","spy","light","marcher","heavy","ram","catapult"),r=document.getElementById("kik_beall").rows,n=0,a=0;a<e.length;a++)r[0].cells[n].innerHTML+='<img src="/graphic/unit/unit_'+t[a]+'.png"><input style="background-color: rgba(255,255,255,0.6)" type="text" size="4" value="'+e[a]+'"><br>',3!=a&&7!=a||n++;r[0].cells[3].innerHTML+='\t<img src="https://raw.githubusercontent.com/cncDAni2/klanhaboru/main/images/ora.png" alt="ido" title="Maximális kiképzési idő"><input style="background-color: rgba(255,255,255,0.6)" type="text" size="4" value="'+MAXIDO+'"><br> \t<img src="graphic/buildings/farm.png" title="Meghagyott tanyahely"><input style="background-color: rgba(255,255,255,0.6)" size="4" type="text" value="'+FENNTART+'"><br> \t<img src="graphic/holz.png" title="Meghagyott fa"><input style="background-color: rgba(255,255,255,0.6)" size="4" type="text" value="'+MAX_NYERS[0]+'"> \t<img src="graphic/lehm.png" title="Meghagyott agyag"><input style="background-color: rgba(255,255,255,0.6)" size="4" type="text" value="'+MAX_NYERS[1]+'"> \t<img src="graphic/eisen.png" title="Meghagyott vas"><input style="background-color: rgba(255,255,255,0.6)" size="4" type="text" value="'+MAX_NYERS[2]+'">'}function kik_urit(){try{if(!confirm("Az eredménytábla ürítésre fog kerülni.\nFolytatja?"))return;var e=document.getElementById("eredmeny");if(1==e.rows.length)return;for(;e.rows.length>1;)e.deleteRow(1);return}catch(e){alert("Ürítéskor:\n"+e)}}function openIt(e,t){worker.postMessage({index:e,row:t,time:150*e+150*Math.random()})}function kikepzo_nyit(){try{setLoadmask(""),REFARRAY=new Array;var e=document.getElementById("production_table"),t=document.getElementById("eredmeny"),r=0;SORDIFF=t.rows.length-1;for(var n=1;n<e.rows.length;n++)if("none"!=e.rows[n].style.display){openIt(r,n);var a=t.insertRow(-1),l=a.insertCell(0);l.innerHTML=SORDIFF+r,(l=a.insertCell(1)).innerHTML=e.rows[n].cells[0].getElementsByTagName("span")[0].innerHTML,(l=a.insertCell(2)).innerHTML="",(l=a.insertCell(3)).innerHTML="",(l=a.insertCell(4)).innerHTML="",(l=a.insertCell(5)).innerHTML="",r++}}catch(e){alert("Hiba megnyitáskor:\n"+e)}}function kikepzo_kepez1(e){try{for(var t=document.getElementById("kik_beall").getElementsByTagName("input"),r=0;r<t.length;r++)t[r].value=t[r].value.replace(/[^0-9]/g,""),""==t[r].value&&(t[r].value="0");MAXIDO=3600*parseInt(t[10].value,10),FENNTART=parseInt(t[11].value,10),MAX_NYERS[0]=parseInt(t[12].value,10),MAX_NYERS[1]=parseInt(t[13].value,10),MAX_NYERS[2]=parseInt(t[14].value,10);var n=REFARRAY[e],a=new Array,l=new Array,i=new Array("spear","sword","axe","archer","spy","light","marcher","heavy","ram","catapult");for(r=0;r<10;r++)a[r]=parseInt(t[r].value,10),a[r]>0?n.document.getElementById(i[r]+"_0")?l[r]=!0:l[r]=!1:l[r]=!0;var o=new Array(0,0,0,0,0,0,0,0,0,0),s=new Array(0,0,0,0,0,0,0,0,0,0),g=new Array("","","","","","","","","",""),d=new Array(1,1,1,1,2,4,5,6,5,8),c=new Array(n.game_data.village.wood-MAX_NYERS[0],n.game_data.village.stone-MAX_NYERS[1],n.game_data.village.iron-MAX_NYERS[2]),m=n.game_data.village.pop,p=n.game_data.village.pop_max,u=n.document.getElementById("train_form").getElementsByTagName("table")[0].rows,y=new Array(0,0,0,0,0,0,0,0,0,0),h=0,k="";for(r=1;r<u.length-1;r++){for(var f=0;f<i.length;f++)if(u[r].cells[0].getElementsByTagName("img")[0].src.indexOf("/"+i[f])>0){i[f];g[f]=$.trim(u[r].cells[0].textContent);break}k=u[r].cells[1].textContent.match(/[0-9]+/g);for(var b=0;b<k.length;b++)"0"!=k[b]&&(k[b]=k[b].replace(/^0/g,""));var A=3600*parseInt(k[k.length-3])+60*parseInt(k[k.length-2])+parseInt(k[k.length-1]);y[f]=A,o[f]=a[f],h=parseInt(u[r].cells[2].textContent.match(/[0-9]+/g)[1]),o[f]-=h}var v=new Array(0,0,0);if(n.document.getElementById("trainqueue_wrap_barracks")){var w=n.document.getElementById("trainqueue_wrap_barracks").getElementsByTagName("table")[0].rows;if(2==w.length)var I=2;else I=w.length-1;for(r=1;r<I;r++){for(b=0;b<=3;b++)w[r].cells[0].textContent.indexOf(g[b])>0&&(o[b]-=parseInt(w[r].cells[0].textContent.match(/[0-9]+/g)));k=w[r].cells[1].textContent.match(/[0-9]+/g);for(b=0;b<3;b++)"0"!=k[b]&&(k[b]=k[b].replace(/^0/g,""));v[0]+=3600*parseInt(k[0])+60*parseInt(k[1])+parseInt(k[2])}}if(w=n.document.getElementById("trainqueue_wrap_stable")){I=2==(w=n.document.getElementById("trainqueue_wrap_stable").getElementsByTagName("table")[0].rows).length?2:w.length-1;for(r=1;r<I;r++){for(b=4;b<=7;b++)w[r].cells[0].textContent.indexOf(g[b])>0&&(o[b]-=parseInt(w[r].cells[0].textContent.match(/[0-9]+/g)));k=w[r].cells[1].textContent.match(/[0-9]+/g);for(b=0;b<3;b++)"0"!=k[b]&&(k[b]=k[b].replace(/^0/g,""));v[1]+=3600*parseInt(k[0])+60*parseInt(k[1])+parseInt(k[2])}}if(w=n.document.getElementById("trainqueue_wrap_garage")){I=2==(w=n.document.getElementById("trainqueue_wrap_garage").getElementsByTagName("table")[0].rows).length?2:w.length-1;for(r=1;r<I;r++){for(b=8;b<=9;b++)w[r].cells[0].textContent.indexOf(g[b])>0&&(o[b]-=parseInt(w[r].cells[0].textContent.match(/[0-9]+/g)));k=w[r].cells[1].textContent.match(/[0-9]+/g);for(b=0;b<3;b++)"0"!=k[b]&&(k[b]=k[b].replace(/^0/g,""));v[2]+=3600*parseInt(k[0])+60*parseInt(k[1])+parseInt(k[2])}}for(var E=v.slice(0),x="Ismeretlen";;){var R=!0;if(o[0]<=0&&o[1]<=0&&o[2]<=0&&o[3]<=0?v[0]=-1:(R=!1,min=0),o[4]<=0&&o[5]<=0&&o[6]<=0&&o[7]<=0?v[1]=-1:(R=!1,min=1),o[8]<=0&&o[9]<=0?v[2]=-1:(R=!1,min=2),R){x="A beállított sereg 100%-a le van gyártva";break}R=!0;var _=new Array(!1,!1,!1);for(r=0;r<v.length;r++)v[r]>MAXIDO&&(_[r]=!0,v[r]),-1!=v[r]&&v[r]<v[min]&&(min=r);1==_[0]&&(o[0]=0,o[1]=0,o[2]=0,o[3]=0),1==_[1]&&(o[4]=0,o[5]=0,o[6]=0,o[7]=0),1==_[2]&&(o[8]=0,o[9]=0),R=!0;for(r=0;r<3;r++){if(1!=_[r]&&-1!=v[r]){R=!1;break}R=!0}if(R){x="Maximális kiképzési idő elérve";break}0==min?(also=0,felso=3):1==min?(also=4,felso=7):2==min&&(also=8,felso=9);for(var z="";""==z;){var M=Math.floor(Math.random()*(felso-also+.99)+also);o[M]>0&&(z=i[M])}if(m+d[M]>p-FENNTART){x="Megtelt a tanya: ("+m+")";break}m+=d[M];var T=new Array(0,0,0);for(r=1;r<u.length-1;r++)if(u[r].cells[0].innerHTML.indexOf(i[M])>0){T=new Array(parseInt($.trim(u[r].cells[1].textContent.match(/[0-9]+/g)[0])),parseInt($.trim(u[r].cells[1].textContent.match(/[0-9]+/g)[1])),parseInt($.trim(u[r].cells[1].textContent.match(/[0-9]+/g)[2])));break}if(0==T[0])throw"Nyers nem található";for(r=0;r<3;r++)c[r]-=T[r],c[r]<0&&(R=!0);if(R){x="Elfogyott a nyersanyag";break}s[M]++,o[M]--,v[min]+=y[M]}var N="";tech_img="";var B=new Array(0,0,0,0,0,0,0,0,0,0);for(r=0;r<s.length;r++)s[r]>0&&(n.document.getElementById(i[r]+"_0").value=s[r],N+=s[r]+'<img src="/graphic/unit/unit_'+i[r]+'.png"> ',B[r]=y[r]*s[r]),l[r]||(tech_img='<img src="/graphic/unit/unit_'+i[r]+'.png"> ');""!=tech_img&&(tech_img='<b style="font-size:200%; color:red;">!</b>'+tech_img),D=e,setTimeout((function(){REFARRAY[D].document.getElementById("train_form").getElementsByClassName("btn-recruit")[0].click(),D>=REFARRAY.length-1&&setLoadmask("Kiképzés elindítva")}),200*D+50*Math.random());var F=new Array(B[0]+B[1]+B[2]+B[3],B[4]+B[5]+B[6]+B[7],B[8]+B[9]),L=new Array(E[0]+F[0],E[1]+F[1],E[2]+F[2]),S=F[0],O=L[0];for(r=1;r<L.length;r++)S<F[r]&&(S=F[r]),O<L[r]&&(O=L[r]);document.getElementById("eredmeny").rows[SORDIFF+e+1].cells[2].innerHTML=(S/3600).toFixed(2)+" óra",document.getElementById("eredmeny").rows[SORDIFF+e+1].cells[3].innerHTML=(O/3600).toFixed(2)+" óra",document.getElementById("eredmeny").rows[SORDIFF+e+1].cells[4].innerHTML=tech_img+" "+N,document.getElementById("eredmeny").rows[SORDIFF+e+1].cells[5].innerHTML=x}catch(e){alert("Hiba kiképzés betevésekor:\n"+e)}var D}function kikepzo_kepez(){try{setLoadmask("Kiképzés folyamatban, kérem várjon...");for(var e=0;e<REFARRAY.length;e++){if(document.getElementById("eredmeny").rows.length<=SORDIFF+e+1)return void alert("Az eredménytáblába nincs hely, így nem tudom hova írni az adatokat. Kezdje az első lépéssel.");kikepzo_kepez1(e)}return}catch(e){alert("Hiba kiképzéskor:\n"+e)}}function kikepzo_zar(){try{setLoadmask("");for(var e=0;e<REFARRAY.length;e++)REFARRAY[e].close();return}catch(e){alert("Hiba lapbezáráskor:\n"+e)}}function rendez(e){try{var t=document.getElementById("eredmeny"),r=t.rows,n=new Array,a=new Array,l=new Array,i="szam";5==e&&(i="szoveg");for(var o=1;o<r.length-0;o++){switch(i){case"szoveg":n[o-1]=r[o].cells[e].innerText;break;case"szam":n[o-1]=parseFloat(r[o].cells[e].innerText.replace(" óra",""));break;default:return void alert("Nem értelmezhető mi szerint kéne rendezni.")}a[o-1]=r[o],l[o-1]=o-1}for(o=0;o<n.length;o++){for(var s=o,g=o;g<n.length;g++)n[g]<n[s]&&(s=g);var d=n[o];n[o]=n[s],n[s]=d;d=l[o];l[o]=l[s],l[s]=d}for(o=r.length-1;o>0;o--)t.deleteRow(o);for(o=0;o<n.length;o++)t.appendChild(a[l[o]]);return}catch(e){alert("Hiba rendezéskor:\n"+e)}}worker.onmessage=function(e){e=e.data,REFARRAY[e.index]=window.open(document.getElementById("production_table").rows[e.row].cells[0].getElementsByTagName("a")[0].href.replace("overview","train"),"kikepzo"+e.index)};var SORDIFF=0;init(),REFARRAY=[],$(document).ready((function(){$((function(){$("#kik_divbox").draggable({handle:$("#kik_boxhead")})}))}));

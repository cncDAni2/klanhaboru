function stop(){for(var e=setTimeout("",100),t=0;t<e;t++)clearTimeout(t)}function loadXMLDoc(e){return window.XMLHttpRequest?xhttp=new XMLHttpRequest:xhttp=new ActiveXObject("Microsoft.XMLHTTP"),xhttp.open("GET",e,!1),xhttp.send(),xhttp.responseXML}stop(),document.getElementsByTagName("html")[0].setAttribute("class",""),void 0!==AZON&&(alert("Itt már fut SZEM. \n Ha ez nem igaz, nyitsd meg új lapon a játékot, és próbáld meg ott futtatni"),exit());try{var VERZIO="4.5 Build 23.04.23",SZEM4_LOCAL_STORAGE="",AZON="S0";window.name.indexOf(AZON)>-1&&(AZON="S1");var BASE_URL=document.location.href.split("game.php")[0],CONFIG=loadXMLDoc(BASE_URL+"interface.php?func=get_config"),SPEED=parseFloat(CONFIG.getElementsByTagName("speed")[0].textContent),UNIT_S=parseFloat(CONFIG.getElementsByTagName("unit_speed")[0].textContent),VILL1ST="",ALTBOT=!0,MAX_IDO_PERC=20,worker=createWorker((function(e){e.addEventListener("message",(function(e){setTimeout((()=>{postMessage(e.data)}),e.data.time)}),!1)}));function createWorker(e){var t=new Blob(["("+e.toString()+")(self)"],{type:"text/javascript"});return new Worker(window.URL.createObjectURL(t))}worker.onmessage=function(e){switch((e=e.data).id){case"farm":szem4_farmolo_motor();break;case"vije":szem4_VIJE_motor();break;case"epit":szem4_EPITO_motor();break;case"adatok":szem4_ADAT_motor();break;default:debug("worker","Ismeretlen ID",JSON.stringify(e))}},AZON=game_data.player.id+"_"+game_data.world+AZON}catch(e){alert("SZEM Nem tud elindulni/n"+e),exit(0)}function vercheck(){try{naplo("Globál","Verzió ["+VERZIO+"] legfrissebb állapotban, GIT-ről szedve. ")}catch(e){alert2(e)}}function init(){try{if(document.getElementById("production_table"))var e=document.getElementById("production_table");else if(document.getElementById("combined_table"))e=document.getElementById("combined_table");else if(document.getElementById("buildings_table"))e=document.getElementById("buildings_table");else{if(!document.getElementById("techs_table"))return alert("Ilyen nézetbe való futtatás nem támogatott. Kísérlet az áttekintés betöltésére...\n\nLaunching from this view is not supported. Trying to load overview..."),document.location.href=document.location.href.replace(/screen=[a-zA-Z]+/g,"screen=overview_villages"),!1;e=document.getElementById("techs_table")}var t=new RegExp(/[0-9]+(\|)[0-9]+/);if(t.test(e.rows[1].cells[0].textContent))var a=0;else if(t.test(e.rows[1].cells[1].textContent))a=1;else{if(!t.test(e.rows[1].cells[2].textContent))return alert("Nem találok koordinátákat ebbe a listába.\n\nI can not find coordinates in this view."),!1;a=2}VILL1ST=e.rows[1].cells[a].getElementsByTagName("a")[0].href;for(var n=1;n<e.rows.length;n++){var l=e.rows[n].cells[a].textContent.match(/[0-9]+(\|)[0-9]+/g);l=l[l.length-1],KTID[n-1]=l+";"+e.rows[n].cells[a].getElementsByTagName("span")[0].getAttribute("data-id").match(/[0-9]+/g)[0]}return document.getElementsByTagName("head")[0].innerHTML+='<style type="text/css">body{ background: #111; } table.fej{ padding:1px;  margin:auto; color: white; border: 1px solid yellow; } table.menuitem{ vertical-align:top; text-align: top; padding: 20px; margin:auto; color: white; border: 1px solid yellow; } table.menuitem td{ padding: 0px; vertical-align:top; }  table{ padding: 0px; margin: auto; color: white;  } table.vis{ color:black; } table.vis td, table.vis th{ padding: 3px 6px 3px 6px;  } #farm_honnan tr td:last-child{font-size:50%;  width:130px;} #farm_hova tr td:last-child{font-size:50%; width:130px;}  textarea{ background-color: #020; color:white; } .divrow{ display: table-row; } .divcell { display: table-cell; text-align: center; vertical-align:top; }  a{ color: white; } img{ border-color: grey; padding:1px; } #naploka a {color:blue;} input[type="button"] {font-size:13px; font-family:Century Gothic,sans-serif;    color:#FFFF77;    background-color:#3366CC;    border-style:ridge;    border-color:#000000;    border-width:3px; }  </style>',document.getElementsByTagName("body")[0].innerHTML='<div id="alert2" style="width: 300px; background-color: #60302b; color: #FFA; position: fixed; left:40%; top:40%; border:3px solid black; font-size: 11pt; padding: 5px; z-index:200; display:none"><div id="alert2head" style="width:100%;cursor:all-scroll; text-align:right; background: rgba(255,255,255,0.1)"><a href=\'javascript: alert2("close");\'>X (Bezár)</a></div><p id="alert2szov"></p></div> <table width="1024px" align="center" class="fej" style="background: #111; background-image:url(\''+pic("wallp.jpg")+'\'); background-size:1024px;"> <tr><td width="70%" id="fejresz" style="vertical-align:middle; margin:auto;"><h1><i></i></h1></td><td id="sugo" height="110px"></td></tr> <tr><td colspan="2" id="menuk" style="">  \t<div class="divrow" style="width: 1024px"> \t\t<span class="divcell" id="kiegs" style="text-align:left; padding-top: 5px;width:774px;"><img src="'+pic("muhely_logo.png")+'" alt="GIT" title="GIT C&amp;C Műhely megnyitása" onclick="window.open(\'https://github.com/cncDAni2/klanhaboru\')"> <img src="'+pic("kh_logo.png")+'" alt="Game" title="Klánháború megnyitása" onclick="window.open(\''+VILL1ST+'\')"> | </span> \t\t<span class="divcell" style="text-align:right; width:250px"> \t\t\t<a href=\'javascript: nyit("naplo");\' onmouseover="sugo(this,\'Események naplója\')">Napló</a> \t\t\t<a href=\'javascript: nyit("debug");\' onmouseover="sugo(this,\'Hibanapló\')">Debug</a> \t\t\t<a href=\'javascript: nyit("hang");\'><img src="'+pic("hang.png")+'" onmouseover="sugo(this,\'Hangbeállítások\')" alt="hangok"></a> \t\t</span> \t</div> \t </td></tr> </table> <p id="content" style="display: inline"></p>',document.getElementById("content").innerHTML='<table class="menuitem" width="1024px" align="center" id="naplo" style="display: none"> <tr><td> <h1 align="center">Napló</h1><br> <br> <table align="center" class="vis" id="naploka"><tr><th onclick=\'rendez("datum2",false,this,"naploka",0)\'  style="cursor: pointer;">Dátum</th><th  onclick=\'rendez("szoveg",false,this,"naploka",1)\' style="cursor: pointer;">Script</th><th  onclick=\'rendez("szoveg",false,this,"naploka",2)\' style="cursor: pointer;">Esemény</th></tr></table> </td></tr> </table>  <table class="menuitem" width="1024px" align="center" id="debug" style="display: none"> <tr><td> <h1 align="center">DeBugger</h1><br> <br> <table align="center" class="vis" id="debugger"><tr><th onclick=\'rendez("datum2",false,this,"debugger",0)\' style="cursor: pointer;">Dátum</th><th onclick=\'rendez("szoveg",false,this,"debugger",1)\' style="cursor: pointer;">Script</th><th onclick=\'rendez("szoveg",false,this,"debugger",2)\' style="cursor: pointer;">Esemény</th></tr></table> </td></tr> </table>  <table class="menuitem" width="1024px" align="center" id="hang" style="display: none"> <tr><td> <p align="center"><audio id="audio1" controls="controls" autoplay="autoplay"><source id="wavhang" src="" type="audio/wav"></audio></p> <h1 align="center">Hangbeállítás</h1><br> <div id="hangok" style="display:table;"> \t<div style="display:table-row;"><div style="display:table-cell; padding:10px;" onmouseover=\'sugo(this,"Ha be van kapcsolva, bot védelem esetén ez a link is megnyitódik, mint figyelmeztetés.")\'><b>Alternatív botriadó? <a href="javascript: altbot()">BEKAPCSOLVA</a><br>Megnyitott URL (egyszer)<br><input type="text" id="altbotURL" size="42" value="http://www.youtube.com/watch?v=k2a30--j37Q"></div>   </div> </div> </td></tr> </table>',document.title="SZEM IV",debug("SZEM 4","Verzió: GIT_"+(new Date).toLocaleDateString()),debug("SZEM 4","Prog.azon: "+AZON),debug("SZEM 4","W-Speed: "+SPEED),debug("SZEM 4","U-Speed: "+UNIT_S),!0}catch(e){return alert("Hiba indításkor:\n\nError at starting:\n"+e),!1}}function pic(e){return"https://raw.githubusercontent.com/cncDAni2/klanhaboru/main/images/szem4/"+e}function altbot(){try{return void((ALTBOT=!ALTBOT)?(document.getElementById("altbotURL").parentNode.getElementsByTagName("a")[0].innerHTML="BEKAPCSOLVA",document.getElementById("altbotURL").removeAttribute("disabled")):(document.getElementById("altbotURL").parentNode.getElementsByTagName("a")[0].innerHTML="KIKAPCSOLVA",document.getElementById("altbotURL").setAttribute("disabled","true")))}catch(e){alert(e)}}function soundVolume(e){document.getElementById("audio1").volume=e}function playSound(e){try{var t=document.getElementsByName(e)[0];if(null==t)return void debug("hanghiba","Nem definiált hang: "+e);if(0==t.checked)return;var a="https://raw.githubusercontent.com/cncDAni2/klanhaboru/main/images/szem4/"+e+".wav";document.getElementById("wavhang").src=a,document.getElementById("audio1").load(),setTimeout((function(){document.getElementById("audio1").paused&&document.getElementById("audio1").play()}),666)}catch(e){alert2(e)}}function validate(e){var t=e||window.event,a=t.keyCode||t.which;a=String.fromCharCode(a);/[0-9]|\./.test(a)||(t.returnValue=!1,t.preventDefault&&t.preventDefault())}function shorttest(){try{var e="",t="",a=document.getElementById("farm_opts").rows[2].cells[1].getElementsByTagName("input");""==a[0].value&&(e+="Termelés/óra értéke üres. Legalább egy 0 szerepeljen!\n"),parseInt(a[0].value,10)<50&&(t+="Termelés/óra értéke nagyon alacsony. \n"),""==a[1].value&&(e+="Max táv/óra: Üres érték. \n"),""==a[2].value&&(e+="Max táv/perc: Üres érték. \n"),0==parseInt(a[1].value,10)&&parseInt(a[2].value,10)<1&&(e+="A jelenleg megadott max távolság 0!\n"),0==parseInt(a[1].value,10)&&parseInt(a[2].value,10)<40&&(t+="A jelenleg megadott max távolság nagyon rövid!\n"),""==a[3].value&&(e+="A határszám értéke üres. Minimum megengedett értéke: 100.\n"),parseInt(a[3].value,10)<100&&(e+="A határszám értéke túl alacsony. Minimum megengedett értéke: 100.\n"),""==a[4].value&&(e+="Ha nem szeretnél kémet küldeni, írj be 0-t.\n"),parseInt(a[4].value,10)>3&&(t+="3-nál több kém egyik szerveren sem szükséges. Javasolt: 1 vagy 3.\n"),a[5].checked&&0==parseInt(a[4].value,10)&&(t+="Kényszeríted a kémek küldését, de a küldendő kém értékére 0 van megadva!\n"),""==a[7].value&&(e+="Ha minimum limit nélkül szeretnéd egységeid küldeni, írj be 0-t.\n");var n=parseInt(a[3].value,10),l=parseInt(a[7].value,10);return Math.ceil(n/20)<l&&(e+="A minimum sereg/falu legalább 20x-osa kell hogy legyen a határszám. Javaslatok: Minimum sereg "+Math.ceil(n/20)+", vagy Határszám: "+Math.ceil(20*l)+"\n"),""==a[8].value&&(e+="A legkevesebb pihenő idő: 1 perc, ne hagyd üresen.\n"),parseInt(a[8].value,10)<1&&(e+="A legkevesebb pihenő idő: 1 perc.\n"),parseInt(a[8].value,10)>150&&(e+="150 percnél több pihenő időt nem lehet megadni.\n"),""==a[9].value&&(e+="A leggyorsabb ciklusidő: 200 ms, ne hagyd üresen.\n"),parseInt(a[9].value,10)<200&&(e+="A leggyorsabb ciklusidő: 200 ms\n"),parseInt(a[9].value,10)>3e3&&(e+="3000 ms-nél több ciklusidő felesleges, és feltűnő. Írj be 3000 alatti értéket.\n"),parseInt(a[10].value,10)<20&&(e+="Raktár telítettségi értéke túl alacsony, így vélhetőleg sehonnan se fog fosztani."),""==e||FARM_PAUSE||szunet("farm",document.getElementsByName("farm")[0]),FARM_PAUSE&&(t+="A farmoló jelenleg meg van állítva!"),""!=e?(alert2("<b>Egy vagy több beállítási hiba miatt nem indítható a farmoló! Javítsa, majd indítsa el a kiegészítőt.</b><br><br>"+e),!1):(alert2(""==t?"close":"Javaslatok:\n"+t),!0)}catch(e){alert2("Hiba :(\n"+e)}}var SUGOORA;function sugo(e,t){if(""!=t){e.hasAttribute("data-hossz")||e.addEventListener("mouseout",(e=>{SUGOORA=setTimeout((()=>sugo(e.fromElement,"")),parseInt(e.fromElement.getAttribute("data-hossz"),10))}));var a=t.length;a=Math.round(1e3*a/40),"undefined"!=SUGOORA&&clearTimeout(SUGOORA),document.getElementById("sugo").innerHTML=t,e.setAttribute("data-hossz",a)}else document.getElementById("sugo").innerHTML=t}function prettyDatePrint(e){return e.getFullYear()+"/"+("0"+(e.getMonth()+1)).slice(-2)+"/"+("0"+e.getDate()).slice(-2)+" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)}function nyit(e){try{for(var t=document.getElementById("content").childNodes,a="",n=0;n<t.length;n++)"TABLE"==t[n].nodeName.toUpperCase()&&(a=t[n].getAttribute("id"),$("#"+a).fadeOut(300));var l=new RegExp('"'+e+'"');for(t=document.getElementById("menuk").getElementsByTagName("a"),n=0;n<t.length;n++)t[n].style.padding="3px",l.test(t[n].getAttribute("href"))?t[n].style.backgroundColor="#000000":t[n].style.backgroundColor="transparent";setTimeout((function(){$("#"+e).fadeIn(300)}),300)}catch(e){alert(e)}}function alert2(e){"close"!=(e+="")?(e=e.replace("\n","<br>"),document.getElementById("alert2szov").innerHTML="<b>Üzenet:</b><br>"+e,$("#alert2").show()):$("#alert2").hide()}function naplo(e,t){var a=new Date,n=a.getMinutes(),l=a.getSeconds();n<10&&(n="0"+n),l<10&&(l="0"+l);var r=new Array("Jan","Febr","March","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"),s=document.getElementById("naploka").insertRow(1),o=s.insertCell(0),i=s.insertCell(1),c=s.insertCell(2);o.innerHTML=r[a.getMonth()]+" "+a.getDate()+", "+a.getHours()+":"+n+":"+l,i.innerHTML=e,c.innerHTML=t,playSound("naplobejegyzes")}function debug(e,t){var a=new Date,n=a.getMinutes(),l=a.getSeconds();n<10&&(n="0"+n),l<10&&(l="0"+l);var r=new Array("Jan","Febr","March","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"),s=document.getElementById("debugger").insertRow(1),o=s.insertCell(0),i=s.insertCell(1),c=s.insertCell(2);o.innerHTML=r[a.getMonth()]+" "+a.getDate()+", "+a.getHours()+":"+n+":"+l,i.innerHTML=e,c.innerHTML=t}function ujkieg(e,t,a){return!document.getElementById(t)&&(document.getElementById("kiegs").innerHTML+="<img onclick='szunet(\""+e+'",this)\' name="'+e+'" onmouseover=\'sugo(this,"Az érintett scriptet tudod megállítani/elindítani.")\' src="'+pic(("farm"==e||"vije"==e?"pause":"play")+".png")+'" alt="Stop" title="Klikk a szüneteltetéshez"> <a href=\'javascript: nyit("'+e+"\");'>"+t.toUpperCase()+"</a> ",document.getElementById("content").innerHTML+='<table class="menuitem" width="1024px" align="center" id="'+e+'" style="display: none">'+a+"</table>",!0)}function ujkieg_hang(e,t){try{var a=t.split(";")}catch(e){a=t}var n=document.getElementById("hangok").getElementsByTagName("div")[0],l=document.createElement("div");l.setAttribute("style","display:table-cell; padding:10px;");for(var r="<h3>"+e+"</h3>",s=0;s<a.length;s++)r+='<input type="checkbox" name="'+a[s]+'" checked> <a href="javascript: playSound(\''+a[s]+"');\">"+a[s]+"</a><br>";l.innerHTML=r,n.appendChild(l)}function szunet(e,t){try{switch(e){case"farm":var a=FARM_PAUSE=!FARM_PAUSE;break;case"vije":a=VIJE_PAUSE=!VIJE_PAUSE;break;case"idtamad":alert2("Ezt a script nem állítható meg, mivel nem igényel semmilyen erőforrást.<br>Ha a hangot szeretnéd kikapcsolni, megteheted azt a hangbeállításoknál.");break;case"epit":a=EPIT_PAUSE=!EPIT_PAUSE;break;case"adatok":a=ADAT_PAUSE=!ADAT_PAUSE;break;default:return void alert2("Sikertelen script megállatás. Nincs ilyen alscript: "+e)}a?(t.src=pic("pause.png"),t.alt="Start",t.title="Klikk a folytatáshoz"):(t.src=pic("play.png"),t.alt="Stop",t.title="Klikk a szüneteltetéshez"),"farm"==e&&shorttest()}catch(e){alert2("Hiba:\n"+e)}}function distCalc(e,t){return e[0]=parseInt(e[0]),e[1]=parseInt(e[1]),t[0]=parseInt(t[0]),t[1]=parseInt(t[1]),Math.abs(Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)))}function rendez(e,t,a,n,l){try{var r=document.getElementById(n).getElementsByTagName("tbody")[0],s=document.getElementById(n).rows;if(s.length<2)return;for(var o=new Array,i=new Array,c=new Array,m=($.trim(s[1].cells[l].innerText).replace(" ",""),1);m<s.length;m++){switch(e){case"szoveg":o[m-1]=s[m].cells[l].innerText;break;case"szam":o[m-1]=parseInt(s[m].cells[l].innerText.replace(".",""));break;case"datum":""==s[m].cells[l].innerText?o[m-1]=new Date:o[m-1]=new Date(s[m].cells[l].innerText);break;case"datum2":var d=new Array("Jan","Febr","March","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"),g=new Date,u=s[m].cells[l].innerText;g.setMonth(d.indexOf(u.split(" ")[0])),g.setDate(u.split(" ")[1].replace(",","")),g.setHours(u.split(" ")[2].split(":")[0]),g.setMinutes(u.split(" ")[2].split(":")[1]),g.setSeconds(u.split(" ")[2].split(":")[2]),o[m-1]=g;break;case"lista":o[m-1]=s[m].cells[l].getElementsByTagName("select")[0].value;break;default:throw"Nem értelmezhető mi szerint kéne rendezni."}i[m-1]=s[m],c[m-1]=m-1}for(m=0;m<o.length;m++){for(var p=m,E=m;E<o.length;E++)t?o[E]>o[p]&&(p=E):o[E]<o[p]&&(p=E);var h=o[m];o[m]=o[p],o[p]=h;h=c[m];c[m]=c[p],c[p]=h}for(m=s.length-1;m>0;m--)r.deleteRow(m);for(m=0;m<o.length;m++)r.appendChild(i[c[m]]);return void a.setAttribute("onclick",'rendez("'+e+'",'+!t+',this,"'+n+'",'+l+")")}catch(e){alert2("Hiba rendezéskor:\n"+e)}}function koordTOid(e){for(var t=0;t<KTID.length;t++)if(KTID[t].split(";")[0]==e)return KTID[t].split(";")[1];return 0}function rovidit(e){var t="";if("egysegek"===e)for(var a=0;a<UNITS.length;a++)t+='<img style="width:15px" src="/graphic/unit/unit_'+UNITS[a]+'.png"><input type="checkbox" onclick="szem4_farmolo_multiclick('+a+",'honnan',this.checked)\">";else t="";return t}function getServerTime(e){return new Date}function maplink(e){return'<a href="'+VILL1ST.replace("screen=overview","x="+e.split("|")[0]+"&y="+e.split("|")[1]+"&screen=map")+'" target="_BLANK">'+e+"</a>"}function multipricer(e,t,a){try{if(null==e)return;if(!document.getElementById("farm_multi_"+e).checked)return;for(var n=document.getElementById("farm_"+e).rows,l=n.length-1;l>0;l--)if("none"!=n[l].style.display)switch(t){case"del":n[l].parentNode.removeChild(n[l]);break;case"urit":"honnan"==e?n[l].cells[2].innerHTML="":n[l].cells[5].innerHTML="";break;case"mod":n[l].cells[3].innerHTML=a;break;case"htor":n[l].cells[0].style.backgroundColor="#f4e4bc";break;case"hcser":n[l].cells[2].style.backgroundColor=a}}catch(e){}}function sortorol(e,t){var a=e.parentNode;a.parentNode.removeChild(a),multipricer(t,"del")}function urit(e,t){e.innerHTML="",multipricer(t,"urit")}function modosit_szam(e){var t=prompt("Új érték?");null!=t&&""!=(t=t.replace(/[^0-9]/g,""))&&(e.innerHTML=t,multipricer("hova","mod",t))}function hattertolor(e){e.style.backgroundColor="#f4e4bc",multipricer("hova","htor")}function hattercsere(e){var t="#00FF00";"rgb(0, 255, 0)"!=e.style.backgroundColor&&"#00FF00"!=e.style.backgroundColor||(t="#f4e4bc"),e.style.backgroundColor=t,multipricer("hova","hcser",t)}var BOTORA,ALTBOT2=!1,BOT_VOL=0;function BotvedelemBe(){try{(BOT_VOL+=.2)>1&&(BOT_VOL=1),soundVolume(BOT_VOL),playSound("bot2"),BOT=!0,alert2('BOT VÉDELEM!!!<br>Írd be a kódot, és kattints ide lentre!<br><br><a href="javascript: BotvedelemKi()">Beírtam a kódot, mehet tovább!</a>'),ALTBOT&&!ALTBOT2&&(window.open(document.getElementById("altbotURL").value),ALTBOT2=!0)}catch(e){debug("BotvedelemBe()",e)}BOTORA=setTimeout("BotvedelemBe()",1500)}function BotvedelemKi(){BOT=!1,ALTBOT2=!1,BOT_VOL=0,document.getElementById("audio1").pause,alert2("OK"),clearTimeout(BOTORA);try{FARM_REF.location.reload()}catch(e){}try{VIJE_REF1.location.reload()}catch(e){}try{VIJE_REF2.location.reload()}catch(e){}try{IDTAMAD_REF.location.reload()}catch(e){}try{EPIT_REF.location.reload()}catch(e){}}function isPageLoaded(e,t,a){try{if(e.closed)return!1;if(e.document.getElementById("bot_check")||"Bot védelem"==e.document.title)return naplo("Globális","Bot védelem aktív!!!"),document.getElementById("audio1").volume=.2,BotvedelemBe(),!1;if(e.document.location.href.indexOf("sid_wrong")>-1)return naplo("Globális","Kijelentkezett fiók. Jelentkezzen be újra, vagy állítsa le a programot."),BotvedelemBe(),!1;if(!a)return!1;if(a.indexOf("not ")>-1)var n=!0;else n=!1;if(t>-1&&e.game_data.village.id!=t)return!1;if(e.document.getElementById("serverTime").innerHTML.length>4)if(n){if(-1==e.document.location.href.indexOf(a.split(" ")[1]))return!0}else if(e.document.location.href.indexOf(a)>-1)return!0;return!1}catch(e){return!1}}function windowOpener(e,t,a){return window.open(t,a)}function add_farmolo(){try{var e=document.getElementById("farm_opts"),t=e.rows[1].cells[0].getElementsByTagName("input")[0].value;if(""==t)return;if(!new RegExp(/[0-9]+(\|)[0-9]+/).test(t))throw"Nincs érvényes koordináta megadva";t=t.match(/[0-9]+(\|)[0-9]+/g);for(var a=!1,n=0;n<e.rows[2].cells[0].getElementsByTagName("input").length;n++)if(1==e.rows[2].cells[0].getElementsByTagName("input")[n].checked){a=!0;break}if(!a&&!confirm("Nincs semmilyen egység megadva, amit küldhetnék. Folytatod?\n(később ez a megadás módosítható)"))return;for(var l="",r=0;r<t.length;r++){var s=document.getElementById("farm_honnan"),o=document.getElementById("farm_hova");for(n=1;n<s.rows.length;n++)if(s.rows[n].cells[0].textContent==t[r]){l+=t[r]+", ",t[r]="";break}if(""!=t[r]){for(n=1;n<o.rows.length;n++)if(o.rows[n].cells[0].textContent==t[r]){l+=t[r]+", ",t[r]="";break}if(""!=t[r])if(0!=koordTOid(t[r])){var i;(i=(o=s.insertRow(-1)).insertCell(0)).innerHTML=t[r],i.setAttribute("ondblclick",'sortorol(this,"honnan")'),(i=o.insertCell(1)).innerHTML=rovidit("egysegek");for(n=0;n<i.getElementsByTagName("input").length;n++)1==e.rows[2].cells[0].getElementsByTagName("input")[n].checked&&(i.getElementsByTagName("input")[n].checked=!0);(i=o.insertCell(2)).innerHTML="",i.setAttribute("ondblclick",'urit(this,"honnan")')}else l+=t[r]+", ",t[r]=""}}return e.rows[1].cells[0].getElementsByTagName("input")[0].value="",void(""!=l&&alert2("Dupla falumegadások, esetleg nem lévő saját faluk kiszűrve:\n"+l))}catch(e){alert(e)}}function add_farmolando(){try{var e=document.getElementById("farm_opts"),t=e.rows[1].cells[1].getElementsByTagName("input")[0].value;if(""==t)return;if(!new RegExp(/[0-9]+(\|)[0-9]+/).test(t))throw"Nincs érvényes koordináta megadva";t=t.match(/[0-9]+(\|)[0-9]+/g),e.rows[2].cells[1].getElementsByTagName("input")[3].value=e.rows[2].cells[1].getElementsByTagName("input")[3].value.replace(/[^0-9]/g,""),""==e.rows[2].cells[1].getElementsByTagName("input")[3].value&&(e.rows[2].cells[1].getElementsByTagName("input")[3].value=3600);for(var a="",n=0;n<t.length;n++){for(var l=document.getElementById("farm_hova"),r=document.getElementById("farm_honnan"),s=1;s<l.rows.length;s++)if(l.rows[s].cells[0].textContent==t[n]){a+=t[n]+", ",t[n]="";break}if(""!=t[n]){for(s=1;s<r.rows.length;s++)if(r.rows[s].cells[0].textContent==t[n]){a+=t[n]+", ",t[n]="";break}var o;if(""!=t[n])(o=(r=l.insertRow(-1)).insertCell(0)).innerHTML=t[n],o.setAttribute("ondblclick","hattertolor(this)"),o.setAttribute("data-age","0"),(o=r.insertCell(1)).innerHTML="",o.setAttribute("ondblclick",'sortorol(this,"hova")'),(o=r.insertCell(2)).innerHTML="0",o.setAttribute("ondblclick","hattercsere(this)"),(o=r.insertCell(3)).innerHTML="0",o.setAttribute("ondblclick","modosit_szam(this)"),(o=r.insertCell(4)).innerHTML='<input type="checkbox" onclick="szem4_farmolo_multiclick(0,\'hova\',this.checked)">',(o=r.insertCell(5)).innerHTML="",o.setAttribute("ondblclick",'urit(this,"hova")')}}return e.rows[1].cells[1].getElementsByTagName("input")[0].value="",void(""!=a&&alert2("Dupla falumegadások kiszűrve:\n"+a))}catch(e){alert(e)}}function szem4_farmolo_multiclick(e,t,a){try{if(!document.getElementById("farm_multi_"+t).checked)return;var n=document.getElementById("farm_"+t).rows;t="honnan"==t?1:4;for(var l=1;l<n.length;l++)"none"!=n[l].style.display&&(n[l].cells[t].getElementsByTagName("input")[e].checked=a);return}catch(a){alert2("Hiba: "+t+"-"+e+"\n"+a)}}function szem4_farmolo_csoport(e){try{var t=prompt("Faluszűrő\nAdd meg azon faluk koordinátáit, melyeket a listában szeretnél látni. A többi falu csupán láthatatlan lesz, de tovább folyik a használata.\nSpeciális lehetőségid:\n-1: Csupán ezt az értéket adva meg megfordítódik a jelenlegi lista láthatósága (negáció)\n-...: Ha az első karakter egy - jel, akkor a felsorolt faluk kivonódnak a jelenlegi listából (különbség)\n+...: Ha az első karaktered +, akkor a felsorolt faluk hozzáadódnak a listához (unió)\nÜresen leokézva az összes falu láthatóvá válik");if(null==t)return;var a="norm";"-1"==t?a="negalt":("-"==t[0]&&(a="kulonbseg"),"+"==t[0]&&(a="unio")),""==t&&(a="all"),"S"==t&&(a="yellow"),t=t.match(/[0-9]+(\|)[0-9]+/g);for(var n,l=!1,r=document.getElementById("farm_"+e).rows,s=1;s<r.length;s++){switch(l=!1,n=r[s].cells[0].textContent,a){case"norm":t.indexOf(n)>-1&&(l=!0);break;case"negalt":"none"==r[s].style.display&&(l=!0);break;case"kulonbseg":"none"!=r[s].style.display&&-1==t.indexOf(n)&&(l=!0);break;case"unio":("none"!=r[s].style.display||t.indexOf(n)>-1)&&(l=!0);break;case"all":l=!0;break;case"yellow":"yellow"==r[s].cells[0].style.backgroundColor&&(l=!0)}l?r[s].setAttribute("style","display:line"):r[s].setAttribute("style","display:none")}}catch(e){alert2("Hiba: \n"+e)}}function getAllResFromVIJE(e){var t=ALL_UNIT_MOVEMENT[e];if(!t)return 0;var a=0;for(let e in t)a+=t[e][2];return isNaN(a)?(debug("getAllResFromVIJE","allRes is NaN at "+e+": "+JSON.stringify(t)),0):a}function subtractNyersValue(e,t){for(var a,n=document.getElementById("farm_hova").rows,l=1;l<n.length;l++)if((a=n[l].cells)[0].textContent==e){var r=parseInt(a[3].innerText,10);(r-=t)<0&&(r=0),a[3].innerHTML=r;break}}function clearAttacks(){try{const n=(new Date).getTime();for(let l in ALL_UNIT_MOVEMENT){for(var e=[],t=ALL_UNIT_MOVEMENT[l].length-1;t>=0;t--)ALL_UNIT_MOVEMENT[l][t][1]<=n-3*MAX_IDO_PERC*6e4?ALL_UNIT_MOVEMENT[l].splice(t,1):ALL_UNIT_MOVEMENT[l][t][1]<=n&&e.push(ALL_UNIT_MOVEMENT[l][t]);if(e){for(let t of e)3!=t.length&&debug("clearAttacks","Anomaly, nem szabályszerű mozgás ("+l+"):"+JSON.stringify(t)+" -- össz:"+JSON.stringify(e)),t[2]>0&&(console.info("Sub_nyers",l,ALL_UNIT_MOVEMENT[l]),subtractNyersValue(t[0],t[2]),t[2]=0);if(!(e.length<2)){var a=e.reduce((function(e,t){return t[1]>e[1]?t:e}),e[0]);console.info("clearAttacks: Vannak törlendők, "+l+"az ez utániakat kéne: ",a,JSON.stringify(ALL_UNIT_MOVEMENT[l])),ALL_UNIT_MOVEMENT[l]=ALL_UNIT_MOVEMENT[l].filter((function(e){return e[1]>=a[1]})),console.info("clearAttacks kész, eredmény: ",l,ALL_UNIT_MOVEMENT[l])}}}for(let e in ALL_VIJE_SAVED)ALL_VIJE_SAVED[e]<n-108e5&&(subtractNyersValue(e,4e5),delete ALL_VIJE_SAVED[e])}catch(e){debug("clearAttacks",e),console.info("clearAttacks",e)}}function getCorrigatedMaxIdoPerc(e){var t=parseInt(document.getElementById("farm_opts").rows[2].cells[1].getElementsByTagName("input")[3].value,10);return Math.max(MAX_IDO_PERC,convertTbToTime(e,t))}function getProdHour(e){var t=0;if(e.split(",").length<3)t=""!=(t=document.getElementById("farm_opts").rows[2].cells[1].getElementsByTagName("input")[0].value)?parseInt(t):1e3;else{var a=e.split(",").map((e=>parseInt(e,10)));t=(TERMELES[a[0]]+TERMELES[a[1]]+TERMELES[a[2]])*SPEED}return t}function getResourceProduction(e,t){try{var a=getCorrigatedMaxIdoPerc(e);("max"==t||t>a)&&(t=a),prodHour=getProdHour(e);var n=t/60;return Math.round(prodHour*n)}catch(e){debug("getResourceProduction",e),console.info("getResourceProduction",e)}}function convertTbToTime(e,t){return t/getProdHour(e)*60}function calculateNyers(e,t,a){try{var n=0,l=new Date;if(l.setMinutes(l.getMinutes()+a),l=l.getTime(),!ALL_UNIT_MOVEMENT[e])return n=getResourceProduction(t,"max");allAttack=JSON.parse(JSON.stringify(ALL_UNIT_MOVEMENT[e]));var r=findClosestTimes(allAttack,l),s=r[0],o=r[1];if(n+=getResourceProduction(t,s?(l-s[1])/6e4:"max"),o){var i=convertTbToTime(t,o[0]),c=getCorrigatedMaxIdoPerc(t);i>c&&(i=c),o[1]-=6e4*i,o[1]<l&&(n-=getResourceProduction(t,(l-o[1])/6e4))}return n}catch(e){debug("calculateNyers",e),console.info("calculateNyers",e)}}function findClosestTimes(e,t){var a=null,n=null;return e.reduce((function(e,l){var r=l[1]-t;return r<0&&(null===a||r>a[1]-t)?a=l:r>0&&(null===n||r<n[1]-t)&&(n=l),e}),null),[a,n]}function addCurrentMovementToList(e,t,a){var n=e.innerHTML.match(/<td>[0-9]+:[0-9]+:[0-9]+<\/td>/g)[0].match(/[0-9]+/g);n=3600*parseInt(n[0],10)+60*parseInt(n[1],10)+parseInt(n[2],10);var l=new Date;l.setSeconds(l.getSeconds()+n),new Date,l=l.getTime();var r=parseInt(e.querySelector(".icon.header.ressources").parentElement.innerText.replaceAll(".",""),10),s=0,o=parseInt(a.cells[3].textContent,10);o>0&&(o-=getAllResFromVIJE(t))>0&&(r-=s=Math.min(r,o)),console.info("addCurrentMovementToList::",[r,l,s]);var i=ALL_UNIT_MOVEMENT[t];i?i.push([r,l,s]):ALL_UNIT_MOVEMENT[t]=[[r,l,s]],FARM_REF.document.getElementById("place_confirm_units").querySelector('[data-unit="spy"]').getElementsByTagName("img")[0].classList.contains("faded")||(!ALL_SPY_MOVEMENTS[t]||ALL_SPY_MOVEMENTS[t]<l)&&(ALL_SPY_MOVEMENTS[t]=l)}function isgyalog(e){try{var t=0,a=document.getElementById("farm_honnan").rows[e].cells[1].getElementsByTagName("input");return(a[5].checked||a[6].checked||a[7].checked)&&(t=1),(a[0].checked||a[1].checked||a[2].checked||a[3].checked)&&(t=1==t?2:3),t}catch(e){debug("isgyalog()",e)}}function szem4_farmolo_1kereso(){try{var e,t=document.getElementById("farm_hova").rows,a=document.getElementById("farm_honnan").rows,n=[],l=new Date;if(1==t.length||1==a.length)return"zero";for(var r=1;r<t.length;r++)if("red"!=t[r].cells[0].style.backgroundColor){var s=parseInt(document.getElementById("farm_opts").rows[2].cells[1].getElementsByTagName("input")[3].value,10),o=t[r].cells[0].textContent,i=parseInt(t[r].cells[3].textContent,10);i>0&&(i-=getAllResFromVIJE(o));var c=!1;i>5*s&&(c=!0);for(var m="",d={coord:"",traverTime:0,units:""},g=1;g<a.length;g++){e=0;var u=a[g];if(""!=u.cells[2].innerHTML){var p=new Date(u.cells[2].textContent);if(p instanceof Date&&!isNaN(p.valueOf())||(u.cells[2].innerHTML="",p=new Date),l>p)u.cells[2].innerHTML="",m="all";else{if("yellow"!=u.cells[2].style.backgroundColor)continue;m="gyalog"}}else m="all";var E=isgyalog(g);0!=E&&(1==E&&"gyalog"==m||(1==E&&"all"==m&&(e=10),2==E&&"gyalog"==m&&(e=18),2==E&&"all"==m&&(e=10),3==E&&(e=18,m="gyalog"),0!=e?(e=e*(1/SPEED)*(1/UNIT_S),e*=distCalc(o.split("|"),u.cells[0].textContent.split("|")),(""==d.coord||d.traverTime>e)&&(d={coord:u.cells[0].textContent,traverTime:e,units:m})):debug("Farmoló","Anomália lépett fel farmkereséskor.")))}if(d.traverTime>0&&(c||0==n.length||d.traverTime<n[0])){var h=calculateNyers(o,t[r].cells[1].textContent,d.traverTime);if(i+h<s)continue;n=[d.traverTime,d.units,d.coord,o,i+h]}if(c&&n.length>1){debug("szem4_farmolo_1kereso","Vérszemet kaptam, sok nyers: "+n[3]+" ("+n[4]+")");break}}if(0==n.length)return"";var _=60*parseInt(document.getElementById("farm_opts").rows[2].cells[1].getElementsByTagName("input")[1].value)+parseInt(document.getElementById("farm_opts").rows[2].cells[1].getElementsByTagName("input")[2].value);return n[0]>_?"":n}catch(e){return debug("szem4_farmolo_1kereso()",e),""}}function szem4_farmolo_2illeszto(e){try{try{TamadUpdt(FARM_REF)}catch(e){}var t=FARM_REF.document.forms.units;if(t.x.value=e[3].split("|")[0],t.y.value=e[3].split("|")[1],null==t.input.value)throw"Nem töltött be az oldal?"+t.input.innerHTML;for(var a=document.getElementById("farm_honnan").rows,n=1;n<a.length;n++)if(a[n].cells[0].textContent==e[2]){a=a[n].cells[1].getElementsByTagName("input");break}var l=document.getElementById("farm_hova").rows;for(n=1;n<l.length;n++)if(l[n].cells[0].textContent==e[3]){l=l[n];break}var r=document.getElementById("farm_opts").rows[2].cells[1].getElementsByTagName("input"),s=new Array;for(n=0;n<UNITS.length;n++)try{a[n].checked||4==n&&r[5].checked?s[n]=parseInt(FARM_REF.document.getElementById("unit_input_"+UNITS[n]).parentNode.children[2].textContent.match(/[0-9]+/g)[0]):s[n]=0}catch(e){s[n]=0}var o=10,i=e[4],c=0,m=0;if("all"==e[1])for(n=5;n<UNITS.length;n++)try{if(i>TEHER[n]){if((g=Math.ceil(i/TEHER[n]))>(u=s[n]))var d=u;else d=g;i-=d*TEHER[n],c+=d*TEHER[n],UNITS[n]+":"+d+"; ",FARM_REF.document.getElementById("unit_input_"+UNITS[n]).value=d,m+=TANYA[n]*d,o<E_SEB[n]&&(o=E_SEB[n])}}catch(e){}else for(n=0;n<4;n++)try{if(i>TEHER[n]){var g,u;if((g=Math.ceil(i/TEHER[n]))>(u=s[n]))d=u;else d=g;i-=d*TEHER[n],c+=d*TEHER[n],UNITS[n]+":"+d+"; ",FARM_REF.document.getElementById("unit_input_"+UNITS[n]).value=d,m+=TANYA[n]*d,o<E_SEB[n]&&(o=E_SEB[n])}}catch(e){}var p=r[6].value;if(t.spy.value=0,a[4].checked){var E=distCalc(e[2].split("|"),e[3].split("|"))*o*(1/SPEED)*(1/UNIT_S),h=new Date;h=h.setMinutes(h.getMinutes()+E),(!ALL_SPY_MOVEMENTS[e[3]]||h-ALL_SPY_MOVEMENTS[e[3]]>6e4*p)&&(t.spy.value=s[4]>=r[4].value?r[4].value:0)}var _=!1;if(r[5].checked&&s[4]<parseInt(r[4].value))console.info("Forced not OK",r[5].checked,"&&",s[4],"<",parseInt(r[4].value)),ezt=e[1]+"|semmi";else{var y=(FARM_REF.game_data.village.wood+FARM_REF.game_data.village.stone+FARM_REF.game_data.village.iron)/3/FARM_REF.game_data.village.storage_max;Math.round(100*y)>parseInt(r[10].value)?(ezt=e[1]+"|semmi",naplo("Farmoló","Raktár túltelített ebben a faluban: "+e[2]+". ("+Math.round(100*y)+"% > "+parseInt(r[10].value)+"%)")):m>=parseInt(r[7].value)?(parseInt(t.spy.value,10)>0&&""==l.cells[1].innerHTML&&(_=!0),c-100>e[4]&&debug("Farmolo()","<b>ERROR: TOO MANY UNITS</b>"),t.attack.click(),ezt=e[1]):(console.info("Fake limit?",m,">=",parseInt(r[7].value)," --\x3e Falu: "+e[3]),ezt=e[1]+"|semmi")}return[i,ezt,e[2],e[3],o,_,c]}catch(e){return debug("Illeszto()",e),FARM_LEPES=0,""}}function szem4_farmolo_3egyeztet(e){try{for(var t=document.getElementById("farm_honnan").rows,a=1;a<t.length;a++)if(t[a].cells[0].textContent==e[2]){t=t[a];break}var n=document.getElementById("farm_hova").rows;for(a=1;a<n.length;a++)if(n[a].cells[0].textContent==e[3]){n=n[a];break}try{if("error_box"==FARM_REF.document.getElementById("content_value").getElementsByTagName("div")[0].getAttribute("class"))return naplo("Farmoló","Hiba "+e[3]+" farmolásánál: "+FARM_REF.document.getElementById("content_value").getElementsByTagName("div")[0].textContent+". Tovább nem támadom"),n.cells[0].style.backgroundColor="red",FARM_LEPES=0,FARM_REF.document.querySelector(".village-item")&&FARM_REF.document.querySelector(".village-item").click(),""}catch(e){}try{if(FARM_REF.document.getElementById("content_value").getElementsByTagName("table")[0].rows[2].cells[1].getElementsByTagName("a")[0].href.indexOf("info_player")>-1&&!n.cells[4].getElementsByTagName("input")[0].checked)return naplo("Farmoló","Játékos "+maplink(e[3])+" helyen: "+FARM_REF.document.getElementById("content_value").getElementsByTagName("table")[0].rows[2].cells[1].innerHTML.replace("href",'target="_BLANK" href')+". Tovább nem támadom"),n.cells[0].style.backgroundColor="red",FARM_LEPES=0,""}catch(e){}try{var l=FARM_REF.document.getElementById("content_value").getElementsByTagName("table")[0].rows;l=parseInt(l[l.length-1].cells[0].textContent.replace(/[^0-9]+/g,"")),e[6]!=l&&debug("farm3",'Valódi teherbírás nem egyezik a kiszámolttal. Hiba, ha nincs teherbírást módosító "eszköz".')}catch(e){debug("farm3","Teherbírás megállapítás hiba: "+e)}if(hatszam=parseInt(document.getElementById("farm_opts").rows[2].cells[1].getElementsByTagName("input")[3].value,10),-1==e[1].indexOf("semmi")||e[6]>2*hatszam){var r=document.getElementById("farm_opts").rows[2].cells[1].getElementsByTagName("input");if(e[5]&&(n.cells[1].style.backgroundColor="rgb(213, 188, 244)"),addCurrentMovementToList(FARM_REF.document.getElementById("command-data-form"),e[3],n),FARM_REF.document.getElementById("troop_confirm_submit").click(),n.cells[0].setAttribute("data-age",0),e[0]>parseInt(r[3].value)){var s=getServerTime(FARM_REF),o=distCalc(e[2].split("|"),e[3].split("|"));o=o*(1/SPEED)*(1/UNIT_S)*e[4],o=Math.round(o),s.setMinutes(s.getMinutes()+o),n.cells[5].innerHTML=s}}if("all"==e[1])var i=!0;else i=!1;var c=!1;return e[0]>25&&(c=!0),[c,i,e[2],e[3]]}catch(e){debug("szem4_farmolo_3egyeztet()",e),FARM_LEPES=0}}function szem4_farmolo_4visszaell(e){try{for(var t=document.getElementById("farm_honnan").rows,a=1;a<t.length;a++)if(t[a].cells[0].textContent==e[2]){t=t[a];break}if("boolean"==typeof e[1])var n=e[1];else if(e[1].indexOf("all")>-1)n=!0;else n=!1;if(n){var l=!1;for(a=0;a<3;a++)if(t.cells[1].getElementsByTagName("input")[a].checked&&FARM_REF.document.getElementById("unit_input_"+UNITS[a])&&parseInt(FARM_REF.document.getElementById("unit_input_"+UNITS[a]).parentNode.children[2].textContent.match(/[0-9]+/g)[0])>5){l=!0;break}l||(n=!1)}var r=t.cells[1].getElementsByTagName("input"),s=22;for(a=0;a<r.length;a++)4!=a&&r[a].checked&&E_SEB[a]<s&&(s=E_SEB[a]);s=s*(1/SPEED)*(1/UNIT_S);var o=!0;n||(o=!1);var i=new Date;t.cells[2].style.backgroundColor=o?"yellow":"#f4e4bc",i.setMinutes(i.getMinutes()+parseInt(document.getElementById("farm_opts").rows[2].cells[1].getElementsByTagName("input")[8].value,10)),t.cells[2].innerHTML=i}catch(e){return void debug("szem4_farmolo_4visszaell()",e)}}function szem4_farmolo_motor(){try{var e=500;if(e=parseInt(document.getElementById("farm_opts").rows[2].cells[1].getElementsByTagName("input")[9].value,10),BOT||FARM_PAUSE)e=5e3;else switch(FARM_HIBA>10&&(FARM_HIBA=0,FARM_GHIBA++,FARM_LEPES=0,FARM_GHIBA>3&&(FARM_GHIBA>5&&(naplo("Globál","Nincs internet? Folyamatos hiba farmolónál"),e=6e4,playSound("bot2")),FARM_REF.close())),FARM_LEPES){case 0:if(PM1=szem4_farmolo_1kereso(),console.info("Case 0, PM1=",PM1),"zero"==PM1){e=1e4;break}if(""==PM1){e=6e4*parseInt(document.getElementById("farm_opts").rows[2].cells[1].getElementsByTagName("input")[8].value,10),isPageLoaded(FARM_REF,-1);break}isPageLoaded(FARM_REF,koordTOid(PM1[2]),"screen=place")||(FARM_REF=windowOpener("farm",VILL1ST.replace(/village=[0-9]+/,"village="+koordTOid(PM1[2])).replace("screen=overview","screen=place"),AZON+"_Farmolo")),FARM_LEPES=1;break;case 1:isPageLoaded(FARM_REF,koordTOid(PM1[2]),"screen=place")?(FARM_HIBA=0,FARM_GHIBA=0,PM1=szem4_farmolo_2illeszto(PM1),console.info("Case 1, PM1::",PM1),FARM_LEPES="object"==typeof PM1&&PM1.length>0?PM1[1].indexOf("semmi")>0?3:2:0,FARM_REF.document.title="Szem4/farmoló"):FARM_HIBA++;break;case 2:isPageLoaded(FARM_REF,koordTOid(PM1[2]),"try=confirm")?(FARM_HIBA=0,FARM_GHIBA=0,PM1=szem4_farmolo_3egyeztet(PM1),FARM_LEPES="object"==typeof PM1&&PM1.length>0&&1==PM1[0]?3:0):FARM_HIBA++;break;case 3:isPageLoaded(FARM_REF,koordTOid(PM1[2]),"not try=confirm")?(FARM_HIBA=0,FARM_GHIBA=0,szem4_farmolo_4visszaell(PM1),FARM_LEPES=0):FARM_HIBA++;break;default:FARM_LEPES=0}}catch(e){debug("szem4_farmolo_motor()",e+" Lépés:"+FARM_LEPES)}var t=100/(40*Math.random()+80);e=Math.round(e*t);try{worker.postMessage({id:"farm",time:e})}catch(e){debug("farm","Worker engine error: "+e),setTimeout((function(){szem4_farmolo_motor()}),3e3)}}var FARMOLO_TIMER,KTID=new Array,TERMELES=new Array(5,30,35,41,47,55,64,74,86,100,117,136,158,184,214,249,289,337,391,455,530,616,717,833,969,1127,1311,1525,1774,2063,2400),UNITS=new Array("spear","sword","axe","archer","spy","light","marcher","heavy"),TEHER=new Array(25,15,10,10,0,80,50,50),TANYA=new Array(1,1,1,1,2,4,5,6),E_SEB=new Array(18,22,18,18,9,10,10,11),BOT=!1,ALL_UNIT_MOVEMENT={},ALL_SPY_MOVEMENTS={};init(),ujkieg_hang("Alaphangok","naplobejegyzes;bot2"),ujkieg("farm","Farmoló",'<tr><td><table class="vis" id="farm_opts" style="width:100%; margin-bottom: 50px;"><tr><th>Farmoló falu hozzáadása</th><th>Farmolandó falu hozzáadása</th></tr><tr><td style="width:48%;" onmouseover="sugo(this,\'Adj meg koordinátákat, melyek a te faluid és farmolni szeretnél velük. A koordináták elválasztása bármivel történhet.\')">Koordináták: <input type="text" size="45" placeholder="111|111, 222|222, ..."> <input type="button" value="Hozzáad" onclick="add_farmolo()"></td><td style="width:52%;" onmouseover="sugo(this,\'Adj meg koordinátákat, amelyek farmok, és farmolni szeretnéd. A koordináták elválasztása bármivel történhet.\')">Koordináták:  <input type="text" size="45" placeholder="111|111, 222|222, ..."> <input type="button" value="Hozzáad" onclick="add_farmolando()"></td></tr><tr><td onmouseover="sugo(this,\'A felvivendő falukból ezeket az egységeket használhatja SZEM IV farmolás céljából. Később módosítható.\')" style="vertical-align:middle;">Mivel? '+rovidit("egysegek")+'</td><td>Termelés/óra: <input onkeypress="validate(event)" type="text" size="5" value="3600" onmouseover="sugo(this,\'Ha nincs felderített bányaszint, úgy veszi ennyi nyers termelődik\')"> Max táv: <input type="text" size="2" value="4" onkeypress="validate(event)" onmouseover="sugo(this,\'A max távolság, amin túl már nem küldök támadásokat\')">óra <input onkeypress="validate(event)" type="text" size="2" value="0" onmouseover="sugo(this,\'A max távolság, amin túl már nem küldök támadásokat\')">perc. Határszám: <input type="text" onkeypress="validate(event)" onmouseover="sugo(this,\'Az új farmok ennyi nyersanyaggal lesznek felvíve. Másrész, ez alatti nyersanyagért még nem indulok el.\')" value="3600" size="5"><br>Kém/falu: <input onkeypress="validate(event)" type="text" value="1" size="2" onmouseover="sugo(this,\'Minden támadással ennyi kém fog menni\')"> Kényszerített?<input type="checkbox" onmouseover="sugo(this,\'Kémek nélkül nem indít támadást, ha kéne küldenie az időlimit esetén. Kémeket annak ellenére is fog vinni, ha nincs bepipálva a kém egység.\')">Kém/perc: <input type="text" value="60" size="3" onmouseover="sugo(this,\'Max ekkora időközönként küld kémet falunként\')">&nbsp;&nbsp;Min sereg/falu: <input onkeypress="validate(event)" type="text" value="100" size="4" onmouseover="sugo(this,\'Ennél kevesebb fő támadásonként nem indul. A szám tanyahely szerinti foglalásban értendő.\')"><br>Sebesség: <input onkeypress="validate(event)" type="text" size="2" value="10" onmouseover="sugo(this,\'Ha a farmoló nem talál több feladatot magának megáll, ennyi időre. Érték lehet: 1-300. Javasolt érték: 10-120 perc\')">perc/<input onkeypress="validate(event)" type="text" size="3" value="500" onmouseover="sugo(this,\'Egyes utasítások/lapbetöltődések ennyi időközönként hajtódnak végre. Érték lehet: 200-6000. Javasolt: 500ms, lassabb gépek esetén 1000-2000.\')">ms. Ha a raktár &gt;<input type="text" size="2" onmouseover="sugo(this,\'Figyeli a raktár telítettségét, és ha a megadott % fölé emelkedik, nem indít támadást onnan. Telítettség össznyersanyag alapján számolva. Min: 20. Ne nézze: 100-nál több érték megadása esetén.\')" value="90">%, nem foszt.</td></tr></table>  <table class="vis" id="farm_honnan" style="vertical-align:top; display: inline-block; width:550px"><tr><th width="55px" onmouseover="sugo(this,\'Ezen falukból farmolsz. Dupla klikk az érintett sor koordinátájára=sor törlése.<br>Rendezhető\')" style="cursor: pointer;" onclick=\'rendez("szoveg",false,this,"farm_honnan",0)\'>Honnan</th><th onmouseover="sugo(this,\'Ezen egységeket használ fel SZEM a farmoláshoz. Bármikor módosítható.\')">Mivel?</th><th onmouseover="sugo(this,\'Ekkor ér vissza sereg a számításaim szerint. Dupla klikk=törlés=már megérkezett/nézd újra.<br>Rendezhető.<br><br>Pipa: egy cellán végrehajtott (duplaklikkes) művelet minden látható falura érvényes lesz.\')" onclick=\'rendez("datum",false,this,"farm_honnan",2)\' style="cursor: pointer; vertical-align:middle;">Return <span style="margin-left: 45px; margin-right: 0px;"><img src="'+pic("search.png")+'" alt="?" title="Szűrés falukra..." style="width:15px;height:15px;" onclick="szem4_farmolo_csoport(\'honnan\')"><input type="checkbox" id="farm_multi_honnan" onmouseover="sugo(this,\'Ha bepipálod, akkor egy cellán végzett dupla klikkes művelet minden sorra érvényes lesz az adott oszlopba (tehát minden falura), ami jelenleg látszik. Légy óvatos!\')"></span></th></tr></table> <table class="vis" id="farm_hova" style="vertical-align:top; display: inline-block;"><tr><th onmouseover="sugo(this,\'Ezen falukat farmolod. A háttérszín jelöli a jelentés színét: alapértelmezett=zöld jelik/nincs felderítve. Sárga=veszteség volt a falun. Piros: a támadás besült, nem megy rá több támadás.<br>Dupla klikk a koordira: a háttérszín alapértelmezettre állítása.<br>Rendezhető\')" style="cursor: pointer;" onclick=\'rendez("szoveg",false,this,"farm_hova",0)\'>Hova</th><th onmouseover="sugo(this,\'Felderített bányaszintek, ha van. Kék háttér: megy rá kémtámadás.<br>Dupla klikk=az érintett sor törlése\')">Bányák</th><th onmouseover="sugo(this,\'Fal szintje. Dupla klikk=háttér csere (csak megjelölésként). <br>Rendezhető.\')" onclick=\'rendez("szam",false,this,"farm_hova",2)\' style="cursor: pointer;">Fal</th><th onmouseover="sugo(this,\'Számítások szerint ennyi nyers van az érintett faluba. Dupla klikk=érték módosítása.<br>Rendezhető.\')" onclick=\'rendez("szam",false,this,"farm_hova",3)\' style="cursor: pointer;">Nyers</th><th onmouseover="sugo(this,\'Játékos e? Ha játékost szeretnél támadni, pipáld be a falut mint játékos uralta, így támadni fogja. Ellenben piros hátteret kap a falu.\')">J?</th><th onmouseover="sugo(this,\'A falura ekkor ér be az utolsó nagyerejű támadás. Információ a jelentés elemzőnek. Dupla klikk=idő törlése.<br>Rendezhető.<br><br>Pipa: egy cellán végrehajtott (duplaklikkes) művelet minden látható falura érvényes lesz.\')" onclick=\'rendez("datum",false,this,"farm_hova",5)\' style="cursor: pointer; vertical-align:middle;">Ut.T<span style="margin-left: 65px; margin-right: 0px;"><img src="'+pic("search.png")+'" alt="?" title="Szűrés falukra..." style="width:15px;height:15px;" onclick="szem4_farmolo_csoport(\'hova\')"><input type="checkbox" id="farm_multi_hova"></span></th></tr></table></p></td></tr>');var FARM_REF,PM1,FARM_LEPES=0,FARM_HIBA=0,FARM_GHIBA=0,FARM_PAUSE=!0;function VIJE_FarmElem(e){try{for(var t=document.getElementById("farm_hova").rows,a=!1,n=1;n<t.length;n++)if(t[n].cells[0].textContent==e){a=!0,t=t[n];break}if(!a)return[!1,!1,0];var l=!0;if(""==t.cells[1].textContent&&(l=!1),""!=t.cells[5].textContent)var r=new Date(t.cells[5].textContent);else r=getServerTime(VIJE_REF1);return r.setMinutes(r.getMinutes()-1),[a,l,r]}catch(e){debug("VIJE1_farmelem","Hiba: "+e)}}function VIJE_elemzett(e){try{var t=document.getElementById("VIJE_elemzett").textContent;if(""==t)return!1;t=t.split(",");for(var a=0;a<t.length;a++)if(t[a]==e)return!0;return t.length>130&&(document.getElementById("VIJE_elemzett").innerHTML=t.slice(t.length-100,t.length)),!1}catch(e){debug("VIJE1_farmelem","Hiba: "+e)}}function szem4_VIJE_1kivalaszt(){try{try{TamadUpdt(VIJE_REF1)}catch(e){}if(VT=VIJE_REF1.document.getElementById("report_list").rows,VT.length<3)return[0,0,"",!1];for(var e=!1,t=VT.length-2;t>0;t--){try{var a=VT[t].cells[1].textContent.match(/[0-9]+(\|)[0-9]+/g);a=a[a.length-1]}catch(e){continue}var n=VT[t].cells[1].getElementsByTagName("span")[0].getAttribute("data-id").replace("label_","");if(!VIJE_elemzett(n)){for(var l=VT[t].cells[1].childNodes,r=0;r<l.length;r++)if("IMG"==l[r].nodeName){l=(l=l[r].src.split(".png")[0].split("/"))[l.length-1];break}var s=VIJE_FarmElem(a);if(0!=s[0]){var o=getServerTime(VIJE_REF1),i=getServerTime(VIJE_REF1);if(!(s[2]>o)){if(m=void 0,d=void 0,g=void 0,m=VT[t].cells[2].textContent,d=m.match(/[0-9]+:[0-9]+/g)[0],g=m.replace(d,"").match(/[0-9]+/g)[0],o.setMinutes(parseInt(d.split(":")[1],10)),o.setHours(parseInt(d.split(":")[0],10)),o.setDate(parseInt(g,10)),i-o>108e5||i-o<0)var c=!0;else c=!1;if(0==s[1]){e=!0;break}if(!c&&1==s[1]){e=!0;break}}}}}if(!e){for(t=VT.length-2;t>0;t--)if(VT[t].cells[0].getElementsByTagName("input")[0].checked)return[0,0,"",!0];return[0,0,"",!1]}return"green"==l&&(VT[t].cells[0].getElementsByTagName("input")[0].checked=!0),[n,a,l,!1,c]}catch(e){return debug("VIJE1","Hiba: "+e),[0,0,"",!1]}var m,d,g}function VIJE_adatbeir(e,t,a,n,l,r){try{for(var s=document.getElementById("farm_hova").rows,o=1;o<s.length;o++)if(s[o].cells[0].textContent==e){s=s[o];break}if(s.cells[0].setAttribute("data-age",0),""!==a&&(s.cells[1].innerHTML=a,s.cells[1].backgroundColor="#f4e4bc",""==n&&(n=0)),""!==n&&(parseInt(s.cells[2].innerHTML)!==parseInt(n)&&(s.cells[2].backgroundColor="#f4e4bc"),s.cells[2].innerHTML=n),""!==t&&(s.cells[3].innerHTML=t,t>50*parseInt(document.getElementById("farm_opts").rows[2].cells[1].getElementsByTagName("input")[3].value,10)&&naplo("VIJE_adatbeír","Sok nyers van itt, lehet hiba? "+e+" falunál: ",t)),"green"===l?s.cells[0].style.backgroundColor="#f4e4bc":"yellow"===l?s.cells[0].style.backgroundColor="yellow":"blue"!=l&&(s.cells[0].style.backgroundColor="red",naplo("Jelentés Elemző",e+" farm veszélyesnek ítélve. Jelentésének színe "+l+".")),""!=s.cells[5].innerHTML&&(s.cells[5].innerHTML=""),r=r.getTime(),ALL_UNIT_MOVEMENT[e]){var i=null;ALL_UNIT_MOVEMENT[e].forEach((e=>{var t=Math.abs(e[1]-r);(!i||t<i)&&(i=t)})),i>6e4&&ALL_UNIT_MOVEMENT[e].push([1e4,r,0])}else ALL_UNIT_MOVEMENT[e]=[[1e4,r,0]];""!==t&&(ALL_VIJE_SAVED[e]=r)}catch(e){debug("VIJE_adatbeir","Hiba: "+e)}}function szem4_VIJE_2elemzes(e){try{for(var t=0,a=!1,n=VIJE_REF2.document.getElementById("attack_results").parentNode;"TABLE"!=n.nodeName;)n=n.parentNode;var l=n.rows[1].cells[1].innerText;if(l=new Date(Date.parse(l.replace(/jan\./g,"Jan").replace(/febr?\./g,"Feb").replace(/márc\./g,"Mar").replace(/ápr\./g,"Apr").replace(/máj\./g,"May").replace(/jún\./g,"Jun").replace(/júl\./g,"Jul").replace(/aug\./g,"Aug").replace(/szept\./g,"Sep").replace(/okt\./g,"Oct").replace(/nov\./g,"Nov").replace(/dec\./g,"Dec"))),ALL_VIJE_SAVED[e[1]]>=l.getTime()&&(a=!0),!a&&VIJE_REF2.document.getElementById("attack_spy_resources")){var r=VIJE_REF2.document.getElementById("attack_spy_resources").rows[0].cells[1];if(e[4]){t="";debug("VIJE2","Nem kell elemezni (régi)")}else try{if(/\d/.test(r.textContent))for(var s=r.textContent.replace(/\./g,"").match(/[0-9]+/g),o=(t=0,0);o<s.length;o++)t+=parseInt(s[o],10);else t=0}catch(a){t=0;debug("VIJE","<a href='"+VIJE_REF2.document.location+"' target='_BLANK'>"+e[0]+"</a> ID-jű jelentés nem szokványos, talált nyers 0-ra állítva. Hiba: "+a)}if(VIJE_REF2.document.getElementById("attack_spy_buildings_left")){var i=document.getElementById("vije").getElementsByTagName("input"),c=new Array(i[0].value.toUpperCase(),i[1].value.toUpperCase(),i[2].value.toUpperCase(),i[3].value.toUpperCase()),m=new Array(0,0,0),d=0;for(i=VIJE_REF2.document.getElementById("attack_spy_buildings_left").rows,o=1;o<i.length;o++){for(var g=0;g<3;g++)i[o].cells[0].textContent.toUpperCase().indexOf(c[g])>-1&&(m[g]=i[o].cells[1].textContent);i[o].cells[0].textContent.toUpperCase().indexOf(c[3])>-1&&(d=i[o].cells[1].textContent)}for(i=VIJE_REF2.document.getElementById("attack_spy_buildings_right").rows,o=1;o<i.length;o++){for(g=0;g<3;g++)i[o].cells[0].textContent.toUpperCase().indexOf(c[g])>-1&&(m[g]=i[o].cells[1].textContent);i[o].cells[0].textContent.toUpperCase().indexOf(c[3])>-1&&(d=i[o].cells[1].textContent)}}else m="",d="";VIJE_adatbeir(e[1],t,m,d,e[2],l)}else if(!a){var u=VIJE_REF2.document.getElementById("attack_results").rows[0].cells[2].innerText.split("/").map((e=>parseInt(e,10)));s="";u[0]!=u[1]&&(s=0),VIJE_adatbeir(e[1],s,"","",e[2],l)}return document.getElementById("VIJE_elemzett").innerHTML+=e[0]+",",document.getElementById("VIJE_elemzett").innerHTML.split(",").length>200&&(document.getElementById("VIJE_elemzett").innerHTML=document.getElementById("VIJE_elemzett").innerHTML.split(",").splice(100,100)+","),!0}catch(a){return debug("VIJE2","Elemezhetetlen jelentés: "+e[0]+":"+e[1]+". Hiba: "+a),VIJE_adatbeir(e[1],t,"","",e[2]),!1}}function szem4_VIJE_3torol(){try{if(document.getElementById("vije").getElementsByTagName("input")[4].checked)try{VIJE_REF1.document.forms[0].del.click()}catch(e){VIJE_REF1.document.getElementsByName("del")[0].click()}}catch(e){return void debug("VIJE3","Hiba: "+e)}}function szem4_VIJE_motor(){try{var e=1500;if(VIJE_PAUSE&&clearAttacks(),BOT||VIJE_PAUSE)e=5e3;else switch(VIJE_HIBA>10&&(VIJE_HIBA=0,++VIJE_GHIBA>3&&(VIJE_GHIBA>5&&(naplo("Globál","Nincs internet? Folyamatos hiba a jelentés elemzőnél"),e=6e4,playSound("bot2")),debug("szem4_VIJE_motor","Jelentés elemzo hiba >3, ablak bezár/újranyit"),VIJE_REF1.close()),VIJE_LEPES=0),VIJE2_HIBA>10&&(VIJE2_HIBA=0,++VIJE2_GHIBA>3&&(VIJE2_GHIBA>5&&naplo("Globál","Nincs internet? Folyamatos hiba a jelentés elemzőnél"),VIJE_REF2.close()),VIJE_LEPES=0),(!VIJE_REF1||0!=VIJE_LEPES&&VIJE_REF1.closed)&&(VIJE_LEPES=0),VIJE_LEPES){case 0:if(document.getElementById("farm_hova").rows.length>1){var t="";game_data.player.premium&&(t="group_id=-1&"),VIJE_REF1=windowOpener("vije",VILL1ST.replace("screen=overview","mode=attack&"+t+"screen=report"),AZON+"_SZEM4VIJE_1"),VIJE_LEPES=1}else e=1e4;break;case 1:isPageLoaded(VIJE_REF1,-1,"screen=report")?(VIJE_HIBA=0,VIJE_GHIBA=0,0===(PM2=szem4_VIJE_1kivalaszt())[0]?PM2[3]?VIJE_LEPES=3:(VIJE_LEPES=0,e=12e4):(VIJE_REF2=windowOpener("vije2",VILL1ST.replace("screen=overview","mode=attack&view="+PM2[0]+"&screen=report"),AZON+"_SZEM4VIJE_2"),VIJE_LEPES=2),VIJE_REF1.document.title="Szem4/vije1"):VIJE_HIBA++;break;case 2:isPageLoaded(VIJE_REF2,-1,PM2[0])?(clearAttacks(),VIJE2_HIBA=0,VIJE2_GHIBA=0,szem4_VIJE_2elemzes(PM2),VIJE_LEPES=PM2[3]?3:1,VIJE_REF2.document.title="Szem4/vije2"):VIJE2_HIBA++;break;case 3:szem4_VIJE_3torol(),VIJE_LEPES=0;break;default:VIJE_LEPES=0}}catch(e){debug("szem4_VIJE_motor()","ERROR: "+e+" Lépés:"+VIJE_LEPES)}var a=100/(40*Math.random()+80);e=Math.round(e*a);try{worker.postMessage({id:"vije",time:e})}catch(e){debug("vije","Worker engine error: "+e),setTimeout((function(){szem4_VIJE_motor()}),3e3)}}szem4_farmolo_motor(),ujkieg("vije","Jelentés Elemző",'<tr><td>A VIJE a Farmoló táblázatába dolgozik, itt csupán működési beállításokat módosíthatsz.<br><br><br>"Fatelep" a szerver jelenlegi nyelvén: <input type="text" size="15"  value="Fatelep"><br>"Agyagbánya" a szerver jelenlegi nyelvén: <input type="text" size="15"  value="Agyagbánya"><br>"Vasbánya" a szerver jelenlegi nyelvén: <input type="text" size="15" value="Vasbánya"><br>"Fal" a szerver jelenlegi nyelvén: <input type="text" size="15" value="Fal"><br><input type="checkbox"> Zöld farmjelentések törlése<br><br><br><i>Elemzett jelentések:</i><div id="VIJE_elemzett" style="font-size:30%;width:980px;word-wrap: break-word;"></div></td></tr>');var VIJE_REF1,VIJE_REF2,PM2,VIJE_PAUSE=!0,VIJE_LEPES=0,VIJE_HIBA=0,VIJE_GHIBA=0,VIJE2_HIBA=0,VIJE2_GHIBA=0,ALL_VIJE_SAVED={};function TamadUpdt(e){try{var t=document.getElementById("idtamad_Bejovok"),a=new Date,n=parseInt(e.game_data.player.incomings,10),l=0;if(t.rows.length>1&&(l=parseInt(t.rows[1].cells[1].innerHTML,10)),n==l)return;var r=t.insertRow(1),s=r.insertCell(0),o=r.insertCell(1);return s.innerHTML=a,o.innerHTML=n,void(n>l&&playSound("bejovo"))}catch(e){debug("ID beir","Hiba: "+e)}}function szem4_EPITO_perccsokkento(){try{for(var e=document.getElementById("epit").getElementsByTagName("table")[1].rows,t=/[0-9]+( perc)/g,a=0,n=1;n<e.length;n++)if(e[n].cells[3].textContent.search(t)>-1){if("0"==(a=e[n].cells[3].textContent.match(/[0-9]+/g)[0]))continue;a=parseInt(a,10),--a>0&&(1==(a+="").length&&(a="000"+a),2==a.length&&(a="00"+a),3==a.length&&(a="0"+a)),e[n].cells[3].innerHTML=e[n].cells[3].innerHTML.replace(/[0-9]+/,a)}}catch(e){debug("Építő_pcsökk",e),setTimeout("szem4_EPITO_perccsokkento()",6e4)}}function szem4_EPITO_getlista(){try{for(var e="<select>",t=document.getElementById("epit").getElementsByTagName("table")[0].rows,a=1;a<t.length;a++)e+='<option value="'+t[a].cells[0].textContent+'">'+t[a].cells[0].textContent+"</option> ";return e+="</select>"}catch(e){debug("Építő",e)}}function szem4_EPITO_csopDelete(e){try{var t=e.innerHTML;if(!confirm("Biztos kitörlöd a "+t+" nevű csoportot?\nA csoportot használó faluk az Alapértelmezett csoportba fognak tartozni."))return;sortorol(e,"");for(var a=document.getElementById("epit_lista").rows,n=1;n<a.length;n++){var l=a[n].cells[1].getElementsByTagName("select")[0];l.value==t&&(l.value=document.getElementById("epit").getElementsByTagName("table")[0].rows[1].cells[0].innerHTML)}a=document.getElementById("epit_ujfalu_adat").getElementsByTagName("option");for(n=0;n<a.length;n++)if(a[n].value==t){document.getElementById("epit_ujfalu_adat").getElementsByTagName("select")[0].remove(n);break}}catch(e){alert2("Hiba:\n"+e)}}function szem4_EPITO_ujFalu(){try{var e=document.getElementById("epit_ujfalu_adat"),t=e.getElementsByTagName("input")[0].value;if(""==t||null==t)return;t=t.match(/[0-9]{1,3}(\|)[0-9]{1,3}/g);for(var a=document.getElementById("epit_lista"),n="",l=szem4_EPITO_getlista(),r=0;r<t.length;r++){for(var s=!1,o=1;o<a.rows.length;o++)a.rows[o].cells[0].textContent==t[r]&&(s=!0);if(s)n+="DUP:"+t[r]+", ";else if(0!=koordTOid(t[r])){var i=a.insertRow(-1),c=i.insertCell(0);c.innerHTML=t[r],c.setAttribute("ondblclick","sortorol(this)"),(c=i.insertCell(1)).innerHTML=l,c.getElementsByTagName("select")[0].value=e.getElementsByTagName("select")[0].value,(c=i.insertCell(2)).style.fontSize="x-small";var m=new Date;c.innerHTML=m,c.setAttribute("ondblclick","szem4_EPITO_most(this)"),(c=i.insertCell(3)).innerHTML='<i>Feldolgozás alatt...</i> <a href="'+VILL1ST.replace(/(village=)[0-9]+/g,"village="+koordTOid(t[r]))+'" target="_BLANK"><img alt="Nyit" title="Falu megnyitása" src="'+pic("link.png")+'"></a>',c.setAttribute("ondblclick","szem4_EPITO_infoCell(this.parentNode,'alap',\"\")")}else n+="NL: "+t[r]+", "}return""!=n&&alert2("Dupla megadások/nem létező faluk kiszűrve: "+n),void(e.getElementsByTagName("input")[0].value="")}catch(e){alert2("Új falu(k) felvételekori hiba:\n"+e)}}function szem4_EPITO_ujCsop(){try{var e=document.getElementById("epit_ujcsopnev").value.replace(/[;\._]/g,"").replace(/( )+/g," ");if(""==e||null==e)return;for(var t=document.getElementById("epit").getElementsByTagName("table")[0],a=1;a<t.rows.length;a++)if(t.rows[a].cells[0].textContent==e)throw"Már létezik ilyen nevű csoport";var n=t.insertRow(-1),l=n.insertCell(0);l.innerHTML=e,l.setAttribute("ondblclick","szem4_EPITO_csopDelete(this)"),(l=n.insertCell(1)).innerHTML=t.rows[1].cells[1].innerHTML,l.getElementsByTagName("input")[0].disabled=!1;for(t=document.getElementById("epit_lista").rows,a=1;a<t.length;a++){var r=t[a].cells[1].getElementsByTagName("select")[0],s=document.createElement("option");s.text=e,r.add(s)}return r=document.getElementById("epit_ujfalu_adat").getElementsByTagName("select")[0],(s=document.createElement("option")).text=e,r.add(s),void(document.getElementById("epit_ujcsopnev").value="")}catch(e){alert2("Új csoport felvételekori hiba:\n"+e)}}function szem4_EPITO_cscheck(e){try{var t=e.parentNode.getElementsByTagName("input")[0].value;t=t.split(";");for(var a=new Array("main","barracks","stable","garage","church_f","church","smith","snob","place","statue","market","wood","stone","iron","farm","storage","hide","wall","MINES"),n=0;n<t.length;n++){if(!(a.indexOf(t[n].match(/[a-zA-Z]+/g)[0])>-1))throw"Nincs ilyen épület: "+t[n].match(/[a-zA-Z]+/g)[0];if(parseInt(t[n].match(/[0-9]+/g)[0])>30)throw"Túl magas épületszint: "+t[n]}alert2("Minden OK")}catch(e){alert2("Hibás lista:\n"+e)}}function szem4_EPITO_most(e){try{var t=new Date;return void(e.innerHTML=t)}catch(e){alert2("Hiba lépett fel:\n"+e)}}function szem4_EPITO_csopToList(e){try{for(var t=document.getElementById("epit").getElementsByTagName("table")[0].rows,a=1;a<t.length;a++)if(t[a].cells[0].textContent==e)return t[a].cells[1].getElementsByTagName("input")[0].value;return";"}catch(e){debug("epito_csopToList",e)}}function szem4_EPITO_Wopen(){try{for(var e=document.getElementById("epit_lista").rows,t=new Date,a=1;a<e.length;a++){if(new Date(e[a].cells[2].textContent)<t){var n=szem4_EPITO_csopToList(e[a].cells[1].getElementsByTagName("select")[0].value);return[koordTOid(e[a].cells[0].textContent),n,e[a]]}}return[0,";"]}catch(e){debug("Epito_Wopen",e)}}function szem4_EPITO_addIdo(e,t){try{if("del"==t)document.getElementById("epit_lista").deleteRow(e.rowIndex);else{var a=new Date;a.setMinutes(a.getMinutes()+Math.round(t)),e.cells[2].innerHTML=a}return!0}catch(e){return debug("epito_addIdo",e),!1}}function szem4_EPITO_infoCell(e,t,a){try{return"alap"==t&&(t="#f4e4bc"),"blue"==t&&(t="#44F"),"red"==t&&setTimeout('playSound("kritikus_hiba")',2e3),e.cells[3].style.backgroundColor=t,void(e.cells[3].innerHTML=a+' <a href="'+VILL1ST.replace(/(village=)[0-9]+/g,"village="+koordTOid(e.cells[0].textContent))+'" target="_BLANK"><img alt="Nyit" title="Falu megnyitása" src="'+pic("link.png")+'"></a>')}catch(e){debug("építő_infoCell",e)}}function szem4_EPITO_getBuildLink(e,t){var a=e.document.getElementById("main_buildrow_"+t);if(a.cells.length<3)return!1;for(var n=new RegExp("main_buildlink_"+t+"_[0-9]+","g"),l=a.getElementsByTagName("*"),r=0;r<l.length;r++)if(n.test(l[r].id))return l[r]}function szem4_EPITO_IntettiBuild(e){try{try{TamadUpdt(EPIT_REF)}catch(e){}try{for(var t,a=EPIT_REF.document.getElementById("buildqueue").rows,n="",l=0,r=0,s=1;s<a.length;s++)try{n+=a[s].cells[0].getElementsByTagName("img")[0].src.match(/[A-Za-z0-9]+\.(png)/g)[0].replace(/[0-9]+/g,"").replace(".png",""),t=a[s].cells[1].textContent.split(":"),l+=60*parseInt(t[0])+parseInt(t[1])+parseInt(t[2])/60,0==r&&(r=l),n+=";"}catch(e){}l=Math.round(l),"0"!=(l+="")&&(1==l.length&&(l="000"+l),2==l.length&&(l="00"+l),3==l.length&&(l="0"+l)),(r=r.toFixed(2)+1)>180&&(r=180)}catch(e){n=";",l=0,r=0}if(n.split(";").length>4)return szem4_EPITO_addIdo(PMEP[2],100),"overflow";var o=EPIT_REF.game_data.village.buildings,i=e.split(";"),c=new Array,m=new Array,d=(s=-2,n.split(";"));for(var g in o)if(-1!=++s){c[s]=o[g],m[s]=g;for(var u=0;u<d.length;u++)m[s]==d[u]&&(c[s]++,d[u]="")}var p="",E="",h=new Array(0,0,0);for(s=0;s<i.length;s++){E=i[s].split(" ")[0];for(var _=0;_<m.length;_++)if(m[_]==E){for(var y=0;y<parseInt(i[s].split(" ")[1])-c[_];y++)p+=E+";";parseInt(i[s].split(" ")[1])-c[_]>0&&(c[_]=parseInt(i[s].split(" ")[1]))}if("MINES"==E){for(_=0;_<m.length;_++)"wood"==m[_]&&(h[0]=_),"stone"==m[_]&&(h[1]=_),"iron"==m[_]&&(h[2]=_);for(_=0;_<=parseInt(i[s].split(" ")[1]);_++)for(y=0;y<3;y++)c[h[y]]<_&&(p+=y+";",c[h[y]]++);p=(p=(p=p.replace(/0/g,"wood")).replace(/1/g,"stone")).replace(/2/g,"iron")}if(""!=p){p.indexOf(";")>-1&&(p=p.split(";")[0]);break}}if(p.length<4)return naplo("Építő",'<a href="'+VILL1ST.replace(/(village=)[0-9]+/g,"village="+PMEP[0])+'" target="_BLANK">'+EPIT_REF.game_data.village.name+" ("+EPIT_REF.game_data.village.x+"|"+EPIT_REF.game_data.village.y+")</a> falu teljesen felépült és törlődött a listából"),setTimeout('playSound("falu_kesz")',1500),void szem4_EPITO_addIdo(PMEP[2],"del");var f,v=p;if(f=szem4_EPITO_getBuildLink(EPIT_REF,v))if("none"!==f.style.display)f.click(),playSound("epites"),szem4_EPITO_addIdo(PMEP[2],1),szem4_EPITO_infoCell(PMEP[2],"alap","Építés folyamatban.");else{var k=new Array(parseInt(EPIT_REF.document.getElementById("storage").textContent),parseInt(EPIT_REF.document.getElementById("pop_max_label").textContent)-parseInt(EPIT_REF.document.getElementById("pop_current_label").textContent));f=f.parentNode.parentNode.cells;var b=new Array(parseInt(f[1].textContent),parseInt(f[2].textContent),parseInt(f[3].textContent),parseInt(f[5].textContent)),I="";if(b[0]>k[0]||b[1]>k[0]||b[2]>k[0]?I="storage":b[3]>k[1]&&(I="farm"),""==I)return b[0]>EPIT_REF.game_data.village.wood||b[1]>EPIT_REF.game_data.village.stone||b[2]>EPIT_REF.game_data.village.iron?szem4_EPITO_infoCell(PMEP[2],"yellow","Nyersanyag hiány lépett fel. Építés még "+l+" percig."):n.split(";")[1].length>2?szem4_EPITO_infoCell(PMEP[2],"alap","Építési sor megtelt. Építés még "+l+" percig."):szem4_EPITO_infoCell(PMEP[2],"blue","Ismeretlen ok miatti állás. Építés még "+l+" percig."),void szem4_EPITO_addIdo(PMEP[2],r>0?r:30);if(I==v)szem4_EPITO_addIdo(PMEP[2],r>0?r:60);else if("farm"==I&&parseInt(EPIT_REF.game_data.village.buildings.farm)>=30){szem4_EPITO_addIdo(PMEP[2],180),szem4_EPITO_infoCell(PMEP[2],"blue","A tanya maxon, és megtelt.");for(s=0;s<e;s++)if("storage"==e.split(" ")[0]&&parseInt(e.split(" ")[1],10)>EPIT_REF.game_data.village.buildings.storage)try{szem4_EPITO_getBuildLink(EPIT_REF,"storage").click(),szem4_EPITO_addIdo(PMEP[2],60)}catch(e){}}else EPIT_REF.$("#main_buildlink_"+I).is(":visible")?szem4_EPITO_getBuildLink(EPIT_REF,I).click():(""!=n.split(";")[1]?szem4_EPITO_infoCell(PMEP[2],"alap","Tanyát vagy raktárat kéne húzni, de teli van a sor most. Építés még "+l+" percig."):szem4_EPITO_infoCell(PMEP[2],"yellow","Nyersanyag hiány!? Tanyát vagy raktárat kéne húzni, de nem tudom betenni. Építés még "+l+" percig."),szem4_EPITO_addIdo(PMEP[2],r>0?r:60))}else{s=-2;var T=!1;for(var g in o)if(-1!=++s&&g==v){T=!0;break}if(!T)throw szem4_EPITO_infoCell(PMEP[2],"red","Nem létező épületet ("+v+") akarsz építeni."),szem4_EPITO_addIdo(PMEP[2],60),naplo("Építő",'A(z) "'+PMEP[2].cells[1].getElementsByTagName("select")[0].value+'" nevű építési lista nem létező épületet tartalmaz!'),"Nem létező épület: "+v;if(!(r>0))throw szem4_EPITO_infoCell(PMEP[2],"red","A soron következő épülethez ("+v+") más épületek szükségeltetnek."),szem4_EPITO_addIdo(PMEP[2],60),naplo("Építő",'Előfeltételeknek nem megfelelő építési listát tartalmaz a(z) "'+PMEP[2].cells[1].getElementsByTagName("select")[0].value+'" építési lista!'),"Rossz építési lista";szem4_EPITO_infoCell(PMEP[2],"alap","Jelenleg előfeltétel épül."),r>0?szem4_EPITO_addIdo(PMEP[2],r):(debug("Építő","Anomália: H4f"),szem4_EPITO_addIdo(PMEP[2],60))}return}catch(e){debug("epit_IntelliB",e)}}function szem4_EPITO_motor(){try{var e=2e3;if(BOT||EPIT_PAUSE)e=5e3;else switch(EPIT_HIBA>10&&(EPIT_HIBA=0,++EPIT_GHIBA>3&&(EPIT_GHIBA>5&&(naplo("Globál","Nincs internet? Folyamatos hiba az építőnél"),e=6e4,playSound("bot2")),EPIT_REF.close()),EPIT_LEPES=0),EPIT_LEPES){case 0:(PMEP=szem4_EPITO_Wopen())[0]>0?(EPIT_REF=windowOpener("epit",VILL1ST.replace("screen=overview","screen=main").replace(/village=[0-9]+/,"village="+PMEP[0]),AZON+"_SZEM4EPIT"),EPIT_LEPES=1):e=1==document.getElementById("epit_lista").rows.length?5e3:6e4,EPIT_REF.document.title="szem4/építő";break;case 1:isPageLoaded(EPIT_REF,PMEP[0],"screen=main")?(EPIT_HIBA=0,EPIT_GHIBA=0,szem4_EPITO_IntettiBuild(PMEP[1])):EPIT_HIBA++,EPIT_LEPES=0;break;default:EPIT_LEPES=0}}catch(e){debug("Epito motor",e),EPIT_LEPES=0}var t=100/(40*Math.random()+80);e=Math.round(e*t);try{worker.postMessage({id:"epit",time:e})}catch(e){debug("epit","Worker engine error: "+e),setTimeout((function(){szem4_EPITO_motor()}),3e3)}}szem4_VIJE_motor(),ujkieg_hang("Bejövő támadások","bejovo"),ujkieg("idtamad","Bejövő támadások",'<tr><td align="center" ><table class="vis" id="idtamad_Bejovok" style="vertical-align:top; display: inline-block;"><tr><th>Időpont</th><th>Támadások száma</th></tr></table> </td></tr>'),ujkieg_hang("Építő","epites;falu_kesz;kritikus_hiba"),ujkieg("epit","Építő",'<tr><td><h2 align="center">Építési listák</h2><table align="center" class="vis" style="border:1px solid black;color: black;"><tr><th onmouseover=\'sugo(this,"Építési lista neve, amire később hivatkozhatunk")\'>Csoport neve</th><th onmouseover=\'sugo(this,"Az építési sorrend megadása. Saját lista esetén ellenőrizzük az OK? linkre kattintva annak helyességét!")\' style="width:800px">Építési lista</th></tr><tr><td>Alapértelmezett</td><td><input type="text" disabled="disabled" value="main 10;storage 10;wall 10;main 15;wall 15;storage 15;farm 10;main 20;wall 20;MINES 10;smith 5;barracks 5;stable 5;main 15;storage 20;farm 20;market 10;main 22;smith 12;farm 25;storage 28;farm 26;MINES 24;market 19;barracks 15;stable 10;garage 5;MINES 26;farm 28;storage 30;barracks 20;stable 15;farm 30;barracks 25;stable 20;MINES 30;smith 20;snob 1" size="125"><a onclick="szem4_EPITO_cscheck(this)" style="color:blue; cursor:pointer;"> OK?</a></td></tr></table><p align="center">Csoportnév: <input type="text" value="" size="30" id="epit_ujcsopnev" placeholder="Nem tartalmazhat . _ ; karaktereket"> <a href="javascript: szem4_EPITO_ujCsop()" style="color:white;text-decoration:none;"><img src="'+pic("plus.png")+' " height="17px"> Új csoport</a></p></td></tr><tr><td><h2 align="center">Építendő faluk</h2><table align="center" class="vis" style="border:1px solid black;color: black;width:900px" id="epit_lista"><tr><th style="width: 75px; cursor: pointer;" onclick=\'rendez("szoveg",false,this,"epit_lista",0)\' onmouseover=\'sugo(this,"Rendezhető. Itt építek. Dupla klikk a falura = sor törlése")\'>Falu koord.</th><th onclick=\'rendez("lista",false,this,"epit_lista",1)\' onmouseover=\'sugo(this,"Rendezhető. Felső táblázatban használt lista közül választhatsz egyet, melyet később bármikor megváltoztathatsz.")\' style="width: 135px; cursor: pointer">Használt lista</th><th style="width: 220px; cursor: pointer;" onclick=\'rendez("datum",false,this,"epit_lista",2)\' onmouseover=\'sugo(this,"Rendezhető. Ekkor fogom újranézni a falut, hogy lehet e már építeni.<br>Dupla klikk=idő azonnalira állítása.")\'>Return</th><th style="cursor: pointer;" onclick=\'rendez("szoveg",false,this,"epit_lista",3)\' onmouseover=\'sugo(this,"Rendezhető. Szöveges információ a faluban zajló építésről. Sárga hátterű szöveg orvosolható; kék jelentése hogy nem tud haladni; piros pedig kritikus hibát jelöl; a szín nélküli a normális működést jelzi.<br>Dupla klikk=alaphelyzet")\'><u>Infó</u></th></tr></table><p align="center" id="epit_ujfalu_adat">Csoport:  <select><option value="Alapértelmezett">Alapértelmezett</option> </select> Faluk: <input type="text" value="" placeholder="Koordináták: 123|321 123|322 ..." size="50"> <a href="javascript: szem4_EPITO_ujFalu()" style="color:white;text-decoration:none;"><img src="'+pic("plus.png")+'" height="17px"> Új falu(k)</a></p></td></tr>');var EPIT_REF,PMEP,EPIT_LEPES=0,EPIT_HIBA=0,EPIT_GHIBA=0,EPIT_PAUSE=!1;function szem4_ADAT_saveNow(e){switch(e){case"farm":szem4_ADAT_farm_save();break;case"epito":szem4_ADAT_epito_save();break;case"sys":szem4_ADAT_sys_save()}}function szem4_ADAT_restart(e){switch(e){case"farm":localStorage.setItem(AZON+"_farm","3600.4.0.3600.1.false.false.100.10.500.90;;;;;;"),szem4_ADAT_farm_load();break;case"epito":localStorage.setItem(AZON+"_epito","__"),szem4_ADAT_epito_load();break;case"sys":localStorage.setItem(AZON+"_sys","Fatelep.Agyagbánya.Vasbánya.Fal.false;false.false.false;http://www youtube com/watch?v=k2a30--j37Q.true.true.true.true.true.true;"),szem4_ADAT_sys_load()}}function szem4_ADAT_StopAll(){for(var e=document.getElementById("adat_opts").rows,t=1;t<e.length;t++)e[t].cells[0].getElementsByTagName("input")[0].checked=!1}function szem4_ADAT_LoadAll(){szem4_ADAT_farm_load(),szem4_ADAT_epito_load(),szem4_ADAT_sys_load()}function szem4_ADAT_sys_save(){try{for(var e="",t=document.getElementById("vije").getElementsByTagName("input"),a=0;a<t.length;a++)"checkbox"==t[a].getAttribute("type")?t[a].checked?e+="true":e+="false":e+=t[a].value,a<t.length-1&&(e+=".");e+="."+JSON.stringify(ALL_VIJE_SAVED),e+=";";for(t=document.getElementById("adatok").getElementsByTagName("input"),a=0;a<t.length;a++)t[a].checked?e+="true":e+="false",a<t.length-1&&(e+=".");e+=";";for(t=document.getElementById("hang").getElementsByTagName("input"),a=0;a<t.length;a++)"checkbox"==t[a].getAttribute("type")?t[a].checked?e+="true":e+="false":e+=t[a].value.replace(/\./g," ").replace(/;/g,"  "),a<t.length-1&&(e+=".");e+=";",localStorage.setItem(AZON+"_sys",e);var n=new Date;return void(document.getElementById("adat_opts").rows[3].cells[2].textContent=n)}catch(e){debug("ADAT_sys_save",e)}}function szem4_ADAT_farm_save(){try{for(var e,t="",a=document.getElementById("farm_opts").rows[2].cells[1].getElementsByTagName("input"),n=0;n<a.length;n++)"checkbox"==a[n].type?a[n].checked?t+="true":t+="false":t+=a[n].value,n<a.length-1&&(t+=".");t+=";",a=document.getElementById("farm_honnan").rows;for(n=1;n<a.length;n++)t+=a[n].cells[0].textContent,n<a.length-1&&(t+=".");t+=";";for(n=1;n<a.length;n++){e=a[n].cells[1].getElementsByTagName("input");for(var l=0;l<e.length;l++)e[l].checked?t+="true":t+="false",l<e.length-1&&(t+="-");n<a.length-1&&(t+=".")}t+=";",a=document.getElementById("farm_hova").rows;for(n=1;n<a.length;n++)t+=a[n].cells[0].textContent,"red"==a[n].cells[0].style.backgroundColor&&(t+="R"),n<a.length-1&&(t+=".");t+=";";for(n=1;n<a.length;n++)t+=a[n].cells[1].textContent,n<a.length-1&&(t+=".");t+=";";for(n=1;n<a.length;n++)t+=a[n].cells[2].textContent,n<a.length-1&&(t+=".");t+=";";for(n=1;n<a.length;n++)a[n].cells[4].getElementsByTagName("input")[0].checked?t+="true":t+="false",n<a.length-1&&(t+=".");t+=";"+JSON.stringify(ALL_UNIT_MOVEMENT),t+=";"+JSON.stringify(ALL_SPY_MOVEMENTS),t+=";";for(n=1;n<a.length;n++)t+=a[n].cells[3].textContent,n<a.length-1&&(t+=".");localStorage.setItem(AZON+"_farm",t);var r=new Date;return void(document.getElementById("adat_opts").rows[1].cells[2].textContent=r)}catch(e){debug("ADAT_farm_save",e)}}function szem4_ADAT_epito_save(){try{for(var e="",t=document.getElementById("epit").getElementsByTagName("table")[0].rows,a=2;a<t.length;a++)e+=t[a].cells[0].textContent+"-"+t[a].cells[1].getElementsByTagName("input")[0].value,a<t.length-1&&(e+=".");e+="_",t=document.getElementById("epit").getElementsByTagName("table")[1].rows;for(a=1;a<t.length;a++)e+=t[a].cells[0].textContent,a<t.length-1&&(e+=".");e+="_";for(a=1;a<t.length;a++)e+=t[a].cells[1].getElementsByTagName("select")[0].value,a<t.length-1&&(e+=".");localStorage.setItem(AZON+"_epito",e);var n=new Date;return void(document.getElementById("adat_opts").rows[2].cells[2].textContent=n)}catch(e){debug("ADAT_epito_save",e)}}function szem4_ADAT_farm_load(){try{if(!localStorage.getItem(AZON+"_farm"))return;for(var e=localStorage.getItem(AZON+"_farm"),t=document.getElementById("farm_opts").rows[2].cells[1].getElementsByTagName("input"),a=e.split(";")[0].split("."),n=0;n<a.length;n++)"true"==a[n]?t[n].checked=!0:"false"==a[n]?t[n].checked=!1:t[n].value=a[n];for(n=(t=document.getElementById("farm_honnan")).rows.length-1;n>0;n--)t.deleteRow(n);for(n=(t=document.getElementById("farm_hova")).rows.length-1;n>0;n--)t.deleteRow(n);document.getElementById("farm_opts").rows[1].cells[0].getElementsByTagName("input")[0].value=e.split(";")[1],document.getElementById("farm_opts").rows[2].cells[0].getElementsByTagName("input")[0].checked=!0,add_farmolo(),document.getElementById("farm_opts").rows[1].cells[1].getElementsByTagName("input")[0].value=e.split(";")[3],add_farmolando(),setTimeout((function(){try{var e=localStorage.getItem(AZON+"_farm"),t=e.split(";")[0].split("."),a=document.getElementById("farm_honnan").rows;t=e.split(";")[2].split(".");for(var n=0;n<t.length;n++)for(var l=a[n+1].cells[1].getElementsByTagName("input"),r=0;r<t[n].split("-").length;r++)"true"==t[n].split("-")[r]?l[r].checked=!0:l[r].checked=!1;a=document.getElementById("farm_hova").rows,t=e.split(";")[2].split(".");for(n=0;n<t.length;n++)t[n].indexOf("R")>0&&(a[n+1].cells[0].style.backgroundColor="red");t=e.split(";")[4].split(".");for(n=0;n<t.length;n++)a[n+1].cells[1].textContent=t[n];t=e.split(";")[5].split(".");for(n=0;n<t.length;n++)a[n+1].cells[2].textContent=t[n];t=e.split(";")[6].split(".");for(n=0;n<t.length;n++)"true"==t[n]?a[n+1].cells[4].getElementsByTagName("input")[0].checked=!0:a[n+1].cells[4].getElementsByTagName("input")[0].checked=!1;if(t=e.split(";")[7],ALL_UNIT_MOVEMENT=t&&t.length>5?JSON.parse(t):{},t=e.split(";")[8],ALL_SPY_MOVEMENTS=t&&t.length>5?JSON.parse(t):{},t=e.split(";")[9]){t=t.split(".");for(n=0;n<t.length;n++)a[n+1].cells[3].textContent=t[n]}document.getElementById("farm_opts").rows[2].cells[0].getElementsByTagName("input")[0].checked=!1,alert2("Farmolási adatok betöltése kész.")}catch(e){alert("ERROR_LOAD\n"+e)}}),1e3)}catch(e){debug("ADAT_farm_load",e)}}function szem4_ADAT_epito_load(){try{if(!localStorage.getItem(AZON+"_epito"))return;for(var e=localStorage.getItem(AZON+"_epito"),t=(a=document.getElementById("epit").getElementsByTagName("table")[0]).rows.length-1;t>1;t--)a.deleteRow(t);var a;for(t=(a=document.getElementById("epit").getElementsByTagName("table")[1]).rows.length-1;t>0;t--)a.deleteRow(t);for(a=document.getElementById("epit_ujfalu_adat").getElementsByTagName("select")[0];a.length>1;)a.remove(1);a=e.split("_")[0].split(".");for(t=0;t<a.length;t++)document.getElementById("epit_ujcsopnev").value=a[t].split("-")[0],szem4_EPITO_ujCsop(),document.getElementById("epit").getElementsByTagName("table")[0].rows[t+2].cells[1].getElementsByTagName("input")[0].value=a[t].split("-")[1];a=e.split("_")[1].split("."),document.getElementById("epit_ujfalu_adat").getElementsByTagName("input")[0].value=a,szem4_EPITO_ujFalu(),a=e.split("_")[2].split(".");var n=document.getElementById("epit").getElementsByTagName("table")[1].rows;for(t=0;t<a.length;t++)n[t+1].cells[1].getElementsByTagName("select")[0].value=a[t];return void alert2("Építési adatok betöltése kész.")}catch(e){debug("ADAT_epito_load",e)}}function szem4_ADAT_sys_load(){try{if(!localStorage.getItem(AZON+"_sys"))return;for(var e=localStorage.getItem(AZON+"_sys"),t=document.getElementById("vije").getElementsByTagName("input"),a=e.split(";")[0].split("."),n=0;n<a.length-1;n++)"true"==a[n]?t[n].checked=!0:"false"==a[n]?t[n].checked=!1:t[n].value=a[n];ALL_VIJE_SAVED=JSON.parse(a[a.length-1]);for(t=document.getElementById("adat_opts").getElementsByTagName("input"),a=e.split(";")[1].split("."),n=0;n<a.length;n++)"true"==a[n]?t[n].checked=!0:"false"==a[n]&&(t[n].checked=!1);t=document.getElementById("hang").getElementsByTagName("input"),a=e.split(";")[2].split(".");t[0].value=a[0].replace(/\s\s/g,";").replace(/\s/g,".");for(n=1;n<a.length;n++)"true"==a[n]?t[n].checked=!0:"false"==a[n]&&(t[n].checked=!1);alert2("Rendszereadatok betöltése kész.")}catch(e){debug("ADAT_epito_sys",e)}}function szem4_ADAT_del(e){try{if(!confirm("Biztos törli a(z) "+e+" összes adatát?"))return;return void(localStorage.getItem(AZON+"_"+e)?(localStorage.removeItem(AZON+"_"+e),alert2(e+": Törlés sikeres")):alert2(e+": Nincs lementett adat"))}catch(e){debug("ADAT_epito_load",e)}}function szem4_ADAT_kiir(e){try{return void(localStorage.getItem(AZON+"_"+e)?alert2("<textarea onmouseover='this.select()' onclick='this.select()' cols='38' rows='30'>"+localStorage.getItem(AZON+"_"+e)+"</textarea>"):alert2("Nincs lementett adat"))}catch(e){debug("szem4_ADAT_kiir",e)}}function szem4_ADAT_betolt(e){try{var t=prompt("Adja meg a korábban SZEM4 ÁLTAL KIÍRT ADATOT, melyet be kíván tölteni.\n\n Ne próbálj kézileg beírni ide bármit is. Helytelen adat megadását SZEM4 nem tudja kezelni, az ebből adódó működési rendellenesség csak RESET-eléssel állítható helyre.");if(null==t||""==t)return;localStorage.setItem(AZON+"_"+e,t),"farm"==e&&szem4_ADAT_farm_load(),"epito"==e&&szem4_ADAT_epito_load(),alert2("Az adatok sikeresen betöltődtek.")}catch(e){debug("szem4_ADAT_betolt",e)}}function szem4_ADAT_motor(){try{if(!ADAT_PAUSE)if(ADAT_FIRST)ADAT_FIRST=!1;else{var e=document.getElementById("adat_opts").rows;e[1].cells[0].getElementsByTagName("input")[0].checked&&szem4_ADAT_farm_save(),e[2].cells[0].getElementsByTagName("input")[0].checked&&szem4_ADAT_epito_save(),e[3].cells[0].getElementsByTagName("input")[0].checked&&szem4_ADAT_sys_save()}}catch(e){debug("ADAT_motor",e)}try{worker.postMessage({id:"adatok",time:6e4})}catch(e){debug("adatok","Worker engine error: "+e),setTimeout((function(){szem4_ADAT_motor()}),3e3)}}function szem4_ADAT_AddImageRow(e){return'\t<img title="Jelenlegi adat betöltése" alt="Betölt" onclick="szem4_ADAT_'+e+'_load()" width="17px" src="'+pic("load.png")+'"> \t<img title="Törlés" alt="Töröl" onclick="szem4_ADAT_del(\''+e+'\')" src="'+pic("del.png")+'" width="17px""> \t<img title="Jelenlegi adat kiiratása" alt="Export" onclick="szem4_ADAT_kiir(\''+e+'\')" width="17px" src="'+pic("Export.png")+'"> \t<img title="Saját adat betöltése" alt="Import" onclick="szem4_ADAT_betolt(\''+e+'\')" width="17px" src="'+pic("Import.png")+'"> \t<img title="Mentés MOST" alt="Save" onclick="szem4_ADAT_saveNow(\''+e+'\')" width="17px" src="'+pic("saveNow.png")+'">\t<img title="Reset: Helyreállítás" alt="Reset" onclick="szem4_ADAT_restart(\''+e+'\')" width="17px" src="'+pic("reset.png")+'">'}szem4_EPITO_motor(),szem4_EPITO_perccsokkento(),ujkieg("adatok","Adatmentő",'<tr><td><p align="center"><b>Figyelem!</b> Az adatmentő legelső elindításakor betölti a lementett adatokat (ha van), nem törődve azzal, hogy jelenleg mi a munkafolyamat.<br>Új adatok használatához az adatmentő indítása előtt használd a törlést a lenti táblázatból.</p><table class="vis" id="adat_opts" style="width:100%; margin-bottom: 50px;"><tr><th style="width:105px">Engedélyezés</th><th style="width:118px">Kiegészítő neve</th><th style="width:250px">Utolsó mentés ideje</th><th  style="width:93px">Adat kezelése</th></tr><tr><td><input type="checkbox" checked></td><td>Farmoló</td><td></td><td>'+szem4_ADAT_AddImageRow("farm")+'</td></tr><tr><td><input type="checkbox" checked></td><td>Építő</td><td></td><td>'+szem4_ADAT_AddImageRow("epito")+'</td></tr><tr><td><input type="checkbox" checked></td><td>VIJE,Adatmentő,Hangok</td><td></td><td>'+szem4_ADAT_AddImageRow("sys")+'</td></tr></table><p align="center"></p></td></tr>');var ADAT_PAUSE=!1,ADAT_FIRST=!0;confirm("Engedélyezed az adatok mentését?\nKésőbb elindíthatja, ha visszapipálja a mentés engedélyezését - ekkor szükséges kézi adatbetöltés is előtte.")?szem4_ADAT_LoadAll():szem4_ADAT_StopAll(),szem4_ADAT_motor(),$(document).ready((function(){nyit("naplo"),vercheck(),naplo("Indulás","SZEM 4.5 elindult."),naplo("Indulás","Farmolók szünetelő módban."),soundVolume(0),playSound("bot2"),setTimeout((function(){soundVolume(1)}),2e3),$((function(){$("#alert2").draggable({handle:$("#alert2head")}),$("#sugo").mouseover((function(){sugo(this,"Ez itt a súgó")})),$("#fejresz").mouseover((function(){sugo(this,"")}))})),$("#farm_opts input").on("keydown keypress",(function(){setTimeout("shorttest()",20)}))}));

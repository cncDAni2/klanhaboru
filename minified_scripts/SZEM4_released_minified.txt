function stop(){for(var t=setTimeout("",100),e=0;e<t;e++)clearTimeout(e)}function loadXMLDoc(t){return window.XMLHttpRequest?xhttp=new XMLHttpRequest:xhttp=new ActiveXObject("Microsoft.XMLHTTP"),xhttp.open("GET",t,!1),xhttp.send(),xhttp.responseXML}stop(),document.getElementsByTagName("html")[0].setAttribute("class",""),void 0!==AZON&&(alert("Itt m√°r fut SZEM. \n Ha ez nem igaz, nyitsd meg √∫j lapon a j√°t√©kot, √©s pr√≥b√°ld meg ott futtatni"),exit());var SUGOORA,VERZIO="v4.5 Build 23.08.27",SZEM4_SETTINGS={},TIME_ZONE=0;try{var AZON="S0";window.name.indexOf(AZON)>-1&&(AZON="S1");var BASE_URL=document.location.href.split("game.php")[0],CONFIG=loadXMLDoc(BASE_URL+"interface.php?func=get_config"),SPEED=parseFloat(CONFIG.getElementsByTagName("speed")[0].textContent),UNIT_S=parseFloat(CONFIG.getElementsByTagName("unit_speed")[0].textContent),MOBILE_MODE=!1,KTID=[],TERMELES=[5,30,35,41,47,55,64,74,86,100,117,136,158,184,214,249,289,337,391,455,530,616,717,833,969,1127,1311,1525,1774,2063,2400],UNITS=["spear","sword","axe","archer","spy","light","marcher","heavy"],TEHERARR=[25,15,10,10,0,80,50,50],TEHER={spear:25,sword:15,axe:10,archer:10,spy:0,light:80,marcher:50,heavy:50},TANYAARR=[1,1,1,1,2,4,5,6],TANYA={spear:1,sword:1,axe:1,archer:1,spy:2,light:4,marcher:5,heavy:6},E_SEB_ARR=[18,22,18,18,9,10,10,11],E_SEB={spear:18,sword:22,axe:18,archer:18,spy:9,light:10,marcher:10,heavy:11},VILL1ST="",MAX_IDO_PERC=20;AZON=game_data.player.id+"_"+game_data.world+AZON;var USER_ACTIVITY_TIMEOUT,CLOUD_AUTHS=localStorage.getItem("szem_firebase"),USER_ACTIVITY=!1,worker=createWorker((function(t){t.TIMERS={},t.addEventListener("message",(function(e){"stopTimer"==e.data.id?clearTimeout(t.TIMERS[e.data.value]):t.TIMERS[e.data.id]=setTimeout((()=>{postMessage(e.data)}),e.data.time)}),!1)}));function createWorker(t){var e=new Blob(["("+t.toString()+")(self)"],{type:"text/javascript"});return new Worker(window.URL.createObjectURL(e))}worker.onmessage=function(t){switch((t=t.data).id){case"farm":szem4_farmolo_motor();break;case"vije":szem4_VIJE_motor();break;case"epit":szem4_EPITO_motor();break;case"adatok":szem4_ADAT_motor();break;default:debug("worker","Ismeretlen ID",JSON.stringify(t))}}}catch(t){alert("SZEM Nem tud elindulni/n"+t),exit(0)}function vercheck(){try{naplo("Glob√°l","Verzi√≥ ["+VERZIO+"] legfrissebb √°llapotban, GIT-r≈ël szedve. ")}catch(t){alert2(t)}}function init(){try{if(getServerTime(window,!0),document.getElementById("production_table"))var t=document.getElementById("production_table");else if(document.getElementById("combined_table"))t=document.getElementById("combined_table");else if(document.getElementById("buildings_table"))t=document.getElementById("buildings_table");else{if(!document.getElementById("techs_table"))return alert("Ilyen n√©zetbe val√≥ futtat√°s nem t√°mogatott. K√≠s√©rlet az √°ttekint√©s bet√∂lt√©s√©re...\n\nLaunching from this view is not supported. Trying to load overview..."),document.location.href=document.location.href.replace(/screen=[a-zA-Z]+/g,"screen=overview_villages"),!1;t=document.getElementById("techs_table")}var e=new RegExp(/[0-9]+(\|)[0-9]+/);if(e.test(t.rows[1].cells[0].textContent))var n=0;else if(e.test(t.rows[1].cells[1].textContent))n=1;else{if(!e.test(t.rows[1].cells[2].textContent))return alert("Nem tal√°lok koordin√°t√°kat ebbe a list√°ba.\n\nI can not find coordinates in this view."),!1;n=2}VILL1ST=t.rows[1].cells[n].getElementsByTagName("a")[0].href;for(var a=1;a<t.rows.length;a++){var l=t.rows[a].cells[n].textContent.match(/[0-9]+(\|)[0-9]+/g);l=l[l.length-1],KTID[a-1]=l+";"+t.rows[a].cells[n].getElementsByTagName("span")[0].getAttribute("data-id").match(/[0-9]+/g)[0]}const o='\n\t\tbody { background: #111; scrollbar-width: none; padding-bottom: 0; }\n\t\tbody::-webkit-scrollbar { width: 0; }\n\t\t#content > table { box-shadow: 0 0 12px black; min-height: 100vh; }\n\t\t#side-notification-container {\n\t\t\tpointer-events: none;\n\t\t\tdisplay: none;\n\t\t}\n\t\t#alert2 {\n\t\t\twidth: 300px;\n\t\t\tbackground-color: #0d47a1;\n    \t\tcolor: #FFF;\n\t\t\tposition: fixed;\n\t\t\tleft:40%;\n\t\t\ttop:40%;\n\t\t\tfont-size: 11pt;\n\t\t\tpadding: 5px;\n\t\t\tz-index: 200;\n\t\t\tborder-radius: 5px;\n\t\t\tbox-shadow: black 0 0 7px;\n\t\t\tdisplay: none;\n\t\t\tanimation: blinkingalert 0.5s infinite;\n\t\t}\n\t\t@keyframes blinkingalert {\n\t\t\t0% {\n\t\t\t\tbox-shadow: #0d47a1 0 0 0px;\n\t\t\t}\n\t\t\t100% {\n\t\t\t\tbox-shadow: #0d47a1 0 0 20px;\n\t\t\t}\n\t\t}\n\t\t#alert2head {\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: space-between;\n\t\t\twidth: 100%;\n\t\t\tcursor: all-scroll;\n\t\t\tbackground: rgba(255,255,255,0.1);\n\t\t\tmargin: -5px;\n\t\t\tpadding: 5px;\n\t\t\tfont-weight: bold;\n\t\t\theight: 20px;\n\t\t}\n\t\t#alert2head a {\n\t\t\tpadding: 10px 0 10px 10px;\n\t\t}\n\t\t#kiegs img {\n\t\t\tcursor: pointer;\n\t\t}\n\t\t.fej {\n\t\t\twidth: 1024px;\n\t\t\tmargin:auto;\n\t\t\tcolor: white;\n\t\t\tposition: relative;\n\t\t\tbox-shadow: 0 0 12px black;\n\t\t}\n\t\t.fej a {\n\t\t\tcolor: white;\n\t\t}\n\t\t.fej > table {\n\t\t\tpadding:1px;\n\t\t\tborder: 1px solid yellow;\n\t\t}\n\t\t#global_notifications {\n\t\t\tposition: absolute;\n\t\t\ttop: 0;\n\t\t\tleft: -22px;\n\t\t\twidth: 18px;\n\t\t}\n\t\t#global_notifications img { width: 18px; }\n\t\t#global_notifications img.rotate { animation: rotation 2s infinite linear; }\n\t\t@keyframes rotation {\n\t\t\tfrom {\n\t\t\t\ttransform: rotate(0deg);\n\t\t\t}\n\t\t\tto {\n\t\t\t\ttransform: rotate(360deg);\n\t\t\t}\n\t\t}\n\t\ttable.menuitem {\n\t\t\tvertical-align:top;\n\t\t\ttext-align: top;\n\t\t\tpadding: 20px;\n\t\t\tmargin:auto;\n\t\t\tcolor: white;\n\t\t\tborder: 1px solid yellow;\n\t\t}\n\t\ttable.menuitem td {\n\t\t\tpadding: 0px;\n\t\t\tvertical-align:top;\n\t\t}\n\t\ttable {\n\t\t\tpadding: 0px;\n\t\t\tmargin: auto;\n\t\t\tcolor: white;\n\t\t}\n\t\ttable.vis { color:black; }\n\t\ttable.vis td, table.vis th { padding: 3px 6px 3px 6px; }\n\t\t#farm_honnan tr td:last-child {\n\t\t\tfont-size: 60%;\n\t\t\twidth: 130px;\n\t\t}\n\t\t#farm_hova > tbody > tr > td:last-child {\n\t\t\twidth: 135px;\n\t\t}\n\t\ttextarea {\n\t\t\tbackground-color: #020;\n\t\t\tcolor:white;\n\t\t}\n\t\t.divrow { display: flex; align-items: center; }\n\t\t.divcell {\n\t\t\tdisplay: table-cell;\n\t\t\ttext-align: center;\n\t\t\tvertical-align:top;\n\t\t}\n\t\ta { color: white; }\n\t\timg{\n\t\t\tborder-color: grey;\n\t\t\tpadding:1px;\n\t\t}\n\t\t#naploka a { color:blue; }\n\t\tinput[type="button"] {\n\t\t\tfont-size:13px;\n\t\t\tfont-family: Century Gothic, sans-serif;\n\t\t\tcolor:#FFFF77;\n\t\t\tbackground-color:#3366CC;\n\t\t\tborder-style: ridge;\n\t\t\tborder-color:#000000;\n\t\t\tborder-width:3px;\n\t\t}\n\t\t.szem4_vije_optsTable {\n\t\t\tmargin: initial;\n\t\t\tborder-collapse: separate;\n\t\t\tborder-spacing: 0px 7px;\n\t\t}\n\t\t.szem4_vije_optsTable input {\n\t\t\tfont-size: 10pt;\n\t\t}\n\t\t#vije_opts input[type="checkbox"] { width: 17px; height: 17px; }\n\n\t\t.tooltip-wrapper { display: flex; flex-wrap: wrap; gap: 10px 0; }\n\t\t.tooltip-wrapper img { padding-left: 2px; padding-right: 0; display: table-cell; }\n\t\t.tooltip_hover { position: relative; display: table; border-collapse: collapse; }\n\t\t.tooltip_text {\n\t\t\tposition: absolute; z-index: 1; left: 50%; bottom: 100%; transform: translateX(-50%); white-space: nowrap; font-style: normal; background: gray; padding: 5px 8px; border-radius: 3px; margin-bottom: 5px; color: white; display: none; border: 1px solid black;\n\t\t}\n\t\t.bottom-tooltip .tooltip_text { top: 100%; bottom: auto; }\n\t\t.tooltip_text:after { content: ""; position: absolute; top: 100%; left: 50%; transform: translateX(-50%); border-top: 5px solid gray; border-left: 5px solid transparent; border-right: 5px solid transparent }\n\t\t.bottom-tooltip .tooltip_text:after { top: auto; bottom: 100%; border-bottom: 5px solid gray; border-top: 5px solid transparent; }\n\t\ttable.no-bg-table td {\n\t\t\tvertical-align: middle;\n\t\t\tbackground: transparent;\n\t\t}\n\t\ttable.no-bg-table td .flex_middle {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t}\n\t\t.szem4_unitbox {\n\t\t\tdisplay: inline-block;\n\t\t\tposition: relative;\n\t\t\tborder-radius: 5px;\n\t\t}\n\t\t.szem4_unitbox.szem4_unitbox_not_available::before {\n\t\t\tcontent: "";\n\t\t\tposition: absolute;\n\t\t\ttop: 50%;\n\t\t\tleft: 0;\n\t\t\tright: 0;\n\t\t\tborder-top: 2px solid rgba(255,0,0,0.5);\n\t\t\tpointer-events: none;\n\t\t\ttransform: rotate(20deg);\n\t\t}\n\t\t.szem4_unitbox label {\n\t\t\tcursor: pointer;\n\t\t\tdisplay: block;\n\t\t}\n\t\t.szem4_unitbox label:hover {\n\t\t\tbackground: rgba(0,0,0,0.2);\n\t\t}\n\t\t.szem4_unitbox input {\n\t\t\tcursor: pointer;\n\t\t\tmargin-left: -2px;\n\t\t\tmargin-right: 3px;\n\t\t}\n\t\t.szem4_farmolo_datatable_wrapper {\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: space-between;\n\t\t}\n\t\t.szem4_farmolo_datatable_wrapper table {\n\t\t\tmargin: 0;\n\t\t}\n\t\t.nopadding_td {\n\t\t\tpadding: 0 !important;\n\t\t}\n\t\t.heartbeat_wrapper {\n\t\t\theight: 18px;\n\t\t\twidth: 100%;\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: center;\n\t\t\talign-items: center;\n\t\t}\n\t\t.heartbeat_icon {\n\t\t\theight: 15px;\n\t\t\tpadding: 0 2px;\n\t\t\tmargin-right: 5px;\n\t\t\tanimation: heartbeatanimation 1.0s infinite;\n\t\t\tcursor: pointer\n\t\t}\n\t\t@keyframes heartbeatanimation {\n\t\t\t0% {\n\t\t\t\theight: 15px;\n\t\t\t\tpadding: 0 2px;\n\t\t\t}\n\t\t\t33% {\n\t\t\t\theight: 15px;\n\t\t\t\tpadding: 0 2px;\n\t\t\t}\n\t\t\t50% {\n\t\t\t\theight: 19px;\n\t\t\t\tpadding: 0;\n\t\t\t}\n\t\t\t66% {\n\t\t\t\theight: 15px;\n\t\t\t\tpadding: 0 2px;\n\t\t\t}\n\t\t}\n\t\t#farmolo_options table {\n\t\t\tcolor: black;\n\t\t\ttext-align: left;\n\t\t}\n\t\t#farmolo_options table td,\n\t\t#vije_opts table.szem4_vije_optsTable td {\n\t\t\tvertical-align: middle;\n\t\t}\n\t\t#farmolo_options table td:first-child {\n\t\t\tpadding: 0;\n\t\t}\n\t\t#farmolo_options .combo-cell {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t}\n\t\t#farmolo_options .imgbox {\n\t\t\twidth: 40px;\n\t\t\tmargin-right: 5px;\n\t\t\ttext-align: center;\n\t\t}\n\t\t#farmolo_options .imgbox img {\n\t\t\theight: 24px;\n\t\t}\n\t\t.left-background {\n\t\t\twidth: calc(50vw - 512px);\n\t\t\theight: 100vh;\n\t\t\tposition: fixed;\n\t\t\tz-index: -1;\n\t\t\tleft: 0;\n\t\t\ttop: 0;\n\t\t\tbackground-repeat: no-repeat;\n    \t\tbackground-position-x: right;\n\t\t\tbackground-size: cover;\n\t\t}\n\t\t.right-background {\n\t\t\twidth: calc(50vw - 512px);\n\t\t\theight: 100vh;\n\t\t\tposition: fixed;\n\t\t\tz-index: -1;\n\t\t\tright: 0;\n\t\t\ttop: 0;\n\t\t\tbackground-repeat: no-repeat;\n    \t\tbackground-position-x: left;\n\t\t\tbackground-size: cover;\n\t\t}\n\t\t#farm_hova .szem4_farms_overflow {\n\t\t\tdisplay: none;\n\t\t}\n\t\t.style-settings-table { border-collapse: collapse; }\n\t\t.style-settings-table tr { border-bottom: 1px solid black; }\n\t\ttable.style-settings-table td { padding: 15px 4px; }\n\t\t.szem_old_build_tooltip {\n\t\t\tborder-left: 3px solid red;\n\t\t}\n\t\t.szem_old_build_tooltip i {\n\t\t\tfont-weight: bold;\n\t\t\tcolor: red;\n\t\t}\n\t';let r=document.createElement("style");return r.textContent=o,document.head.appendChild(r),document.getElementsByTagName("body")[0].innerHTML=`\n\t\t<div class="left-background"></div>\n\t\t<div class="right-background"></div>\n\t\t<div id="alert2">\n\t\t\t<div id="alert2head">\n\t\t\t\t<div>√úzenet</div>\n\t\t\t\t<div><a href='javascript: alert2("close");'>[ESC] ‚ùå</a></div>\n\t\t\t</div>\n\t\t\t<p id="alert2szov"></p>\n\t\t</div>\n\t\t<div class="fej">\n\t\t\t<div id="global_notifications"></div>\n\t\t\t<table width="100%" align="center" style="background: #111; background-image:url('${pic("wallp.jpg")}'); background-size:1024px;">\n\t\t\t\t<tr>\n\t\t\t\t\t<td width="70%" id="fejresz" style="vertical-align:middle; margin:auto;">\n\t\t\t\t\t\t<h1><i></i></h1>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td id="sugo" height="110px"></td>\n\t\t\t\t</tr>\n\t\t\t\t<tr><td colspan="2" id="menuk" style="">\n\t\t\t\t\t<div class="divrow" style="width: 1016px">\n\t\t\t\t\t\t<span class="divcell" id="kiegs" style="text-align:left; padding-top: 9px;width:870px;">\n\t\t\t\t\t\t\t<img src="${pic("muhely_logo.png")}" alt="GIT" title="GIT C&amp;C M≈±hely megnyit√°sa" onclick="window.open('https://github.com/cncDAni2/klanhaboru')">\n\t\t\t\t\t\t\t<img src="${pic("kh_logo.png")}" alt="Game" title="Kl√°nh√°bor√∫ megnyit√°sa" onclick="window.open(document.location.href)">\n\t\t\t\t\t\t\t|\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class="divcell" style="text-align:right; width:250px">\n\t\t\t\t\t\t\t<a href='javascript: nyit("naplo");' onmouseover="sugo(this,'Esem√©nyek napl√≥ja')">Napl√≥</a>\n\t\t\t\t\t\t\t<a href='javascript: nyit("debug");' onmouseover="sugo(this,'Hibanapl√≥')">Debug</a>\n\t\t\t\t\t\t\t<a href='javascript: nyit("hang");'><img src="${pic("hang.png")}" onmouseover="sugo(this,'Hangbe√°ll√≠t√°sok')" alt="hangok"></a>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</td></tr>\n\t\t\t</table>\n\t\t</div>\n\t\t<p id="content" style="display: inline"></p>`,document.getElementById("content").innerHTML=`\n\t<table class="menuitem" width="1024px" align="center" id="naplo" style="display: none"><tbody>\n\t<tr><td>\n\t\t<h1 align="center">Napl√≥</h1>\n\t\t<br>\n\t\t<br>\n\t\t<table align="center" class="vis" id="naploka"><tbody>\n\t\t\t<tr>\n\t\t\t\t<th onclick="'rendez("datum2",false,this,"naploka",0)'" style="cursor: pointer;">D√°tum</th>\n\t\t\t\t<th onclick="'rendez("szoveg",false,this,"naploka",1)'" style="cursor: pointer;">Script</th>\n\t\t\t\t<th onclick="'rendez("szoveg",false,this,"naploka",2)'" style="cursor: pointer;">Esem√©ny</th>\n\t\t\t</tr>\n\t\t</tbody></table>\n\t</td></tr>\n</tbody></table>\n<table class="menuitem" width="1024px" align="center" id="debug" style="display: none"><tbody>\n\t<tr><td>\n\t\t<h1 align="center">DeBugger</h1>\n\t\t<br>\n\t\t<br>\n\t\t<button type="button" onclick="debug_urit()">√úr√≠t</button>\n\t\t<button type="button" onclick="switchMobileMode()">Mobile_mode</button>\n\t\t<table align="center" class="vis" id="debugger"><tbody>\n\t\t\t<tr>\n\t\t\t\t<th onclick="rendez('datum2',false,this,'debugger',0)" style="cursor: pointer;">D√°tum</th>\n\t\t\t\t<th onclick="rendez('szoveg',false,this,'debugger',1)" style="cursor: pointer;">Script</th>\n\t\t\t\t<th onclick="rendez('szoveg',false,this,'debugger',2)" style="cursor: pointer;">Esem√©ny</th>\n\t\t\t</tr>\n\t\t</tbody></table>\n\t</td></tr>\n</tbody></table>\n<table class="menuitem" width="1024px" align="center" id="hang" style="display: none"><tbody>\n\t<tr><td><form id="settings">\n\t\t<p align="center">\n\t\t\t<audio id="audio1" controls="controls" autoplay="autoplay">\n\t\t\t\t<source id="wavhang" src="" type="audio/wav">\n\t\t\t</audio>\n\t\t</p>\n\t\t<h1 align="center">Hangbe√°ll√≠t√°s</h1>\n\t\t<br>\n\t\t<div id="hangok" style="display:table;">\n\t\t\t<div style="display:table-row;">\n\t\t\t\t<div style="display:table-cell; padding:10px;" onmouseover="sugo(this, 'Ha be van kapcsolva, bot v√©delem eset√©n ez a link is megnyit√≥dik, mint figyelmeztet√©s.')">\n\t\t\t\t\t<b><input type="checkbox" name="altbot" onchange="saveSettings()"> Alternat√≠v botriad√≥?\n\t\t\t\t\t\t<br>Megnyitott URL (egyszer)<br>\n\t\t\t\t\t\t<input type="text" id="altbotURL" name="altboturl" size="42" onchange="saveSettings()" value="http://www.youtube.com/watch?v=k2a30--j37Q">\n\t\t\t\t\t</b>\n\t\t\t\t</div>\n\t\t\t\t<b>\n\t\t\t\t</b>\n\t\t\t</div>\n\t\t\t<b>\n\t\t\t</b>\n\t\t</div>\n\t\t<h1 align="center">H√°tt√©r- √©s st√≠lus be√°ll√≠t√°s</h1>\n\t\t<div><table class="style-settings-table">\n\t\t\t<tr><td>Bal h√°tt√©rk√©p</td><td><input type="text" size="80" name="wallp_left" value="${pic("default_bg_left.jpg")}" onchange="onWallpChange()"></td><td>Csak k√©p, √ºres/invalid eset√©n h√°tt√©rsz√≠n lesz haszn√°lva</td></tr>\n\t\t\t<tr><td>Jobb h√°tt√©rk√©p</td><td><input type="text" size="80"  name="wallp_right" value="${pic("default_bg_right.jpg")}" onchange="onWallpChange()"></td><td>Csak k√©p, √ºres/invalid eset√©n h√°tt√©rsz√≠n lesz haszn√°lva</td></tr>\n\t\t\t<tr><td>Tartalom h√°tt√©rsz√≠ne</td><td><input type="text" size="30" name="content_bgcolor" value="#111" onchange="onWallpChange()"></td><td>[Default: #111] Minden CSS "background" property t√°mogatott. <a href="https://www.w3schools.com/cssref/css3_pr_background.php" target="_BLANK">W3School link</a></td></tr>\n\t\t\t<tr><td>Tartalom bet≈±sz√≠ne</td><td><input type="text" size="30" name="content_fontcolor" value="white" onchange="onWallpChange()"></td><td>[Default: white] Minden CSS "color" property t√°mogatott. <a href="https://www.w3schools.com/cssref/css_colors_legal.php" target="_BLANK">W3School link</a></td></tr>\n\t\t\t<tr><td>Keret sz√≠ne</td><td><input type="text" size="30" name="content_border" value="yellow" onchange="onWallpChange()"></td><td>[Default: yellow] Valid CSS "border-color" property t√°mogatott. <a href="https://www.w3schools.com/css/css_border_color.asp" target="_BLANK">W3School link</a></td></tr>\n\t\t\t<tr><td>Vetett √°rny√©k</td><td><input type="text" size="30" name="content_shadow" value="0 0 12px black" onchange="onWallpChange()"></td><td>[Default: 0 0 12px black] Valid CSS "box-shadow" property t√°mogatott. <a href="https://www.w3schools.com/cssref/css3_pr_box-shadow.php" target="_BLANK">W3School link</a></td></tr>\n\t\t\t<tr><td>Be√°ll√≠t√°s t√°bl√°zat h√°ttere</td>       <td><input type="text" size="30" name="table_bgcolor"      value="-" onchange="onWallpChange(undefined, 'table_bgcolor')"></td>     <td>[Default: -] A h√°tt√©r cell√°nk√©nt √©rtend≈ë. Minden CSS "background" property t√°mogatott. <a href="https://www.w3schools.com/cssref/css3_pr_background.php" target="_BLANK">W3School link</a></td></tr>\n\t\t\t<tr><td>Be√°ll√≠t√°s t√°bl√°zat sz√∂vegsz√≠ne</td>   <td><input type="text" size="30" name="table_color"        value="-" onchange="onWallpChange(undefined, 'table_color')"></td>       <td>[Default: -] Minden CSS "color" property t√°mogatott. <a href="https://www.w3schools.com/cssref/css_colors_legal.php" target="_BLANK">W3School link</a></td></tr>\n\t\t\t<tr><td>T√°bl√°zatok fejl√©c√©nek h√°ttere</td>    <td><input type="text" size="30" name="table_head_bgcolor" value="-" onchange="onWallpChange(undefined, 'table_head_bgcolor')"></td><td>[Default: -] A h√°tt√©r cell√°nk√©nt √©rtend≈ë. Minden CSS "background" property t√°mogatott. <a href="https://www.w3schools.com/cssref/css3_pr_background.php" target="_BLANK">W3School link</a></td></tr>\n\t\t\t<tr><td>T√°bl√°zatok fejl√©c√©nek sz√∂vegsz√≠ne</td><td><input type="text" size="30" name="table_head_color"   value="-" onchange="onWallpChange(undefined, 'table_head_color')"></td>  <td>[Default: -] A h√°tt√©r cell√°nk√©nt √©rtend≈ë. Minden CSS "background" property t√°mogatott. <a href="https://www.w3schools.com/cssref/css3_pr_background.php" target="_BLANK">W3School link</a></td></tr>\n\t\t</div></table>\n\t</form></td></tr>\n</tbody></table>`,document.title="SZEM IV",debug("SZEM 4","Verzi√≥: GIT_"+(new Date).toLocaleDateString()),debug("SZEM 4","Prog.azon: "+AZON),debug("SZEM 4","W-Speed: "+SPEED),debug("SZEM 4","U-Speed: "+UNIT_S),!0}catch(t){return alert("Hiba ind√≠t√°skor:\n\nError at starting:\n"+t),!1}}function pic(t){return"https://raw.githubusercontent.com/cncDAni2/klanhaboru/main/images/szem4/"+t}function picBuilding(t){return`<img src="https://dshu.innogamescdn.com/asset/88651122/graphic/buildings/mid/${t}3.png">`}function onWallpChange(t=!0,e){const n=document.getElementById("settings");if(document.getElementsByClassName("left-background")[0].style.backgroundImage=`url('${n.wallp_left.value}')`,document.getElementsByClassName("right-background")[0].style.backgroundImage=`url('${n.wallp_right.value}')`,$("body").css("background",n.content_bgcolor.value),$(".menuitem").css("background",n.content_bgcolor.value),$("table.menuitem").css("color",n.content_fontcolor.value),$("#content a").css("color",n.content_fontcolor.value),$("table.style-settings-table").css("color",n.content_fontcolor.value),$("table.menuitem").css("border-color",n.content_border.value),$(".fej > table").css("border-color",n.content_border.value),$("#content > table").css("box-shadow",n.content_shadow.value),$(".fej").css("box-shadow",n.content_shadow.value),"table_bgcolor"==e||"ALL"==e){const t=$("<style>").attr("type","text/css").html(`.vis:not(#farm_honnan):not(#farm_hova) td { background: ${n.table_bgcolor.value}; }`);$("head").append(t)}if("table_head_bgcolor"==e||"ALL"==e){const t=$("<style>").attr("type","text/css").html(`.vis th { background: ${n.table_head_bgcolor.value} !important; }`);$("head").append(t)}if("table_color"==e||"ALL"==e){const t=$("<style>").attr("type","text/css").html(`.vis:not(#farm_honnan):not(#farm_hova) td { color: ${n.table_color.value}; }`);$("head").append(t)}if("table_head_color"==e||"ALL"==e){const t=$("<style>").attr("type","text/css").html(`.vis th { color: ${n.table_head_color.value} !important; }`);$("head").append(t)}t&&saveSettings()}function soundVolume(t){document.getElementById("audio1").volume=t}function playSound(t,e="wav"){try{let l=t;t.includes("farmolas")&&(l="farmolas");var n=document.getElementsByName(l)[0];if(null==n)return void debug("hanghiba","Nem defini√°lt hang: "+l);if(0==n.checked)return;var a=`https://raw.githubusercontent.com/cncDAni2/klanhaboru/main/images/szem4/${t}.${e}`;document.getElementById("wavhang").src=a,document.getElementById("audio1").load(),document.getElementById("audio1").play()}catch(t){alert2(t)}}function validate(t){var e=t||window.event,n=e.keyCode||e.which;n=String.fromCharCode(n);/[0-9]|\./.test(n)||(e.returnValue=!1,e.preventDefault&&e.preventDefault())}function shorttest(){try{var t="",e="";let n=document.getElementById("farmolo_options");""==n.termeles.value&&(t+="Termel√©s/√≥ra √©rt√©ke √ºres. Legal√°bb egy 0 szerepeljen!\n"),parseInt(n.termeles.value,10)<50&&(e+="Termel√©s/√≥ra √©rt√©ke nagyon alacsony. Min 50\n"),""==n.maxtav_ora.value&&(t+="Max t√°v/√≥ra: √úres √©rt√©k. \n"),""==n.maxtav_p.value&&(t+="Max t√°v/perc: √úres √©rt√©k. \n"),0==parseInt(n.maxtav_ora.value,10)&&parseInt(n.maxtav_p.value,10)<1&&(t+="A jelenleg megadott max t√°vols√°g 0!\n"),0==parseInt(n.maxtav_ora.value,10)&&parseInt(n.maxtav_p.value,10)<40&&(e+="A jelenleg megadott max t√°vols√°g nagyon r√∂vid!\n"),""==n.kemdb.value&&(t+="Ha nem szeretn√©l k√©met k√ºldeni, √≠rj be 0-t.\n"),parseInt(n.kemdb.value,10)>3&&(e+="3-n√°l t√∂bb k√©m egyik szerveren sem sz√ºks√©ges. Javasolt: 1 vagy 3.\n"),n.isforced.checked&&0==parseInt(n.kemdb.value,10)&&(e+="K√©nyszer√≠ted a k√©mek k√ºld√©s√©t, de a k√ºldend≈ë k√©m √©rt√©k√©re 0 van megadva!\n"),""==n.kemperc.value&&(t+="K√©m/perc √ºres. Ha mindig k√ºlden√©l k√©met, legyen 0, b√°r ilyenre semmi sz√ºks√©g"),""==n.minsereg.value&&(t+="Ha minimum limit n√©lk√ºl szeretn√©d egys√©geid k√ºldeni, √≠rj be 0-t.\n"),""==n.sebesseg_p.value&&(t+="A legkevesebb pihen≈ë id≈ë: 1 perc, ne hagyd √ºresen.\n"),parseInt(n.sebesseg_p.value,10)<1&&(t+="A legkevesebb pihen≈ë id≈ë: 1 perc.\n"),parseInt(n.sebesseg_p.value,10)>30&&(e+="30 percn√©l t√∂bb pihen≈ë id≈ët adt√°l meg. Biztos?\n"),parseInt(n.sebesseg_p.value,10)>150&&(t+="150 percn√©l t√∂bb pihen≈ë id≈ët nem lehet megadni.\n"),""==n.sebesseg_m.value&&(t+="A leggyorsabb ciklusid≈ë: 200 ms, ne hagyd √ºresen.\n"),parseInt(n.sebesseg_m.value,10)<200&&(t+="A leggyorsabb ciklusid≈ë: 200 ms\n"),parseInt(n.sebesseg_m.value,10)>5e3&&(t+="5000 ms-n√©l t√∂bb ciklusid≈ë felesleges, √©s felt≈±n≈ë. √çrj be 5000 alatti √©rt√©ket.\n");const a=parseInt(n.termeles.value,10),l=parseInt(n.minsereg.value,10);return a*(parseInt(n.megbizhatosag.value,10)/60)<80*Math.ceil(l/4)&&(t+="T√∫l alacsony az alap√©rtelmezett termel√©s, vagy a menetrend megb√≠zhat√≥s√°gi r√©sze, vagy a min sereg/falu. Ez√°ltal √∫j falukat nem tudna t√°madni SZEM. Emeld valamelyiket.\n"),(""==n.raktar.value||parseInt(n.raktar.value,10)<20)&&(t+="Rakt√°r tel√≠tetts√©gi √©rt√©ke t√∫l alacsony, √≠gy v√©lhet≈ëleg sehonnan se fog fosztani. Min 20%"),""==n.megbizhatosag.value||parseInt(n.megbizhatosag.value,10)<5||parseInt(n.megbizhatosag.value,10)>180?t+="Megb√≠zhat√≥s√°gi szint 5-180 perc k√∂z√∂tt legyen":MAX_IDO_PERC=parseInt(n.megbizhatosag.value,10),""==t||FARM_PAUSE||szunet("farm",document.getElementById("kiegs").getElementsByName("farm")[0]),""!=t?(alert2("<b>Egy vagy t√∂bb be√°ll√≠t√°si hiba miatt nem ind√≠that√≥ a farmol√≥!</b><br><br>"+t),!1):(alert2(""==e?"close":"Javaslatok:\n"+e),!0)}catch(t){alert2("Hiba:\n"+t)}}function sugo(t,e){if(""!=e){t.hasAttribute("data-hossz")||t.addEventListener("mouseout",(t=>{SUGOORA=setTimeout((()=>sugo(t.fromElement,"")),parseInt(t.fromElement.getAttribute("data-hossz"),10))}));var n=e.length;n=Math.round(1e3*n/40),"undefined"!=SUGOORA&&clearTimeout(SUGOORA),document.getElementById("sugo").innerHTML=e,t.setAttribute("data-hossz",n)}else document.getElementById("sugo").innerHTML=e}function prettyDatePrint(t){return t.getFullYear()+"/"+("0"+(t.getMonth()+1)).slice(-2)+"/"+("0"+t.getDate()).slice(-2)+" "+("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2)+":"+("0"+t.getSeconds()).slice(-2)}function nyit(t){try{for(var e=document.getElementById("content").childNodes,n="",a=0;a<e.length;a++)"TABLE"==e[a].nodeName.toUpperCase()&&(n=e[a].getAttribute("id"),$("#"+n).fadeOut(300));var l=new RegExp('"'+t+'"');for(e=document.getElementById("menuk").getElementsByTagName("a"),a=0;a<e.length;a++)e[a].style.padding="3px",l.test(e[a].getAttribute("href"))?e[a].style.backgroundColor="#000000":e[a].style.backgroundColor="transparent";setTimeout((function(){$("#"+t).fadeIn(300)}),300)}catch(t){alert(t)}}function alert2(t){"close"!=(t+="")?(t=t.replace("\n","<br>"),document.getElementById("alert2szov").innerHTML=t,$("#alert2").show()):$("#alert2").hide()}function naplo(t,e){var n=new Date,a=n.getMinutes(),l=n.getSeconds();a<10&&(a="0"+a),l<10&&(l="0"+l);var o=new Array("Jan","Febr","March","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"),r=document.getElementById("naploka").insertRow(1),s=r.insertCell(0),i=r.insertCell(1),d=r.insertCell(2);s.innerHTML=o[n.getMonth()]+" "+n.getDate()+", "+n.getHours()+":"+a+":"+l,i.innerHTML=t,d.innerHTML=e,playSound("naplobejegyzes")}function debug(t,e){var n=new Date,a=n.getMinutes(),l=n.getSeconds();a<10&&(a="0"+a),l<10&&(l="0"+l);var o=new Array("Jan","Febr","March","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"),r=document.getElementById("debugger"),s=r.insertRow(1),i=s.insertCell(0),d=s.insertCell(1),c=s.insertCell(2);i.innerHTML=o[n.getMonth()]+" "+n.getDate()+", "+n.getHours()+":"+a+":"+l,d.innerHTML=t,c.innerHTML=e,r.rows.length>300&&$("#debugger").find("tr:gt(150)").remove(),r.rows.length>10&&n-new Date(`${n.getFullYear()} ${r.rows[10].cells[0].textContent}`)<18e4&&(naplo("Auto-error","T√∫l sok hiba valahol?"),playSound("kritikus_hiba"))}function debug_urit(){$("#debugger").find("tr:gt(0)").remove()}function ujkieg(t,e,n){return!document.getElementById(e)&&(document.getElementById("kiegs").innerHTML+="<img onclick='szunet(\""+t+'",this)\' name="'+t+'" onmouseover=\'sugo(this,"Az √©rintett scriptet tudod meg√°ll√≠tani/elind√≠tani.")\' src="'+pic(("farm"==t||"vije"==t?"pause":"play")+".png")+'" alt="Stop" title="Klikk a sz√ºneteltet√©shez"> <a href=\'javascript: nyit("'+t+"\");'>"+e.toUpperCase()+"</a> ",document.getElementById("content").innerHTML+='<table class="menuitem" width="1024px" align="center" id="'+t+'" style="display: none">'+n+"</table>",!0)}function ujkieg_hang(t,e){try{var n=e.split(";")}catch(t){n=e}var a=document.getElementById("hangok").getElementsByTagName("div")[0],l=document.createElement("div");l.setAttribute("style","display:table-cell; padding:10px;");for(var o="<h3>"+t+"</h3>",r=0;r<n.length;r++)o+=`<input type="checkbox" name="${n[r]}" checked onchange="saveSettings()"> <a href="javascript: playSound('${n[r]}');"> ${n[r]} </a><br>`;l.innerHTML=o,a.appendChild(l)}function szunet(t,e){try{switch(t){case"farm":var n=FARM_PAUSE=!FARM_PAUSE;break;case"vije":n=VIJE_PAUSE=!VIJE_PAUSE;break;case"idtamad":alert2("Ezt a script nem √°ll√≠that√≥ meg, mivel nem ig√©nyel semmilyen er≈ëforr√°st.<br>Ha a hangot szeretn√©d kikapcsolni, megteheted azt a hangbe√°ll√≠t√°sokn√°l.");break;case"epit":n=EPIT_PAUSE=!EPIT_PAUSE;break;case"adatok":n=ADAT_PAUSE=!ADAT_PAUSE;break;default:return void alert2("Sikertelen script meg√°llat√°s. Nincs ilyen alscript: "+t)}n?(e.src=pic("pause.png"),e.alt="Start",e.title="Klikk a folytat√°shoz"):(e.src=pic("play.png"),e.alt="Stop",e.title="Klikk a sz√ºneteltet√©shez"),"farm"==t&&shorttest()}catch(t){alert2("Hiba:\n"+t)}}function distCalc(t,e){return t[0]=parseInt(t[0]),t[1]=parseInt(t[1]),e[0]=parseInt(e[0]),e[1]=parseInt(e[1]),Math.abs(Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)))}function rendez(t,e,n,a,l){try{var o=document.getElementById(a).getElementsByTagName("tbody")[0],r=document.getElementById(a).rows;if(r.length<2)return;for(var s=new Array,i=new Array,d=new Array,c=1;c<r.length;c++){switch(t){case"szoveg":s[c-1]=r[c].cells[l].textContent;break;case"szam":let t=r[c].cells[l].textContent.trim();s[c-1]=t&&""!=t?parseInt(t.replace(".","")):-.1;break;case"datum":""==r[c].cells[l].textContent.trim()?s[c-1]=getServerTime():s[c-1]=new Date(r[c].cells[l].textContent.trim());break;case"datum2":var m=new Array("Jan","Febr","March","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"),u=new Date,g=r[c].cells[l].textContent.trim();u.setMonth(m.indexOf(g.split(" ")[0])),u.setDate(g.split(" ")[1].replace(",","")),u.setHours(g.split(" ")[2].split(":")[0]),u.setMinutes(g.split(" ")[2].split(":")[1]),u.setSeconds(g.split(" ")[2].split(":")[2]),s[c-1]=u;break;case"lista":s[c-1]=r[c].cells[l].getElementsByTagName("select")[0].value;break;default:throw"Nem √©rtelmezhet≈ë mi szerint k√©ne rendezni."}i[c-1]=r[c],d[c-1]=c-1}for(c=0;c<s.length;c++){for(var p=c,_=c;_<s.length;_++)e?s[_]>s[p]&&(p=_):s[_]<s[p]&&(p=_);var h=s[c];s[c]=s[p],s[p]=h;h=d[c];d[c]=d[p],d[p]=h}for(c=r.length-1;c>0;c--)o.deleteRow(c);for(c=0;c<s.length;c++)o.appendChild(i[d[c]]);return n.setAttribute("onclick",'rendez("'+t+'",'+!e+',this,"'+a+'",'+l+")"),void hideFarms()}catch(t){alert2("Hiba rendez√©skor:\n"+t)}}function koordTOid(t){for(var e=0;e<KTID.length;e++)if(KTID[e].split(";")[0]==t)return KTID[e].split(";")[1];return 0}function rovidit(t){var e="";if("egysegek"===t)for(var n=0;n<UNITS.length;n++)e+=`<div class="szem4_unitbox" data-allunit="999" name="${UNITS[n]}"><label>\n\t\t\t\t<img src="/graphic/unit/unit_${UNITS[n]}.png">\n\t\t\t\t<input type="checkbox" onclick="szem4_farmolo_multiclick(${n},'honnan',this.checked)">\n\t\t\t\t</label></div>`;else e="";return e}function getServerTime(t,e=!1){if(t)if(t.document.getElementById("serverTime")&&t.document.getElementById("serverDate")){let n=function(t,e){let n=e.split("/"),a=n[1]+"/"+n[0]+"/"+n[2];return new Date(a+" "+t)}(t.document.getElementById("serverTime").textContent,t.document.getElementById("serverDate").textContent),a=n-new Date;if(Math.abs(a/6e4)>2){let t=15*Math.round(a/9e5);TIME_ZONE==t||e||naplo("Id≈ëz√≥na üïê",`Id≈ëeltol√≥d√°s friss√≠tve: eltol√≥d√°s ${TIME_ZONE} perccel.`),TIME_ZONE=t}}else e||naplo("Id≈ëz√≥na üïê","Nem meg√°llap√≠that√≥ id≈ëz√≥na (bet√∂ltetlen lap?), friss√≠t√©s sikertelen.");let n=new Date;return n.setMinutes(n.getMinutes()+TIME_ZONE),n}function maplink(t){return'<a href="'+VILL1ST.replace("screen=overview","x="+t.split("|")[0]+"&y="+t.split("|")[1]+"&screen=map")+'" target="_BLANK">'+t+"</a>"}function multipricer(t,e,n){try{if(null==t)return;if(!document.getElementById("farm_multi_"+t).checked)return;for(var a=document.getElementById("farm_"+t).rows,l=a.length-1;l>0;l--)if("none"!=a[l].style.display){let t=a[l].closest("tr").cells[0].textContent;switch(DOMINFO_FARMS[t].szin=DOMINFO_FARMS[t].szin||{},e){case"del":delete DOMINFO_FARMS[t],a[l].parentNode.removeChild(a[l]);break;case"urit":a[l].cells[2].innerHTML="";break;case"mod":DOMINFO_FARMS[t].nyers=parseInt(n,10),a[l].cells[3].innerHTML=n;break;case"htor":DOMINFO_FARMS[t].szin.falu="",a[l].cells[0].style.backgroundColor="#f4e4bc";break;case"hreset":DOMINFO_FARMS[t].szin.fal="",DOMINFO_FARMS[t].szin.marks="",a[l].cells[2].style.backgroundColor=n,a[l].cells[2].style.border="";break;case"hcser":DOMINFO_FARMS[t].szin.fal=n,a[l].cells[2].style.backgroundColor=n;break;case"addmark":DOMINFO_FARMS[t].szin.marks=n,a[l].cells[2].style.border=`2px solid ${n}`}}}catch(t){console.error(t)}}function sortorol(t,e){var n=t.parentNode;delete DOMINFO_FARMS[n.cells[0].textContent],n.parentNode.removeChild(n),multipricer(e,"del")}function urit(t,e){t.innerHTML="",multipricer(e,"urit")}function modosit_szam(t){var e=prompt("√öj √©rt√©k?");null!=e&&""!=(e=e.replace(/[^0-9]/g,""))&&(e=parseInt(e,10),t.innerHTML=e,DOMINFO_FARMS[t.closest("tr").cells[0].textContent].nyers=e,multipricer("hova","mod",e))}function hattertolor(t){t.style.backgroundColor="#f4e4bc";let e=t.closest("tr").cells[0].textContent;DOMINFO_FARMS[e].szin=DOMINFO_FARMS[e].szin||{},DOMINFO_FARMS[e].szin.falu="",multipricer("hova","htor")}function hattercsere(t){var e="#00FF00";let n=t.closest("tr").cells[0].textContent;DOMINFO_FARMS[n].szin=DOMINFO_FARMS[n].szin||{},"rgb(0, 255, 0)"==t.style.backgroundColor||"#00FF00"==t.style.backgroundColor?t.style.border?(e="#f4e4bc",t.style.backgroundColor=e,DOMINFO_FARMS[n].szin.fal="",t.style.border="",DOMINFO_FARMS[n].szin.marks="",multipricer("hova","hreset",e)):(e="blue",t.style.border=`2px solid ${e}`,DOMINFO_FARMS[n].szin.marks=e,multipricer("hova","addmark",e)):(t.style.backgroundColor=e,DOMINFO_FARMS[n].szin.fal=e,multipricer("hova","hcser",e))}function addFreezeNotification(){USER_ACTIVITY||(document.getElementById("global_notifications").innerHTML=`<img src="${pic("freeze.png")}" class="rotate" onmouseover="sugo(this,'Am√≠g SZEM keretrendszert piszk√°lod, SZEM pihen hogy f√≥kusz√°lni tudj (automata)')">`),USER_ACTIVITY=!0,clearTimeout(USER_ACTIVITY_TIMEOUT),USER_ACTIVITY_TIMEOUT=setTimeout((()=>{USER_ACTIVITY=!1,document.getElementById("global_notifications").innerHTML=""}),5e3)}var BOTORA,BOT_REF,ALTBOT2=!1,BOT_VOL=0;function BotvedelemBe(){try{if(!BOT_REF)throw BOT_REF=window.open(VILL1ST),"Waiting for auto-resolver...";if(BOT_REF.document.getElementById("botprotection_quest")?BOT_REF.document.getElementById("botprotection_quest").click():BOT_REF.document.getElementById("bot_check")&&BOT_REF.document.getElementById("bot_check").getElementsByTagName("a")[0].click(),BOT_REF&&!(BOT_REF.document.getElementById("bot_check")||BOT_REF.document.getElementById("popup_box_bot_protection")||"Bot v√©delem"==BOT_REF.document.title||BOT_REF.document.getElementById("botprotection_quest")))return void BotvedelemKi();(BOT_VOL+=.2)>1&&(BOT_VOL=1),soundVolume(BOT_VOL),playSound("bot2"),BOT=!0,alert2('BOT V√âDELEM!!!<br>√çrd be a k√≥dot, √©s kattints ide lentre!<br><br><a href="javascript: BotvedelemKi()">Be√≠rtam a k√≥dot, mehet tov√°bb!</a>'),SZEM4_SETTINGS.altbot&&!ALTBOT2&&(window.open(document.getElementById("altbotURL").value),ALTBOT2=!0)}catch(t){debug("BotvedelemBe()",t)}BOTORA=setTimeout("BotvedelemBe()",2500)}function BotvedelemKi(){BOT=!1,ALTBOT2=!1,BOT_VOL=0,BOT_REF.close(),BOT_REF=null,document.getElementById("audio1").pause,alert2("OK"),clearTimeout(BOTORA);try{FARM_REF.location.reload()}catch(t){}try{VIJE_REF1.location.reload()}catch(t){}try{VIJE_REF2.location.reload()}catch(t){}try{IDTAMAD_REF.location.reload()}catch(t){}try{EPIT_REF.location.reload()}catch(t){}}function isPageLoaded(t,e,n){try{if(t.closed)return!1;if(t.document.getElementById("botprotection_quest"))return t.document.getElementById("botprotection_quest").click(),naplo("Glob√°lis","Bot v√©delem akt√≠v!!!"),document.getElementById("audio1").volume=.2,BotvedelemBe(),!1;if(t.document.getElementById("bot_check"))return BOT_REF.document.getElementById("bot_check").getElementsByTagName("a")[0].click(),naplo("Glob√°lis","Bot v√©delem akt√≠v!!!"),document.getElementById("audio1").volume=.2,BotvedelemBe(),!1;if(t.document.getElementById("bot_check")||t.document.getElementById("popup_box_bot_protection")||"Bot v√©delem"==t.document.title)return naplo("Glob√°lis","Bot v√©delem akt√≠v!!!"),document.getElementById("audio1").volume=.2,BotvedelemBe(),!1;if(t.document.location.href.indexOf("sid_wrong")>-1)return naplo("Glob√°lis","Kijelentkezett fi√≥k. Jelentkezzen be √∫jra, vagy √°ll√≠tsa le a programot."),BotvedelemBe(),!1;if(!n)return!1;if(n.indexOf("not ")>-1)var a=!0;else a=!1;if(e>-1&&t.game_data.village.id!=e)return!1;if(t.document.getElementById("serverTime").innerHTML.length>4)if(a){if(-1==t.document.location.href.indexOf(n.split(" ")[1]))return!0}else if(t.document.location.href.indexOf(n)>-1)return!0;return!1}catch(t){return!1}}function windowOpener(t,e,n){return window.open(e,n)}function addTooltip(t,e){removeTooltip(t.closest(".tooltip-wrapper")),$(t).children(".tooltip_text").css({display:"block"}),$(t).children(".tooltip_text").html(e)}function addTooltip_build(t,e){removeTooltip(t.closest(".tooltip-wrapper")),t.querySelector(".tooltip_text").style.display="block";const n=e in ALL_VIJE_SAVED;n?t.querySelector(".tooltip_text").classList.remove("szem_old_build_tooltip"):t.querySelector(".tooltip_text").classList.add("szem_old_build_tooltip");let a='<table class="no-bg-table">';const l=document.getElementById("vije_opts");for(build in DOMINFO_FARMS[e].buildings)DOMINFO_FARMS[e].buildings[build]<1||(a+=`<tr><td>${l[build].value}:</td><td>${DOMINFO_FARMS[e].buildings[build]}</td></tr>`);a+="</table>",a+=`<br><i>Felder√≠t√©s ideje:<br>${n?new Date(ALL_VIJE_SAVED[e]).toLocaleString():"Ismeretlen/r√©gi"}</i>`,t.querySelector(".tooltip_text").innerHTML=a}function removeTooltip(t){$(t).find(".tooltip_hover").each((function(t,e){""!=$(e).children(".tooltip_text").html()&&($(e).children(".tooltip_text").html(""),$(e).children(".tooltip_text").css({display:"none"}))}))}function switchMobileMode(){MOBILE_MODE=!MOBILE_MODE,alert(`Mobile Mode = ${MOBILE_MODE}`)}function saveSettings(){const t=document.getElementById("settings");SZEM4_SETTINGS={},Array.from(t.elements).forEach((t=>{t.name&&("checkbox"===t.type?SZEM4_SETTINGS[t.name]=t.checked:t.value&&(SZEM4_SETTINGS[t.name]=t.value))}))}function loadSettings(){const t=document.getElementById("settings");Array.from(t.elements).forEach((t=>{t.name&&SZEM4_SETTINGS[t.name]&&("checkbox"===t.type?t.checked=SZEM4_SETTINGS[t.name]:t.value&&(t.value=SZEM4_SETTINGS[t.name]))})),onWallpChange(!1,"ALL")}function restartKieg(t){worker.postMessage({id:"stopTimer",value:t}),setTimeout((function(){switch(t){case"farm":szem4_farmolo_motor();break;case"vije":szem4_VIJE_motor();break;case"epit":szem4_EPITO_motor()}}),133)}function drawWagons(t){let e=document.getElementById("farm_hova").rows;if(t){for(n=1;n<e.length;n++)if(e[n].cells[0].textContent==t){addWagons(e[n]);break}}else for(var n=1;n<e.length;n++)addWagons(e[n])}function addWagons(t){let e=t.cells[0].textContent,n=ALL_UNIT_MOVEMENT[e];if(t.cells[5].innerHTML="",!n)return;n.sort(((t,e)=>t[1]-e[1]));const a=document.createElement("div");a.setAttribute("class","tooltip-wrapper");let l="",o=DOMINFO_FARMS[e].prodHour;n.forEach(((t,e)=>{let n="wagon_normal.png";t[2]>5*o?n="wagon_nuclear.png":t[2]>2*o?n="wagon_coal.png":t[2]<5&&t[0]<5&&(n="wagon_empty.png"),l+=`\n\t\t<span onmouseenter="setTooltip(this, ${e})" class="tooltip_hover">\n\t\t\t<img src="${pic(n)}?v=4" title="" width="40px">\n\t\t\t<span class="tooltip_text"></span>\n\t\t</span>`})),a.innerHTML=l,t.cells[5].appendChild(a)}function setTooltip(t,e){let n=t.closest("tr"),a=n.cells[0].textContent,l=[...ALL_UNIT_MOVEMENT[a][e]],o=convertTbToTime(n.cells[1].textContent,l[0]),r=new Date(l[1]);r.setSeconds(r.getSeconds()-60*o),o=o.toFixed(2),addTooltip(t,`<table class="no-bg-table">\n\t\t<tr><td>Szerelv√©ny hossza</td><td><div class="flex_middle">${o} perc (<img src="${pic("resource.png")}"> ${l[0]})</div></td></tr>\n\t\t<tr><td>Szerelv√©ny kezdete</td><td>${r.toLocaleString()}</td></tr>\n\t\t<tr><td>√ârkez√©s</td><td>${new Date(l[1]).toLocaleString()}</td></tr>\n\t\t<tr><td>Extra nyers</td><td><div class="flex_middle"><img src="${pic("resource.png")}"> ${l[2]}</div></td></tr>\n\t\t<tr><td>Nyerstermel√©s/√≥ra</td><td>${getProdHour(n.cells[1].textContent)}</td></tr>\n\t</table>\n\t<i>Utols√≥ jelent√©s: ${ALL_VIJE_SAVED[a]?new Date(ALL_VIJE_SAVED[a]).toLocaleString():"Nincs"}</i>`)}function add_farmolo(){try{let s=document.getElementById("add_farmolo_faluk"),i=document.getElementById("add_farmolo_egysegek").getElementsByTagName("input");var t=s.value;if(""==t)return;if(!new RegExp(/[0-9]+(\|)[0-9]+/).test(t))throw"Nincs √©rv√©nyes koordin√°ta megadva";t=t.match(/[0-9]+(\|)[0-9]+/g);let d=!1;for(let t=0;t<i.length;t++)if(1==i[t].checked){d=!0;break}if(!d&&!confirm("Nincs semmilyen egys√©g megadva, amit k√ºldhetn√©k. Folytatod?\n(k√©s≈ëbb ez a megad√°s m√≥dos√≠that√≥)"))return;for(var e="",n=0;n<t.length;n++){for(var a=document.getElementById("farm_honnan"),l=document.getElementById("farm_hova"),o=1;o<a.rows.length;o++)if(a.rows[o].cells[0].textContent==t[n]){e+=t[n]+", ",t[n]="";break}if(""!=t[n]){for(o=1;o<l.rows.length;o++)if(l.rows[o].cells[0].textContent==t[n]){e+=t[n]+", ",t[n]="";break}if(""!=t[n])if(0!=koordTOid(t[n])){var r;(r=(l=a.insertRow(-1)).insertCell(0)).innerHTML=t[n],r.setAttribute("ondblclick",'sortorol(this,"honnan")'),(r=l.insertCell(1)).innerHTML=rovidit("egysegek");for(o=0;o<r.getElementsByTagName("input").length;o++)1==i[o].checked&&(r.getElementsByTagName("input")[o].checked=!0);(r=l.insertCell(2)).innerHTML="",r.setAttribute("ondblclick",'urit(this,"honnan")')}else e+=t[n]+", ",t[n]=""}}return s.value="",""!=e&&alert2("Dupla falumegad√°sok, esetleg nem l√©v≈ë saj√°t faluk kisz≈±rve:\n"+e),void hideFarms()}catch(t){alert(t)}}function hideFarms(){const t=document.getElementById("farm_hova").rows;let e=0;for(let n=0;n<t.length;n++)"none"!==t[n].style.display&&e++,e>200?t[n].classList.add("szem4_farms_overflow"):t[n].classList.remove("szem4_farms_overflow")}function rebuildDOM_farms(){try{const t=document.getElementById("farm_hova");for(farm in $("#farm_hova tr:gt(0)").remove(),DOMINFO_FARMS){DOMINFO_FARMS[farm].szin=DOMINFO_FARMS[farm].szin||{};const e=t.insertRow(-1);let n=e.insertCell(0);n.innerHTML=farm,n.setAttribute("ondblclick","hattertolor(this)"),n.setAttribute("data-age","0"),DOMINFO_FARMS[farm].szin.falu&&(n.style.backgroundColor=DOMINFO_FARMS[farm].szin.falu);const a=DOMINFO_FARMS[farm].buildings;if(n=e.insertCell(1),null==a.wood)DOMINFO_FARMS[farm].prodHour=parseInt(document.getElementById("farmolo_options").termeles.value,10);else{let t=`${a.wood},${a.stone},${a.iron}`;n.innerHTML=`${t}`,DOMINFO_FARMS[farm].prodHour=getProdHour(t)}n.setAttribute("ondblclick",'sortorol(this,"hova")'),n=e.insertCell(2);let l="";void 0!==a.wall&&(l=parseInt(a.wall,10),0==l&&(1==a.main&&(l-=2),2==a.main&&(l-=1),0==a.barracks&&(l-=1))),n.innerHTML=`<span class="tooltip_hover">\n\t\t\t${l}\n\t\t\t<span class="tooltip_text"></span>\n\t\t</span>`,n.setAttribute("onmouseenter",`addTooltip_build(this, '${farm}')`),n.setAttribute("ondblclick","hattercsere(this)"),n.setAttribute("onclick","learnCatapult(this)"),n.setAttribute("onmouseleave","removeTooltip(this)"),DOMINFO_FARMS[farm].szin.fal&&(n.style.backgroundColor=DOMINFO_FARMS[farm].szin.fal),DOMINFO_FARMS[farm].szin.marks&&(n.style.border=`2px solid ${DOMINFO_FARMS[farm].szin.marks}`),n=e.insertCell(3),n.innerHTML=DOMINFO_FARMS[farm].nyers,n.setAttribute("ondblclick","modosit_szam(this)"),n=e.insertCell(4),n.innerHTML=`<input type="checkbox" onclick="szem4_farmolo_multiclick(0,'hova',this.checked)" ${DOMINFO_FARMS[farm].isJatekos?"checked":""}>`,n=e.insertCell(5),n.innerHTML="",n.setAttribute("onmouseleave","removeTooltip(this)")}hideFarms()}catch(t){debug("rebuildDOM_farms",t),alert2("ERROR__ rebuild: \n"+t)}}function learnCatapult(t){let e=t.closest("tr").cells[0].textContent,n={};const a=["wood","stone","iron","wall"],l=document.getElementById("vije_opts");for(b in DOMINFO_FARMS[e].buildings)a.includes(b)||0==DOMINFO_FARMS[e].buildings[b]||(n[l[b].value]=DOMINFO_FARMS[e].buildings[b]);alert2(`Katapultoz√≥ script betan√≠tva \n ${e}`),console.info(e,n),localStorage.setItem("cnc_katapult",`;${e};${JSON.stringify(n)}`)}function add_farmolando(){try{let i=document.getElementById("add_farmolando_faluk");var t=i.value;if(""==t)return;if(!new RegExp(/[0-9]+(\|)[0-9]+/).test(t))throw"Nincs √©rv√©nyes koordin√°ta megadva";t=t.match(/[0-9]+(\|)[0-9]+/g);var e="";let d=parseInt(document.getElementById("farmolo_options").termeles.value,10);for(var n=0;n<t.length;n++){for(var a=document.getElementById("farm_hova"),l=document.getElementById("farm_honnan"),o=1;o<a.rows.length;o++)if(a.rows[o].cells[0].textContent==t[n]){e+=t[n]+", ",t[n]="";break}if(""!=t[n]){for(o=1;o<l.rows.length;o++)if(l.rows[o].cells[0].textContent==t[n]){e+=t[n]+", ",t[n]="";break}if(""!=t[n]){var r,s=a.insertRow(-1);(r=s.insertCell(0)).innerHTML=t[n],r.setAttribute("ondblclick","hattertolor(this)"),r.setAttribute("data-age","0"),(r=s.insertCell(1)).innerHTML="",r.setAttribute("ondblclick",'sortorol(this,"hova")'),(r=s.insertCell(2)).innerHTML='<span class="tooltip_hover">\n\t\t\t\t0\n\t\t\t\t<span class="tooltip_text"></span>\n\t\t\t</span>',r.setAttribute("ondblclick","hattercsere(this)"),r.setAttribute("onclick","learnCatapult(this)"),r.setAttribute("onmouseenter",`addTooltip_build(this, '${t[n]}')`),r.setAttribute("onmouseleave","removeTooltip(this)"),(r=s.insertCell(3)).innerHTML="0",r.setAttribute("ondblclick","modosit_szam(this)"),(r=s.insertCell(4)).innerHTML='<input type="checkbox" onclick="szem4_farmolo_multiclick(0,\'hova\',this.checked)">',(r=s.insertCell(5)).innerHTML="",r.setAttribute("onmouseleave","removeTooltip(this)"),DOMINFO_FARMS[t[n]]={prodHour:d,buildings:{},nyers:0,szin:{falu:"",fal:"",marks:""},isJatekos:!1}}}}i.value="";let c="";return Object.keys(DOMINFO_FARMS).length>200&&(c+="T√∫l sok farm, csak az els≈ë 200-at jelen√≠tem meg (ett≈ël m√©g akt√≠vak √©s sz≈±rhet≈ëek/rendezhet≈ëek)\n"),hideFarms(),""!=e&&(c+="Dupla falumegad√°sok kisz≈±rve:\n"+e),void(""!==c&&alert2(c))}catch(t){alert(t)}}function szem4_farmolo_multiclick(t,e,n){try{if(!document.getElementById("farm_multi_"+e).checked)return;var a=document.getElementById("farm_"+e).rows;e="honnan"==e?1:4;for(var l=1;l<a.length;l++)"none"!=a[l].style.display&&(a[l].cells[e].getElementsByTagName("input")[t].checked=n);return}catch(n){alert2("Hiba: "+e+"-"+t+"\n"+n)}}function szem4_farmolo_csoport(t){try{var e=prompt("Falusz≈±r≈ë\nAdd meg azon faluk koordin√°t√°it, melyeket a list√°ban szeretn√©l l√°tni. A t√∂bbi falu csup√°n l√°thatatlan lesz, de tov√°bb folyik a haszn√°lata.\nSpeci√°lis lehet≈ës√©gid:\n-1: Csup√°n ezt az √©rt√©ket adva meg megford√≠t√≥dik a jelenlegi lista l√°that√≥s√°ga (neg√°ci√≥)\n-...: Ha az els≈ë karakter egy - jel, akkor a felsorolt faluk kivon√≥dnak a jelenlegi list√°b√≥l (k√ºl√∂nbs√©g)\n+...: Ha az els≈ë karaktered +, akkor a felsorolt faluk hozz√°ad√≥dnak a list√°hoz (uni√≥)\n√úresen leok√©zva az √∂sszes falu l√°that√≥v√° v√°lik");if(null==e)return;var n="norm";"-1"==e?n="negalt":("-"==e[0]&&(n="kulonbseg"),"+"==e[0]&&(n="unio")),""==e&&(n="all"),"S"==e&&(n="yellow"),e=e.match(/[0-9]+(\|)[0-9]+/g);for(var a,l=!1,o=document.getElementById("farm_"+t).rows,r=1;r<o.length;r++){switch(l=!1,a=o[r].cells[0].textContent,n){case"norm":e.indexOf(a)>-1&&(l=!0);break;case"negalt":"none"==o[r].style.display&&(l=!0);break;case"kulonbseg":"none"!=o[r].style.display&&-1==e.indexOf(a)&&(l=!0);break;case"unio":("none"!=o[r].style.display||e.indexOf(a)>-1)&&(l=!0);break;case"all":l=!0;break;case"yellow":"yellow"==o[r].cells[0].style.backgroundColor&&(l=!0)}l?o[r].setAttribute("style","display:line"):o[r].setAttribute("style","display:none")}hideFarms()}catch(t){alert2("Hiba: \n"+t)}}function getAllResFromVIJE(t){var e=ALL_UNIT_MOVEMENT[t];if(!e)return 0;var n=0;for(let t in e)n+=e[t][2];return isNaN(n)?(debug("getAllResFromVIJE","allRes is NaN at "+t+": "+JSON.stringify(e)),0):n}function subtractNyersValue(t,e){for(var n,a=document.getElementById("farm_hova").rows,l=1;l<a.length;l++)if((n=a[l].cells)[0].textContent==t){var o=parseInt(n[3].innerText,10);(o-=e)<0&&(o=0),n[3].innerHTML=o,DOMINFO_FARMS[t].nyers=o;break}}function clearAttacks(){try{const a=getServerTime().getTime();for(let l in ALL_UNIT_MOVEMENT){for(var t=[],e=ALL_UNIT_MOVEMENT[l].length-1;e>=0;e--)ALL_UNIT_MOVEMENT[l][e][1]<=a&&ALL_UNIT_MOVEMENT[l][e][0]<30?(subtractNyersValue(l,ALL_UNIT_MOVEMENT[l][e][2]),ALL_UNIT_MOVEMENT[l].splice(e,1),drawWagons(l)):ALL_UNIT_MOVEMENT[l][e][1]<=a-6e4*MAX_IDO_PERC*2?(ALL_UNIT_MOVEMENT[l].splice(e,1),drawWagons(l)):ALL_UNIT_MOVEMENT[l][e][1]<=a&&t.push(ALL_UNIT_MOVEMENT[l][e]);if(t){for(let e of t)3!=e.length&&debug("clearAttacks","Anomaly, nem szab√°lyszer≈± mozg√°s ("+l+"):"+JSON.stringify(e)+" -- √∂ssz:"+JSON.stringify(t)),e[2]>0&&(subtractNyersValue(l,e[2]),e[2]=0);if(!(t.length<2)){var n=t.reduce((function(t,e){return e[1]>t[1]?e:t}),t[0]);ALL_UNIT_MOVEMENT[l]=ALL_UNIT_MOVEMENT[l].filter((function(t){return t[1]>=n[1]})),drawWagons(l)}}}for(let t in ALL_VIJE_SAVED)ALL_VIJE_SAVED[t]<a-108e5&&(subtractNyersValue(t,4e5),delete ALL_VIJE_SAVED[t])}catch(t){debug("clearAttacks",t)}}function getProdHour(t){var e=0;if(t.split(",").length<3)e=""!=(e=document.getElementById("farmolo_options").termeles.value)?parseInt(e,10):1e3;else{var n=t.split(",").map((t=>parseInt(t,10)));e=(TERMELES[n[0]]+TERMELES[n[1]]+TERMELES[n[2]])*SPEED}return parseFloat(e.toFixed(2),10)}function updateDefaultProdHour(){const t=parseInt(document.getElementById("farmolo_options").termeles.value,10);for(koord in DOMINFO_FARMS)DOMINFO_FARMS[koord].buildings.iron||DOMINFO_FARMS[koord].buildings.stone||DOMINFO_FARMS[koord].buildings.wood||(DOMINFO_FARMS[koord].prodHour=t)}function getResourceProduction(t,e){try{"max"==e&&(e=parseInt(document.getElementById("farmolo_options").megbizhatosag.value,10));var n=e/60;return Math.round(t*n)}catch(t){debug("getResourceProduction",t)}}function convertTbToTime(t,e){return e/getProdHour(t)*60}function calculateNyers(t,e,n){try{var a=0,l=getServerTime();if(l.setSeconds(l.getSeconds()+60*n),l=l.getTime(),!ALL_UNIT_MOVEMENT[t])return a=getResourceProduction(DOMINFO_FARMS[t].prodHour,"max");allAttack=ALL_UNIT_MOVEMENT[t];var o=findClosestTimes(allAttack,l),r=o[0],s=o[1];if(a+=getResourceProduction(DOMINFO_FARMS[t].prodHour,r?(l-r[1])/6e4:"max"),s){let n=getProdHour(e),o=0;for(let t=0;t<allAttack.length;t++)if(allAttack[t][1]>l){let e=allAttack[t][0]/n*60*6e4,a=allAttack[t][1]-e;(0==o||o>a)&&(o=a)}o<l&&(a-=getResourceProduction(DOMINFO_FARMS[t].prodHour,(l-o)/6e4))}return a}catch(t){debug("calculateNyers",t)}}function findClosestTimes(t,e){let n=null,a=null;for(let l=0;l<t.length;l++){if(t[l][0]<50)continue;let o=t[l][1];o<e?(!n||o>n[1])&&(n=t[l]):o>e&&(!a||o<a[1])&&(a=t[l])}return[n,a]}function addCurrentMovementToList(t,e,n){try{var a=t.innerHTML.match(/<td>[0-9]+:[0-9]+:[0-9]+<\/td>/g)[0].match(/[0-9]+/g);a=3600*parseInt(a[0],10)+60*parseInt(a[1],10)+parseInt(a[2],10);var l=getServerTime();l.setSeconds(l.getSeconds()+a),l=l.getTime();var o=parseInt(t.querySelector(".icon.header.ressources").parentElement.innerText.replaceAll(".",""),10),r=0,s=DOMINFO_FARMS[e].nyers;s>0&&(s-=getAllResFromVIJE(e))>0&&(o-=r=Math.min(o,s)),o<10&&r<10&&debug("addCurrentMovementToList",`ERROR: ${t.querySelector(".icon.header.ressources").parentElement.innerText} -- teherb√≠r√°s=0; Farm: ${e} | Innen: ${FARM_REF.game_data.village.display_name}`);var i=ALL_UNIT_MOVEMENT[e];i?i.push([o,l,r]):ALL_UNIT_MOVEMENT[e]=[[o,l,r]],addWagons(n),FARM_REF.document.getElementById("place_confirm_units").querySelector('[data-unit="spy"]').getElementsByTagName("img")[0].classList.contains("faded")||(!ALL_SPY_MOVEMENTS[e]||ALL_SPY_MOVEMENTS[e]<l)&&(ALL_SPY_MOVEMENTS[e]=l)}catch(t){debug("addCurrentMovementToList",t),console.error(t)}}function planAttack(t,e,n,a){try{const o=document.getElementById("farm_honnan").rows,r=t.cells[0].textContent,s=document.getElementById("farmolo_options"),i=parseInt(s.minsereg.value,10),d=60*parseInt(s.maxtav_ora.value,10)+parseInt(s.maxtav_p.value,10);let c={};for(var l=1;l<o.length;l++){let s=o[l],m=1/SPEED*(1/UNIT_S);m*=distCalc(r.split("|"),s.cells[0].textContent.split("|"));let u=getSlowestUnit(s);if(""!=u)for(;;){if(m*E_SEB[u]>d)if("heavy"==u){if(m*E_SEB.light>d)break;u="light"}else{if("sword"!=u)break;if(m*E_SEB.spear>d)break;u="spear"}let l=m*E_SEB[u];if(-1!==n&&l>n)break;let o=calculateNyers(r,t.cells[1].textContent,l);isNaN(o)&&(o=0,debug("planAttack",`nyers_termeles = NaN - ${r}`)),isNaN(e)&&(e=0,debug("planAttack",`nyers_VIJE = NaN - ${r}`)),Number.isInteger(e)&&Number.isInteger(o)||debug("planAttack",`Nem is sz√°m: nyers_VIJE=${e} -- nyers_termeles=${o}`);let g=e+o;if(g<a){if("heavy"==u||"light"==u){u="sword";continue}break}let p=buildArmy(s,u,g);if(p.units.pop<i||p.teher<a)break;n=l,c={fromVill:s.cells[0].textContent,farmVill:r,units:{...p.units},travelTime:l,slowestUnit:u,nyersToFarm:g,debug_teher:p.teher,debug_hatar:a};break}}return c}catch(t){console.error(t),debug("planAttack",t)}}function buildArmy(t,e,n){try{let l=n;const o=t.cells[1].querySelectorAll(".szem4_unitbox"),r=UNITS.reduce(((t,e)=>(t[e]=0,t)),{});let s=!1;(""==t.cells[2].textContent.trim()||getServerTime()-new Date(t.cells[2].textContent)>6e5)&&(s=!0),o.forEach((t=>{t.querySelector("input").checked&&(s&&t.setAttribute("data-allunit",999),r[t.getAttribute("name")]=parseInt(t.getAttribute("data-allunit"),10))}));const i={pop:0};let d={};switch(e){case"heavy":if(d=a("heavy",n),0==d.pop)return{units:i,teher:l-n};if(n-=d.teher,i.heavy=d.unit,i.pop+=d.pop,n<40)break;case"light":if(d=a("marcher",n),0!==d.pop&&(n-=d.teher,i.marcher=d.unit,i.pop+=d.pop),n<40)break;d=a("light",n),0!==d.pop&&(n-=d.teher,i.light=d.unit,i.pop+=d.pop);break;case"sword":if(d=a("sword",n),0==d.pop)return{units:i,teher:l-n};if(n-=d.teher,i.sword=d.unit,i.pop+=d.pop,n<40)break;case"spear":if(d=a("spear",n),0!==d.pop&&(n-=d.teher,i.spear=d.unit,i.pop+=d.pop),n<20)break;if(d=a("axe",n),0!==d.pop&&(n-=d.teher,i.axe=d.unit,i.pop+=d.pop),n<20)break;d=a("archer",n),0!==d.pop&&(n-=d.teher,i.archer=d.unit,i.pop+=d.pop)}return{units:i,teher:l-n};function a(t,e){const n={pop:0,unit:0,teher:0};return r[t]<1||(r[t]*TEHER[t]>e?n.unit=Math.round(e/TEHER[t]):n.unit=r[t],n.pop=n.unit*TANYA[t],n.teher=n.unit*TEHER[t]),n}}catch(c){console.error(c),debug("buildArmy",c)}}function getSlowestUnit(t){try{let e=!1,n=t.cells[2].textContent;""!=n&&(n=new Date(n),n instanceof Date&&!isNaN(n.valueOf())||(n=""));const a=parseInt(document.getElementById("farmolo_options").sebesseg_p.value,10);(""==n||getServerTime()-n>6e4*a)&&(e=!0);const l=t.cells[1].querySelectorAll(".szem4_unitbox"),o={};return isUnit=!1,l.forEach((t=>{e&&t.querySelector("input").checked&&t.classList.remove("szem4_unitbox_not_available"),"spy"!==t.getAttribute("name")&&t.querySelector("input").checked&&!t.classList.contains("szem4_unitbox_not_available")&&(o[t.getAttribute("name")]=!0,isUnit=!0)})),o.heavy?"heavy":o.light||o.marcher?"light":o.sword?"sword":isUnit?"spear":""}catch(t){return debug("getSlowestUnit","Nem meg√°llap√≠that√≥ egys√©gsebess√©g, kl-t felt√©telezek "+t),E_SEB_ARR[5]}}function updateAvailableUnits(t,e=!1){try{t.cells[1].querySelectorAll(".szem4_unitbox").forEach((t=>{let n=t.getAttribute("name"),a=parseInt(FARM_REF.document.getElementById(`units_entry_all_${n}`).textContent.match(/[0-9]+/g)[0],10),l=FARM_REF.document.getElementById(`unit_input_${n}`).value;""==l&&(l=0);let o=e?0:parseInt(l,10);t.setAttribute("data-allunit",a-o),0==a||a-o<=0?t.classList.add("szem4_unitbox_not_available"):t.classList.remove("szem4_unitbox_not_available")})),t.cells[2].innerHTML=getServerTime().toLocaleString()}catch(t){console.error(t),debug("updateAvailableUnits",t)}}function setNoUnits(t,e){try{t.cells[1].querySelectorAll(".szem4_unitbox").forEach((t=>{let n=t.getAttribute("name");"troop"!=e||"spear"!=n&&"sword"!=n&&"axe"!=n&&"archer"!=n||(t.classList.add("szem4_unitbox_not_available"),t.setAttribute("data-allunit",0)),"horse"!=e||"light"!=n&&"marcher"!=n&&"heavy"!=n||(t.classList.add("szem4_unitbox_not_available"),t.setAttribute("data-allunit",0)),"all"==e&&(t.classList.add("szem4_unitbox_not_available"),t.setAttribute("data-allunit",0))})),t.cells[2].innerHTML=getServerTime().toLocaleString()}catch(t){console.error(t),debug("updateAvailableUnits",t)}}function szem4_farmolo_1kereso(){try{var t=document.getElementById("farm_hova").rows,e=document.getElementById("farm_honnan").rows;if(1==t.length||1==e.length)return"zero";var n=!1;const r=parseInt(document.getElementById("farmolo_options").targetIdo.value,10),s=parseInt(document.getElementById("farmolo_options").maxfal.value,10);let i={travelTime:-1};for(var a=1;a<t.length;a++){if("red"==t[a].cells[0].style.backgroundColor)continue;var l=t[a].cells[0].textContent;if(DOMINFO_FARMS[l].buildings.wall>s)continue;let e=DOMINFO_FARMS[l].prodHour*(r/60);var o=DOMINFO_FARMS[l].nyers;o>0&&(o-=getAllResFromVIJE(l)),n=!1,o>4*e&&(n=!0);let d=planAttack(t[a],o,n?-1:i.travelTime,e);if(d.travelTime&&(-1==i.travelTime||d.travelTime<i.travelTime)&&(i=JSON.parse(JSON.stringify(d))),n&&d.travelTime){i=JSON.parse(JSON.stringify(d));break}}return i}catch(t){return debug("szem4_farmolo_1kereso()",t),"ERROR"}}function szem4_farmolo_2illeszto(t){try{try{TamadUpdt(FARM_REF)}catch(t){}const s=document.getElementById("farmolo_options"),i=parseInt(s.minsereg.value,10),d=parseInt(s.kemperc.value,10),c=parseInt(s.kemdb.value,10),m=parseInt(s.raktar.value,10),u=parseInt(s.targetIdo.value,10),g=DOMINFO_FARMS[t.farmVill].prodHour*(u/60),p=FARM_REF.document.forms.units;if(document.querySelector("#place_target .village-item")&&document.querySelector("#place_target .village-item").click(),!p){if(!FARM_REF.document.getElementById("command-data-form"))throw"Nincs gy√ºlekez≈ëhely?";p=FARM_REF.document.getElementById("command-data-form"),debug("szem4_farmolo_2illeszto","ROllback-to-IDForm")}if(null==p.input.value)throw"Nem t√∂lt√∂tt be az oldal? "+p.input.innerHTML;for(var e,n=document.getElementById("farm_honnan").rows,a=1;a<n.length;a++)if(n[a].cells[0].textContent==t.fromVill){e=n[a];break}updateAvailableUnits(e);const _=buildArmy(e,t.slowestUnit,t.nyersToFarm);if(!_.units||_.units.pop<i||_.teher<g)return console.info(`Invalid config, replanning. minSereg: ${i}, hatarszam: ${g}, prodHour: ${DOMINFO_FARMS[t.farmVill].prodHour} Config was:`,JSON.stringify(t),"Config expected: ",JSON.stringify(_)),"semmi";t.nyersToFarm=_.teher,Object.entries(_.units).forEach((t=>{const[e,n]=t;"pop"!==e&&(p[e].value=n)})),p.spy.value=0;let h=0;if(e.cells[1].getElementsByTagName("input")[4].checked){var l=distCalc(t.fromVill.split("|"),t.farmVill.split("|"))*E_SEB[t.slowestUnit]*(1/SPEED)*(1/UNIT_S),o=getServerTime();if(o=o.setSeconds(o.getSeconds()+60*l),!ALL_SPY_MOVEMENTS[t.farmVill]||o-ALL_SPY_MOVEMENTS[t.farmVill]>6e4*d){let t=FARM_REF.document.getElementById("unit_input_spy").parentNode.children[2].textContent.match(/[0-9]+/g)[0];t=parseInt(t,10),h=t>=c?c:0,p.spy.value=h}}var r=(FARM_REF.game_data.village.wood+FARM_REF.game_data.village.stone+FARM_REF.game_data.village.iron)/3/FARM_REF.game_data.village.storage_max;return Math.round(100*r)>parseInt(m)?(setNoUnits(e,"all"),naplo("Farmol√≥","Rakt√°r t√∫ltel√≠tett ebben a faluban: "+t.fromVill+". ("+Math.round(100*r)+"% > "+m+"%)"),"semmi"):(p.x.value=t.farmVill.split("|")[0],p.y.value=t.farmVill.split("|")[1],updateAvailableUnits(e),p.attack.click(),t.units=JSON.parse(JSON.stringify(_.units)),{plannedArmy:t,kem:h})}catch(t){return debug("Illeszto()",t),FARM_LEPES=0,""}}function szem4_farmolo_3egyeztet(t){try{for(var e=document.getElementById("farm_honnan").rows,n=1;n<e.length;n++)if(e[n].cells[0].textContent==t.plannedArmy.fromVill){e=e[n];break}var a=document.getElementById("farm_hova").rows;for(n=1;n<a.length;n++)if(a[n].cells[0].textContent==t.plannedArmy.farmVill){a=a[n];break}try{if("error_box"==FARM_REF.document.getElementById("content_value").getElementsByTagName("div")[0].getAttribute("class"))return naplo("Farmol√≥",`Hiba  ${t.plannedArmy.farmVill} farmol√°s√°n√°l: ${FARM_REF.document.getElementById("content_value").getElementsByTagName("div")[0].textContent}. Tov√°bb nem t√°madom`),a.cells[0].style.backgroundColor="red",DOMINFO_FARMS[t.plannedArmy.farmVill].szin.falu="red",FARM_REF.document.querySelector(".village-item")&&FARM_REF.document.querySelector(".village-item").click(),updateAvailableUnits(e,!0),"ERROR"}catch(t){console.error("szem4_farmolo_3egyeztet - piros sz√∂veg",t)}try{if(FARM_REF.document.getElementById("content_value").getElementsByTagName("table")[0].rows[2].cells[1].getElementsByTagName("a")[0].href.indexOf("info_player")>-1&&!a.cells[4].getElementsByTagName("input")[0].checked)return naplo("Farmol√≥",`J√°t√©kos ${maplink(t.plannedArmy.farmVill)} helyen: ${FARM_REF.document.getElementById("content_value").getElementsByTagName("table")[0].rows[2].cells[1].innerHTML.replace("href",'target="_BLANK" href')}. Tov√°bb nem t√°madom`),FARM_REF=windowOpener("farm",VILL1ST.replace("screen=overview","screen=place"),AZON+"_Farmolo"),a.cells[0].style.backgroundColor="red",updateAvailableUnits(e,!0),"ERROR"}catch(t){}let l=FARM_REF.document.querySelector("#content_value .vis").rows[2].cells[1].textContent,o=l.split(":").map((t=>parseInt(t,10)));if(o=60*o[0]+o[1]+o[2]/60,Math.abs(o-t.plannedArmy.travelTime)>.05)return debug("szem4_farmolo_3egyeztet",`A tervezett id≈ë (${t.plannedArmy.travelTime} perc) nem egyezik a k√ºldend≈ë id≈ëvel: ${l}.`),"ERROR";t.kem>0&&""==a.cells[1].textContent&&(a.cells[1].style.backgroundColor="rgb(213, 188, 244)"),addCurrentMovementToList(FARM_REF.document.getElementById("command-data-form"),t.plannedArmy.farmVill,a),FARM_REF.document.getElementById("troop_confirm_submit").click(),document.getElementById("cnc_farm_heartbeat").innerHTML=(new Date).toLocaleString();const r=parseInt(document.getElementById("farmolo_options").megbizhatosag.value,10),s=DOMINFO_FARMS[t.plannedArmy.farmVill].prodHour;t.plannedArmy.nyersToFarm>s*(r/60)*3?playSound("farmolas_exp","mp3"):playSound(`farmolas_${Math.floor(1+11*Math.random())}`,"mp3")}catch(t){debug("szem4_farmolo_3egyeztet()",t),FARM_LEPES=0}}function szem4_farmolo_4visszaell(t){try{for(var e=document.getElementById("farm_honnan").rows,n=1;n<e.length;n++)if(e[n].cells[0].textContent==t[2]){e=e[n];break}if(updateAvailableUnits(e,!0),"boolean"==typeof t[1])var a=t[1];else if(t[1].indexOf("all")>-1)a=!0;else a=!1;if(a){var l=!1;for(n=0;n<3;n++)if(e.cells[1].getElementsByTagName("input")[n].checked&&FARM_REF.document.getElementById("unit_input_"+UNITS[n])&&parseInt(FARM_REF.document.getElementById("unit_input_"+UNITS[n]).parentNode.children[2].textContent.match(/[0-9]+/g)[0])>5){l=!0;break}l||(a=!1)}var o=e.cells[1].getElementsByTagName("input"),r=22;for(n=0;n<o.length;n++)4!=n&&o[n].checked&&E_SEB_ARR[n]<r&&(r=E_SEB_ARR[n]);r=r*(1/SPEED)*(1/UNIT_S)}catch(t){return void debug("szem4_farmolo_4visszaell()",t)}}function szem4_farmolo_motor(){var t=500,e=!1;try{if(t=parseInt(document.getElementById("farmolo_options").sebesseg_m.value,10),BOT||FARM_PAUSE||USER_ACTIVITY)t=5e3;else switch(FARM_HIBA>10&&(FARM_HIBA=0,FARM_GHIBA++,FARM_LEPES=0,FARM_GHIBA>3&&(FARM_GHIBA>5&&(naplo("Glob√°l","Nincs internet? Folyamatos hiba farmol√≥n√°l"),t=6e4,playSound("bot2")),FARM_REF.close())),FARM_LEPES){case 0:if("zero"==(PM1=szem4_farmolo_1kereso())||"ERROR"==PM1){t=1e4;break}if(-1==PM1.travelTime){t=parseInt(document.getElementById("farmolo_options").sebesseg_p.value,10),e=!0,t*=6e4;try{MOBILE_MODE?FARM_REF.close():FARM_REF.document.title="Szem4/farmol√≥"}catch(t){}break}(!isPageLoaded(FARM_REF,koordTOid(PM1.fromVill),"screen=place")||FARM_REF.document.location.href.indexOf("try=confirm")>-1||FARM_REF.document.location.href.includes("mode=")&&!FARM_REF.document.location.href.includes("mode=command"))&&(FARM_REF=windowOpener("farm",VILL1ST.replace(/village=[0-9]+/,"village="+koordTOid(PM1.fromVill)).replace("screen=overview","screen=place"),AZON+"_Farmolo")),FARM_LEPES=1;break;case 1:isPageLoaded(FARM_REF,koordTOid(PM1.fromVill),"screen=place")?(FARM_REF.document.title="Szem4/farmol√≥",PM1=szem4_farmolo_2illeszto(PM1),FARM_HIBA=0,FARM_GHIBA=0,FARM_LEPES="semmi"===PM1?0:2):FARM_HIBA++;break;case 2:if(!PM1.plannedArmy||!PM1.plannedArmy.fromVill){FARM_LEPES=0,debug("szem4_farmolo_motor","√ârv√©nytelen √°llapot"+("object"==typeof PM1?JSON.parse(PM1):PM1));break}isPageLoaded(FARM_REF,koordTOid(PM1.plannedArmy.fromVill),"try=confirm")?(FARM_HIBA=0,FARM_GHIBA=0,"ERROR"===(PM1=szem4_farmolo_3egyeztet(PM1))&&(FARM_LEPES=0),FARM_LEPES=0):FARM_HIBA++;break;case 3:isPageLoaded(FARM_REF,koordTOid(PM1[2]),"not try=confirm")?(FARM_HIBA=0,FARM_GHIBA=0,szem4_farmolo_4visszaell(PM1),FARM_LEPES=0):FARM_HIBA++;break;default:FARM_LEPES=0}}catch(t){debug("szem4_farmolo_motor()",t+" L√©p√©s:"+FARM_LEPES)}var n=100/(40*Math.random()+80);t=Math.round(t*n),e&&debug("Farmol√≥",`Farmol√≥ pihenni megy ${Math.round(t/6e4)} percre`);try{worker.postMessage({id:"farm",time:t})}catch(t){debug("farm","Worker engine error: "+t),setTimeout((function(){szem4_farmolo_motor()}),3e3)}}init(),ujkieg_hang("Alaphangok","naplobejegyzes;bot2;farmolas"),ujkieg("farm","Farmol√≥",`<tr><td>\n\t<table class="vis" id="farm_opts" style="width:100%; margin-bottom: 50px;">\n\t\t<tr>\n\t\t\t<th colspan="2">Be√°ll√≠t√°sok</th>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td colspan="2" style="text-align: center">\n\t\t\t<form id="farmolo_options">\n\t\t\t<table>\n\t\t\t<tr><td><div class="combo-cell"><div class="imgbox"><img src="${pic("mozdony.png")}"></div><strong>Szerelv√©nyek</strong></div></td>\n\t\t\t<td>\n\t\t\tMenetrend: <input name="targetIdo" value="30" onkeypress="validate(event)" type="text" size="2" onmouseover="sugo(this, 'SZEM arra fog t√∂rekedni, hogy minimum ennyi id≈ëk√∂z√∂nk√©nt ind√≠tson t√°mad√°st egy falura')">p - \n\t\t\t<input name="megbizhatosag" value="60" onkeypress="validate(event)" type="text" size="2" onmouseover="sugo(this, 'Megb√≠zhat√≥s√°g. MAX ennyi ideig l√©trej√∂tt termel√©s√©rt indul (plusz felder√≠tett nyers)')">p\n\t\t\tMax t√°v: <input name="maxtav_ora" type="text" size="2" value="4" onkeypress="validate(event)" onmouseover="sugo(this,'A max t√°vols√°g, amin t√∫l m√°r nem k√ºld√∂k t√°mad√°sokat')">√≥ra <input name="maxtav_p" onkeypress="validate(event)" type="text" size="2" value="0" onmouseover="sugo(this,'A max t√°vols√°g, amin t√∫l m√°r nem k√ºld√∂k t√°mad√°sokat')">perc.\n\t\t\t</td></tr>\n\n\t\t\t<tr>\n\t\t\t<td><div class="combo-cell"><div class="imgbox">${picBuilding("wall")}</div><strong>Fal szint</strong></div></td>\n\t\t\t<td>Ha a fal &gt; <input type="text" size="3" name="maxfal" onkeypress="validate(event)" value="3" onmouseover="sugo(this,'√âlesen nagyobb! 0 eset√©n a fallal rendelkez≈ëeket nem t√°madja.')">, nem t√°madja</td>\n\t\t\t</tr>\n\n\t\t\t<tr><td><div class="combo-cell"><div class="imgbox"><img src="${pic("beallitasok.png")}"></div><strong>Alap√©rt√©kek</strong></div></td>\n\t\t\t<td>\n\t\t\tTermel√©s/√≥ra: <input name="termeles" onkeypress="validate(event)" type="text" size="5" value="800" onchange="updateDefaultProdHour()" onmouseover="sugo(this,'Ha nincs felder√≠tett b√°nyaszint, √∫gy veszi ennyi nyers termel≈ëdik ott √≥r√°nk√©nt')">\t\t\t\t\n\t\t\tMin sereg/falu: <input name="minsereg" onkeypress="validate(event)" type="text" value="20" size="4" onmouseover="sugo(this,'Enn√©l kevesebb f≈ë t√°mad√°sonk√©nt nem indul. A sz√°m tanyahely szerinti foglal√°sban √©rtend≈ë. Javasolt: Hat√°rsz√°m 1/20-ad r√©sze')">\n\t\t\tHa a rakt√°r &gt;<input name="raktar" onkeypress="validate(event)" type="text" size="2" onmouseover="sugo(this,'Figyeli a rakt√°r tel√≠tetts√©g√©t, √©s ha a megadott % f√∂l√© emelkedik, nem ind√≠t t√°mad√°st onnan. Tel√≠tetts√©g √∂ssznyersanyag alapj√°n sz√°molva. Min: 20. Ne n√©zze: 100-n√°l t√∂bb √©rt√©k megad√°sa eset√©n.')" value="90">%, nem foszt.\n\t\t\t</td></tr>\n\n\t\t\t<tr><td><div class="combo-cell"><div class="imgbox"><img src="/graphic/unit/unit_spy.png"></div><strong>K√©mek</strong></div></td>\n\t\t\t<td>\n\t\t\tK√©m/falu: <input name="kemdb" onkeypress="validate(event)" type="text" value="1" size="2" onmouseover="sugo(this,'A k√©mes t√°mad√°sokkal ennyi k√©m fog menni')">\n\t\t\tK√©nyszer√≠tett?<input name="isforced" type="checkbox" onmouseover="sugo(this,'K√©mek n√©lk√ºl nem ind√≠t t√°mad√°st, ha k√©ne k√ºldenie az id≈ëlimit eset√©n. K√©meket annak ellen√©re is fog vinni, ha nincs bepip√°lva a k√©m egys√©g')">\n\t\t\tK√©m/perc: <input name="kemperc" type="text" value="60" onkeypress="validate(event)" size="3" onmouseover="sugo(this,'Max ekkora id≈ëk√∂z√∂nk√©nt k√ºld k√©met falunk√©nt')">\n\t\t\t</td></tr>\n\t\t\t\n\t\t\t<tr><td><div class="combo-cell"><div class="imgbox"><img src="${pic("sebesseg.png")}"></div><strong>Sebess√©g</strong></div></td>\n\t\t\t<td>\n\t\t\t<input name="sebesseg_p" onkeypress="validate(event)" type="text" size="2" value="10"  onmouseover="sugo(this,'Ha a farmol√≥ nem tal√°l t√∂bb feladatot mag√°nak meg√°ll, ennyi id≈ëre. √ârt√©k lehet: 1-300. Javasolt √©rt√©k: 15 perc')">perc /\n\t\t\t\t\t\t<input name="sebesseg_m" onkeypress="validate(event)" type="text" size="3" value="900" onmouseover="sugo(this,'Egyes utas√≠t√°sok/lapbet√∂lt≈ëd√©sek ennyi id≈ëk√∂z√∂nk√©nt hajt√≥dnak v√©gre. √ârt√©k lehet: 200-6000. Javasolt: g√©pi: 500ms, emberi: 3000.')">ms.\n\t\t\t</td></tr></table>\n\t\t\t</form>\n\t\t\t</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<th>Farmol√≥ falu hozz√°ad√°sa</th>\n\t\t\t<th>Farmoland√≥ falu hozz√°ad√°sa</th>\n\t\t</tr><tr>\n\t\t\t<td style="width:48%;" onmouseover="sugo(this,'Adj meg koordin√°t√°kat, melyek a te faluid √©s farmolni szeretn√©l vel√ºk. A koordin√°t√°k elv√°laszt√°sa b√°rmivel t√∂rt√©nhet.')">\n\t\t\t\tKoordin√°t√°k: <input type="text" size="45" id="add_farmolo_faluk" placeholder="111|111, 222|222, ...">\n\t\t\t\t<input type="button" value="Hozz√°ad" onclick="add_farmolo()">\n\t\t\t</td>\n\t\t\t<td style="width:52%;" onmouseover="sugo(this,'Adj meg koordin√°t√°kat, amelyek farmok, √©s farmolni szeretn√©d. A koordin√°t√°k elv√°laszt√°sa b√°rmivel t√∂rt√©nhet.')">\n\t\t\t\tKoordin√°t√°k: <input type="text" size="45" id="add_farmolando_faluk" placeholder="111|111, 222|222, ...">\n\t\t\t\t<input type="button" value="Hozz√°ad" onclick="add_farmolando()">\n\t\t\t</td>\n\t\t</tr><tr>\n\t\t\t<td onmouseover="sugo(this,'A felvivend≈ë falukb√≥l ezeket az egys√©geket haszn√°lhatja SZEM IV farmol√°s c√©lj√°b√≥l. K√©s≈ëbb m√≥dos√≠that√≥.')" id="add_farmolo_egysegek" style="vertical-align:middle;">\n\t\t\t\tMivel? ${rovidit("egysegek")}\n\t\t\t</td>\n\t\t\t<td>\n\t\t\t</td>\n\t\t</tr><tr>\n\t\t\t<td colspan="2" class="nopadding_td">\n\t\t\t\t<div class="heartbeat_wrapper">\n\t\t\t\t\t<img src="${pic("heart.png")}" class="heartbeat_icon" onclick="restartKieg('farm')">\n\t\t\t\t\t<span id="cnc_farm_heartbeat">---</span>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t</tr>\n\t</table>\n\t<div class="szem4_farmolo_datatable_wrapper">\n\t\t<table class="vis" id="farm_honnan" style="vertical-align:top; display: inline-block;"><tr>\n\t\t\t<th width="55px" onmouseover="sugo(this,'Ezen falukb√≥l farmolsz. Dupla klikk az √©rintett sor koordin√°t√°j√°ra=sor t√∂rl√©se.<br>Rendezhet≈ë')" style="cursor: pointer;" onclick='rendez("szoveg",false,this,"farm_honnan",0)'>Honnan</th>\n\t\t\t<th onmouseover="sugo(this,'Ezen egys√©geket haszn√°lja fel SZEM a farmol√°shoz. B√°rmikor m√≥dos√≠that√≥. √Åth√∫zott: jelenleg nincs a faluban ilyen egys√©g')">Mivel?</th>\n\t\t\t<th onmouseover="sugo(this,'Ekkor n√©ztem a falu √°llapot√°t utolj√°ra. Dupla klikk=t√∂rl√©s=n√©zd √∫jra.<br>Rendezhet≈ë.<br><br>Pipa: egy cell√°n v√©grehajtott (duplaklikkes) m≈±velet minden l√°that√≥ falura √©rv√©nyes lesz.')" onclick='rendez("datum",false,this,"farm_honnan",2)' style="cursor: pointer; vertical-align:middle; line-height: 18px;">\n\t\t\t\tFriss√≠tve\n\t\t\t\t<span style="margin-left: 20x; margin-right: 0px;">\n\t\t\t\t\t<img src="${pic("search.png")}" alt="?" title="Sz≈±r√©s falukra..." style="width:15px;height:15px;" onclick="szem4_farmolo_csoport('honnan')">\n\t\t\t\t\t<input type="checkbox" id="farm_multi_honnan" onmouseover="sugo(this,'Ha bepip√°lod, akkor egy cell√°n v√©gzett dupla klikkes m≈±velet minden sorra √©rv√©nyes lesz az adott oszlopba (teh√°t minden falura), ami jelenleg l√°tszik. L√©gy √≥vatos!')">\n\t\t\t\t</span>\n\t\t\t</th>\n\t\t</tr></table>\t\t<table class="vis" id="farm_hova" style="vertical-align:top; display: inline-block;"><tr>\n\t\t\t<th onmouseover="sugo(this,'Ezen falukat farmolod. A h√°tt√©rsz√≠n jel√∂li a jelent√©s sz√≠n√©t: alap√©rtelmezett=z√∂ld jelik/nincs felder√≠tve. S√°rga=vesztes√©g volt a falun. Piros: a t√°mad√°s bes√ºlt, nem megy r√° t√∂bb t√°mad√°s.<br>Dupla klikk a koordira: a h√°tt√©rsz√≠n alap√©rtelmezettre √°ll√≠t√°sa.<br>Rendezhet≈ë')" style="cursor: pointer;" onclick='rendez("szoveg",false,this,"farm_hova",0)'>Hova</th>\n\t\t\t<th onmouseover="sugo(this,'Felder√≠tett b√°nyaszintek, ha van. K√©k h√°tt√©r: megy r√° k√©mt√°mad√°s.<br>Dupla klikk=az √©rintett sor t√∂rl√©se')">B√°ny√°k</th>\n\t\t\t<th onmouseover="sugo(this,'Fal szintje. Szimpla klikk: Katapultoz√≥ scriptet megtan√≠tja az adott falu √©p√ºletszintjeire. Dupla klikk=h√°tt√©r csere (csak megjel√∂l√©sk√©nt). 2 f√©le lehet: a z√∂ld h√°tt√©r a falszint v√°ltoz√°s√°ra elt≈±nik, a k√©k keret viszont csak manu√°lisan t√∂r√∂lhet≈ë.<br>Rendezhet≈ë.')" onclick='rendez("szam",false,this,"farm_hova",2)' style="cursor: pointer;">Fal</th>\n\t\t\t<th onmouseover="sugo(this,'Sz√°m√≠t√°sok szerint ennyi nyers van az √©rintett faluba. Dupla klikk=√©rt√©k m√≥dos√≠t√°sa.<br>Rendezhet≈ë.')" onclick='rendez("szam",false,this,"farm_hova",3)' style="cursor: pointer;">Nyers</th>\n\t\t\t<th onmouseover="sugo(this,'J√°t√©kos e? Ha j√°t√©kost szeretn√©l t√°madni, pip√°ld be a falut mint j√°t√©kos uralta, √≠gy t√°madni fogja. Ellenben piros h√°tteret kap a falu. (WIP: Nem ismer fake-limitet!)')">J?</th>\n\t\t\t<th onmouseover="sugo(this,'T√°mad√°sokat tudod itt nyomon k√∂vetni szerelv√©nyek form√°j√°ban, melyek a t√°mad√°si algoritmus alapjait k√©pzik<br><br>Pipa: egy cell√°n v√©grehajtott (duplaklikkes) m≈±velet minden l√°that√≥ falura √©rv√©nyes lesz.')" style="cursor: pointer; vertical-align:middle;">\n\t\t\t\t---\n\t\t\t\t<span style="margin-left: 65px; margin-right: 0px;">\n\t\t\t\t\t<img src="${pic("search.png")}" alt="?" title="Sz≈±r√©s falukra..." style="width:15px;height:15px;" onclick="szem4_farmolo_csoport('hova')">\n\t\t\t\t\t<input type="checkbox" id="farm_multi_hova">\n\t\t\t\t</span>\n\t\t\t</th>\n\t\t</tr></table>\n</div></p></td></tr>`);var FARM_REF,FARMOLO_TIMER,PM1,FARM_LEPES=0,FARM_HIBA=0,FARM_GHIBA=0,BOT=!1,ALL_UNIT_MOVEMENT={},ALL_SPY_MOVEMENTS={},DOMINFO_FARMS={},FARM_PAUSE=!0;function VIJE_elemzett(t){try{var e=document.getElementById("VIJE_elemzett").textContent;if(""==e)return!1;e=e.split(",");for(var n=0;n<e.length;n++)if(e[n]==t)return!0;return e.length>130&&(document.getElementById("VIJE_elemzett").innerHTML=e.slice(e.length-100,e.length)),!1}catch(t){debug("VIJE1_farmelem","Hiba: "+t)}}function VIJE_IntelliAnalyst_isRequired(t,e,n){if(n.setSeconds(59),ALL_VIJE_SAVED[t]&&ALL_VIJE_SAVED[t]>n)return!1;if(!!e.querySelector('img[src*="spy"]'))return!0;let a=DOMINFO_FARMS[t].nyers;return a>0&&(a-=getAllResFromVIJE(t)),a>100}function szem4_VIJE_1kivalaszt(){try{try{TamadUpdt(VIJE_REF1)}catch(p){}if(VT=VIJE_REF1.document.getElementById("report_list").rows,VT.length<3)return[0,0,"",!1];var t=!1;let g="";for(var e=VT.length-2;e>0;e--){var n=VT[e].cells[1].getElementsByTagName("span")[0].getAttribute("data-id").replace("label_","");if(VIJE_elemzett(n))continue;try{var a=VT[e].cells[1].textContent.match(/[0-9]+(\|)[0-9]+/g);a=a[a.length-1]}catch(h){continue}var l=d(a);if(0==l[0])continue;var o=getServerTime(VIJE_REF1),r=getServerTime(VIJE_REF1);if(c=void 0,m=void 0,u=void 0,c=VT[e].cells[2].textContent,m=c.match(/[0-9]+:[0-9]+/g)[0],u=c.replace(m,"").match(/[0-9]+/g)[0],o.setMinutes(parseInt(m.split(":")[1],10)),o.setHours(parseInt(m.split(":")[0],10)),o.setDate(parseInt(u,10)),r-o>108e5||r-o<0)var s=!0;else s=!1;if(0==l[1]){VT[e].cells[0].getElementsByTagName("input")[0].checked=!0,t=!0;break}if(s)continue;const _=l[2];g=VT[e].cells[1].childNodes;for(var i=0;i<g.length;i++)if("IMG"==g[i].nodeName){g=g[i].src.split(".png")[0].split("/"),g=g[g.length-1];break}if(g.includes("green")?(VT[e].cells[0].getElementsByTagName("input")[0].checked=!0,_.cells[0].style.backgroundColor="#f4e4bc"):g.includes("yellow")?(_.cells[0].style.backgroundColor="yellow",DOMINFO_FARMS[a].szin.falu="yellow"):g.includes("blue")||"red"===_.cells[0].style.backgroundColor||(_.cells[0].style.backgroundColor="red",DOMINFO_FARMS[a].szin.falu="red",naplo("Jelent√©s Elemz≈ë",`${a} farm vesz√©lyesnek √≠t√©lve. Jelent√©s√©nek sz√≠ne ${g}.`)),VIJE_IntelliAnalyst_isRequired(a,VT[e].cells[1],o)&&1==l[1]){t=!0;break}}if(!t){for(e=VT.length-2;e>0;e--)if(VT[e].cells[0].getElementsByTagName("input")[0].checked)return szem4_VIJE_3torol(),[0,0,"",!0];return[0,0,"",!1]}return[n,a,g,!1,s];function d(t){try{for(var e=document.getElementById("farm_hova").rows,n=!1,a=1;a<e.length;a++)if(e[a].cells[0].textContent==t){n=!0,e=e[a];break}if(!n)return[!1,!1,0];var l=!0;return""==e.cells[1].textContent&&(l=!1),[n,l,e,!0]}catch(t){debug("VIJE1_farmelem","Hiba: "+t)}}}catch(f){return debug("VIJE1","Hiba: "+f),[0,0,"",!1]}var c,m,u}function VIJE_adatbeir(t,e,n,a,l,o){try{for(var r=document.getElementById("farm_hova").rows,s=1;s<r.length;s++)if(r[s].cells[0].textContent==t){r=r[s];break}if(r.cells[0].setAttribute("data-age",0),""!==n&&(r.cells[1].innerHTML=n,DOMINFO_FARMS[t].prodHour=getProdHour(n.join(",")),r.cells[1].style.backgroundColor="",""==a&&(a=0,0!==parseInt(r.cells[2].innerHTML)&&(r.cells[2].style.backgroundColor="",DOMINFO_FARMS[t].szin.fal=""))),"SEREG"==l&&(r.cells[0].style.backgroundColor="red",DOMINFO_FARMS[t].szin=DOMINFO_FARMS[t].szin||{},DOMINFO_FARMS[t].szin.falu="red",naplo("VIJE",`${t} -- Sereg a faluban!`)),""!==a&&(parseInt(r.cells[2].textContent.trim(),10)!==parseInt(a,10)&&(r.cells[2].style.backgroundColor="",DOMINFO_FARMS[t].szin.fal=""),r.cells[2].innerHTML=`\n\t\t<span class="tooltip_hover">\n\t\t\t${a}\n\t\t\t<span class="tooltip_text"></span>\n\t\t</span>`,DOMINFO_FARMS[t].buildings.wall=a),""!==e&&(r.cells[3].innerHTML=e,DOMINFO_FARMS[t].nyers=e,(!ALL_VIJE_SAVED[t]||ALL_VIJE_SAVED[t]<o)&&(ALL_VIJE_SAVED[t]=o)),ALL_UNIT_MOVEMENT[t]){var i=null;ALL_UNIT_MOVEMENT[t].forEach((t=>{var e=Math.abs(t[1]-o);(!i||e<i)&&(i=e)})),i>6e4&&ALL_UNIT_MOVEMENT[t].push([1e4,o,0])}else ALL_UNIT_MOVEMENT[t]=[[1e4,o,0]];drawWagons(t)}catch(t){debug("VIJE_adatbeir","Hiba: "+t)}}function szem4_VIJE_2elemzes(t){try{for(var e=0,n=!1,a=VIJE_REF2.document.getElementById("attack_info_att").parentNode;"TABLE"!=a.nodeName;)a=a.parentNode;var l=a.rows[1].cells[1].innerText,o=VIJE_REF2.document.getElementById("attack_info_def_units");if(o&&o.textContent.match(/[1-9]+/g)&&(t[2]="SEREG"),l=(l=new Date(Date.parse(l.replace(/jan\./g,"Jan").replace(/febr?\./g,"Feb").replace(/m√°rc\./g,"Mar").replace(/√°pr\./g,"Apr").replace(/m√°j\./g,"May").replace(/j√∫n\./g,"Jun").replace(/j√∫l\./g,"Jul").replace(/aug\./g,"Aug").replace(/szept\./g,"Sep").replace(/okt\./g,"Oct").replace(/nov\./g,"Nov").replace(/dec\./g,"Dec")))).getTime(),ALL_VIJE_SAVED[t[1]]>=l&&(n=!0),!n&&VIJE_REF2.document.getElementById("attack_spy_resources")){var r=VIJE_REF2.document.getElementById("attack_spy_resources").rows[0].cells[1];if(t[4]){e="";debug("VIJE2","Nem kell elemezni (r√©gi)")}else try{if(/\d/.test(r.textContent))for(var s=r.textContent.replace(/\./g,"").match(/[0-9]+/g),i=(e=0,0);i<s.length;i++)e+=parseInt(s[i],10);else e=0}catch(n){e=0;debug("VIJE","<a href='"+VIJE_REF2.document.location+"' target='_BLANK'>"+t[0]+"</a> ID-j≈± jelent√©s nem szokv√°nyos, tal√°lt nyers 0-ra √°ll√≠tva. Hiba: "+n)}if(VIJE_REF2.document.getElementById("attack_spy_buildings_left")){var d=document.getElementById("vije_opts");const e={main:1,barracks:0,stable:0,garage:0,smith:0,market:0,wood:0,stone:0,iron:0,farm:0,wall:0};var c=VIJE_REF2.document.getElementById("attack_spy_buildings_left").rows,m=VIJE_REF2.document.getElementById("attack_spy_buildings_right").rows;for(i=1;i<c.length;i++){let t=c[i].cells[0].textContent.toUpperCase().trim(),n=m[i].cells[0].textContent.toUpperCase().trim();for(const a in e)t.includes(d[a].value.toUpperCase())&&(e[a]=parseInt(c[i].cells[1].textContent,10)),n.includes(d[a].value.toUpperCase())&&(e[a]=parseInt(m[i].cells[1].textContent,10))}DOMINFO_FARMS[t[1]].buildings=JSON.parse(JSON.stringify(e)),0==e.wall&&0==e.barracks&&(e.wall--,2==e.main&&e.wall--,1==e.main&&(e.wall-=2));var u=[e.wood,e.stone,e.iron],g=e.wall}else u="",g="";VIJE_adatbeir(t[1],e,u,g,t[2],l)}else if(!n){var p=VIJE_REF2.document.getElementById("attack_results"),_=p?p.rows[0].cells[2].innerText.split("/").map((t=>parseInt(t,10))):0;s="";_[0]+5<_[1]&&(s=0,VIJE_adatbeir(t[1],s,"","",t[2],l))}return document.getElementById("VIJE_elemzett").innerHTML+=t[0]+",",document.getElementById("VIJE_elemzett").innerHTML.split(",").length>200&&(document.getElementById("VIJE_elemzett").innerHTML=document.getElementById("VIJE_elemzett").innerHTML.split(",").splice(100,100)+","),VIJE2_HIBA=0,VIJE2_GHIBA=0,!0}catch(n){return debug("VIJE2","Elemezhetetlen jelent√©s: "+t[0]+":"+t[1]+". Hiba: "+n),VIJE_adatbeir(t[1],e,"","",t[2]),VIJE2_HIBA++,VIJE_HIBA++,!1}}function szem4_VIJE_3torol(){try{if(document.getElementById("vije_opts").isdelete.checked)try{VIJE_REF1.document.forms[0].del.click()}catch(t){VIJE_REF1.document.getElementsByName("del")[0].click()}}catch(t){return void debug("VIJE3","Hiba: "+t)}}function szem4_VIJE_motor(){try{var t=1500;if(VIJE_PAUSE&&clearAttacks(),BOT||VIJE_PAUSE||USER_ACTIVITY)t=5e3;else switch(VIJE_HIBA>10&&(VIJE_HIBA=0,++VIJE_GHIBA>3&&(VIJE_GHIBA>5&&(naplo("Glob√°l","Nincs internet? Folyamatos hiba a jelent√©s elemz≈ën√©l"),t=6e4,playSound("bot2")),debug("szem4_VIJE_motor","Jelent√©s elemzo hiba >3, ablak bez√°r/√∫jranyit"),VIJE_REF1.close()),VIJE_LEPES=0),VIJE2_HIBA>6&&(VIJE2_HIBA=0,++VIJE2_GHIBA>3&&(VIJE2_GHIBA>5&&naplo("Glob√°l","Nincs internet? Folyamatos hiba a jelent√©s elemz≈ën√©l"),VIJE_REF2.close()),VIJE_LEPES=0),(!VIJE_REF1||0!=VIJE_LEPES&&VIJE_REF1.closed)&&(VIJE_LEPES=0),VIJE_LEPES){case 0:if(document.getElementById("farm_hova").rows.length>1){var e="";game_data.player.premium&&(e="group_id=-1&"),VIJE_REF1=windowOpener("vije",VILL1ST.replace("screen=overview","mode=attack&"+e+"screen=report"),AZON+"_SZEM4VIJE_1"),VIJE_LEPES=1}else t=1e4;break;case 1:isPageLoaded(VIJE_REF1,-1,"screen=report")?(VIJE_HIBA=0,VIJE_GHIBA=0,0===(PM2=szem4_VIJE_1kivalaszt())[0]?(VIJE_LEPES=0,!1===PM2[3]&&(t=12e4,MOBILE_MODE&&(VIJE_REF1.close(),VIJE_REF2.close()))):(VIJE_REF2=windowOpener("vije2",VILL1ST.replace("screen=overview","mode=attack&view="+PM2[0]+"&screen=report"),AZON+"_SZEM4VIJE_2"),VIJE_LEPES=2),VIJE_REF1.document.title="Szem4/vije1"):VIJE_HIBA++;break;case 2:isPageLoaded(VIJE_REF2,-1,PM2[0])?(clearAttacks(),szem4_VIJE_2elemzes(PM2),VIJE_LEPES=PM2[3]?3:1,VIJE_REF2.document.title="Szem4/vije2"):VIJE2_HIBA++;break;case 3:szem4_VIJE_3torol(),VIJE_LEPES=0,0===PM2[0]&&(t=12e4,MOBILE_MODE&&(VIJE_REF1.close(),VIJE_REF2.close()));break;default:VIJE_LEPES=0}}catch(t){debug("szem4_VIJE_motor()","ERROR: "+t+" L√©p√©s:"+VIJE_LEPES)}var n=100/(40*Math.random()+80);t=Math.round(t*n);try{worker.postMessage({id:"vije",time:t})}catch(t){debug("vije","Worker engine error: "+t),setTimeout((function(){szem4_VIJE_motor()}),3e3)}}szem4_farmolo_motor(),ujkieg("vije","Jelent√©s Elemz≈ë",`<tr><td>\n\tA VIJE a Farmol√≥ t√°bl√°zat√°ba dolgozik, itt csup√°n m≈±k√∂d√©si be√°ll√≠t√°sokat m√≥dos√≠thatsz.\n\t<form id="vije_opts">\n\t\t<table class="vis szem4_vije_optsTable">\n\t\t\t<tr><td>${picBuilding("main")}</td><td>"F≈ëhadisz√°ll√°s" a szerver jelenlegi nyelv√©n</td><td><input type="text" size="15" name="main" value="F≈ëhadisz√°ll√°s"></td></tr>\n\t\t\t<tr><td>${picBuilding("barracks")}</td><td>"Barakk" a szerver jelenlegi nyelv√©n</td><td><input type="text" size="15" name="barracks" value="Barakk"></td></tr>\n\t\t\t<tr><td>${picBuilding("stable")}</td><td>"Ist√°ll√≥" a szerver jelenlegi nyelv√©n</td><td><input type="text" size="15" name="stable" value="Ist√°ll√≥"></td></tr>\n\t\t\t<tr><td>${picBuilding("garage")}</td><td>"M≈±hely" a szerver jelenlegi nyelv√©n</td><td><input type="text" size="15" name="garage" value="M≈±hely"></td></tr>\n\t\t\t<tr><td>${picBuilding("smith")}</td><td>"Kov√°csm≈±hely" a szerver jelenlegi nyelv√©n</td><td><input type="text" size="15" name="smith" value="Kov√°csm≈±hely"></td></tr>\n\t\t\t<tr><td>${picBuilding("market")}</td><td>"Piac" a szerver jelenlegi nyelv√©n</td><td><input type="text" size="15" name="market" value="Piac"></td></tr>\n\t\t\t<tr><td>${picBuilding("wood")}</td><td>"Fatelep" a szerver jelenlegi nyelv√©n</td><td><input type="text" size="15" name="wood" value="Fatelep"></td></tr>\n\t\t\t<tr><td>${picBuilding("stone")}</td><td>"Agyagb√°nya" a szerver jelenlegi nyelv√©n</td><td><input type="text" size="15" name="stone" value="Agyagb√°nya"></td></tr>\n\t\t\t<tr><td>${picBuilding("iron")}</td><td>"Vasb√°nya" a szerver jelenlegi nyelv√©n</td><td><input type="text" size="15" name="iron" value="Vasb√°nya"></td></tr>\n\t\t\t<tr><td>${picBuilding("farm")}</td><td>"Tanya" a szerver jelenlegi nyelv√©n</td><td><input type="text" size="15" name="farm" value="Tanya"></td></tr>\n\t\t\t<tr><td>${picBuilding("wall")}</td><td>"Fal" a szerver jelenlegi nyelv√©n</td><td><input type="text" size="15" name="wall" value="Fal"></td></tr>\n\t\t</table>\n\t\t<input type="checkbox" name="isdelete"> Z√∂ld farmjelent√©sek t√∂rl√©se?<br><br><br>\n\t</form>\n\t<i>Elemzett jelent√©sek:</i><div id="VIJE_elemzett" style="font-size:30%;width:980px;word-wrap: break-word;"></div></td></tr>`);var VIJE_REF1,VIJE_REF2,PM2,VIJE_PAUSE=!0,VIJE_LEPES=0,VIJE_HIBA=0,VIJE_GHIBA=0,VIJE2_HIBA=0,VIJE2_GHIBA=0,ALL_VIJE_SAVED={};function TamadUpdt(t){try{var e=document.getElementById("idtamad_Bejovok"),n=getServerTime(),a=parseInt(t.game_data.player.incomings,10),l=0;if(e.rows.length>1&&(l=parseInt(e.rows[1].cells[1].innerHTML,10)),a==l)return;var o=e.insertRow(1),r=o.insertCell(0),s=o.insertCell(1);return r.innerHTML=n,s.innerHTML=a,void(a>l&&playSound("bejovo"))}catch(t){debug("ID beir","Hiba: "+t)}}function szem4_EPITO_perccsokkento(){try{for(var t=document.getElementById("epit").getElementsByTagName("table")[1].rows,e=/[0-9]+\:[0-9]+/g,n=1;n<t.length;n++){let a=t[n].cells[3];if(a.textContent.search(e)>-1){let t=a.textContent.match(e)[0];t=t.split(":").map((t=>parseInt(t,10))),t=60*t[0]+t[1],t--,a.textContent=a.textContent.replace(e,writeAllBuildTime(t,!0))}}}catch(t){debug("√âp√≠t≈ë_pcs√∂kk",t),setTimeout("szem4_EPITO_perccsokkento()",6e4)}}function writeAllBuildTime(t,e=!1){let n=t%60,a=Math.floor(t/60).toString().padStart(2,"0")+":"+n.toString().padStart(2,"0");return e?a:'<span class="writeOutDate">H√°tral√©v≈ë √©p√≠t√©si id≈ë: '+a+"</span>"}function szem4_EPITO_getlista(){try{for(var t="<select>",e=document.getElementById("epit").getElementsByTagName("table")[0].rows,n=1;n<e.length;n++)t+='<option value="'+e[n].cells[0].textContent+'">'+e[n].cells[0].textContent+"</option> ";return t+="</select>"}catch(t){debug("√âp√≠t≈ë",t)}}function szem4_EPITO_csopDelete(t){try{var e=t.innerHTML;if(!confirm("Biztos kit√∂rl√∂d a "+e+" nev≈± csoportot?\nA csoportot haszn√°l√≥ faluk az Alap√©rtelmezett csoportba fognak tartozni."))return;sortorol(t,"");for(var n=document.getElementById("epit_lista").rows,a=1;a<n.length;a++){var l=n[a].cells[1].getElementsByTagName("select")[0];l.value==e&&(l.value=document.getElementById("epit").getElementsByTagName("table")[0].rows[1].cells[0].innerHTML)}n=document.getElementById("epit_ujfalu_adat").getElementsByTagName("option");for(a=0;a<n.length;a++)if(n[a].value==e){document.getElementById("epit_ujfalu_adat").getElementsByTagName("select")[0].remove(a);break}}catch(t){alert2("Hiba:\n"+t)}}function szem4_EPITO_ujFalu(){try{var t=document.getElementById("epit_ujfalu_adat"),e=t.getElementsByTagName("input")[0].value;if(""==e||null==e)return;e=e.match(/[0-9]{1,3}(\|)[0-9]{1,3}/g);for(var n=document.getElementById("epit_lista"),a="",l=szem4_EPITO_getlista(),o=0;o<e.length;o++){for(var r=!1,s=1;s<n.rows.length;s++)n.rows[s].cells[0].textContent==e[o]&&(r=!0);if(r)a+="DUP:"+e[o]+", ";else if(0!=koordTOid(e[o])){var i=n.insertRow(-1),d=i.insertCell(0);d.innerHTML=e[o],d.setAttribute("ondblclick","sortorol(this)"),(d=i.insertCell(1)).innerHTML=l,d.getElementsByTagName("select")[0].value=t.getElementsByTagName("select")[0].value,(d=i.insertCell(2)).style.fontSize="x-small";var c=getServerTime();d.innerHTML=c.toLocaleString(),d.setAttribute("ondblclick","szem4_EPITO_most(this)"),(d=i.insertCell(3)).innerHTML='<i>Feldolgoz√°s alatt...</i> <a href="'+VILL1ST.replace(/(village=)[0-9]+/g,"village="+koordTOid(e[o])).replace("screen=overview","screen=main")+'" target="_BLANK"><img alt="Nyit" title="Falu megnyit√°sa" src="'+pic("link.png")+'"></a>',d.setAttribute("ondblclick","szem4_EPITO_infoCell(this.parentNode,'alap',\"\")")}else a+="NL: "+e[o]+", "}return""!=a&&alert2("Dupla megad√°sok/nem l√©tez≈ë faluk kisz≈±rve: "+a),void(t.getElementsByTagName("input")[0].value="")}catch(t){alert2("√öj falu(k) felv√©telekori hiba:\n"+t)}}function szem4_EPITO_ujCsop(){try{var t=document.getElementById("epit_ujcsopnev").value.replace(/[;\._]/g,"").replace(/( )+/g," ");if(""==t||null==t)return;for(var e=document.getElementById("epit").getElementsByTagName("table")[0],n=1;n<e.rows.length;n++)if(e.rows[n].cells[0].textContent==t)throw"M√°r l√©tezik ilyen nev≈± csoport";var a=e.insertRow(-1),l=a.insertCell(0);l.innerHTML=t,l.setAttribute("ondblclick","szem4_EPITO_csopDelete(this)"),(l=a.insertCell(1)).innerHTML=e.rows[1].cells[1].innerHTML,l.getElementsByTagName("input")[0].disabled=!1;for(e=document.getElementById("epit_lista").rows,n=1;n<e.length;n++){var o=e[n].cells[1].getElementsByTagName("select")[0],r=document.createElement("option");r.text=t,o.add(r)}return o=document.getElementById("epit_ujfalu_adat").getElementsByTagName("select")[0],(r=document.createElement("option")).text=t,o.add(r),void(document.getElementById("epit_ujcsopnev").value="")}catch(t){alert2("√öj csoport felv√©telekori hiba:\n"+t)}}function szem4_EPITO_cscheck(t){try{var e=t.parentNode.getElementsByTagName("input")[0].value;e=e.split(";");for(var n=new Array("main","barracks","stable","garage","church_f","church","smith","snob","place","statue","market","wood","stone","iron","farm","storage","hide","wall","MINES"),a=0;a<e.length;a++){if(!(n.indexOf(e[a].match(/[a-zA-Z]+/g)[0])>-1))throw"Nincs ilyen √©p√ºlet: "+e[a].match(/[a-zA-Z]+/g)[0];if(parseInt(e[a].match(/[0-9]+/g)[0])>30)throw"T√∫l magas √©p√ºletszint: "+e[a]}alert2("Minden OK")}catch(t){alert2("Hib√°s lista:\n"+t)}}function szem4_EPITO_most(t){try{var e=getServerTime();return void(t.innerHTML=e.toLocaleString())}catch(t){alert2("Hiba l√©pett fel:\n"+t)}}function szem4_EPITO_csopToList(t){try{for(var e=document.getElementById("epit").getElementsByTagName("table")[0].rows,n=1;n<e.length;n++)if(e[n].cells[0].textContent==t)return e[n].cells[1].getElementsByTagName("input")[0].value;return";"}catch(t){debug("epito_csopToList",t)}}function szem4_EPITO_Wopen(){try{for(var t=document.getElementById("epit_lista").rows,e=getServerTime(),n=1;n<t.length;n++){if(new Date(t[n].cells[2].textContent)<e){var a=szem4_EPITO_csopToList(t[n].cells[1].getElementsByTagName("select")[0].value);return[koordTOid(t[n].cells[0].textContent),a,t[n]]}}return[0,";"]}catch(t){debug("Epito_Wopen",t)}}function szem4_EPITO_addIdo(t,e){try{if("del"==e)document.getElementById("epit_lista").deleteRow(t.rowIndex);else{0==e&&(e=30);var n=getServerTime();n.setSeconds(n.getMinutes()+60*e),t.cells[2].innerHTML=n.toLocaleString()}}catch(t){return debug("epito_addIdo",t),!1}}function szem4_EPITO_infoCell(t,e,n){try{return"alap"==e&&(e="#f4e4bc"),"blue"==e&&(e="#44F"),"red"==e&&setTimeout('playSound("kritikus_hiba")',2e3),t.cells[3].style.backgroundColor=e,void(t.cells[3].innerHTML=n+' <a href="'+VILL1ST.replace(/(village=)[0-9]+/g,"village="+koordTOid(t.cells[0].textContent)).replace("screen=overview","screen=main")+'" target="_BLANK"><img alt="Nyit" title="Falu megnyit√°sa" src="'+pic("link.png")+'"></a>')}catch(t){debug("√©p√≠t≈ë_infoCell",t)}}function szem4_EPITO_getBuildLink(t,e){var n=t.document.getElementById("main_buildrow_"+e);if(n.cells.length<3)return!1;for(var a=new RegExp("main_buildlink_"+e+"_[0-9]+","g"),l=n.getElementsByTagName("*"),o=0;o<l.length;o++)if(a.test(l[o].id))return l[o]}function szem4_EPITO_IntettiBuild(t){try{try{TamadUpdt(EPIT_REF)}catch(t){}var e,n="",a=0,l=0;try{if(!EPIT_REF.document.getElementById("buildqueue"))throw"No queue";for(var o=EPIT_REF.document.getElementById("buildqueue").rows,r=1;r<o.length;r++)try{n+=o[r].cells[0].getElementsByTagName("img")[0].src.match(/[A-Za-z0-9]+\.(png)/g)[0].replace(/[0-9]+/g,"").replace(".png",""),e=o[r].cells[1].textContent.split(":"),a+=60*parseInt(e[0])+parseInt(e[1])+parseInt(e[2])/60,0==l&&(l=a),n+=";"}catch(t){}a=Math.round(a),(l=Math.ceil(l))>180&&(l=180)}catch(t){n=";",a=0,l=0}if(""==n&&(n=";"),(n=n.split(";")).pop(),n.length>4)return szem4_EPITO_infoCell(PMEP[2],"alap","√âp√≠t√©si sor megtelt. "+writeAllBuildTime(a)),void szem4_EPITO_addIdo(PMEP[2],l);let u=EPIT_REF.game_data.village.buildings;u=Object.fromEntries(Object.entries(u).map((([t,e])=>[t,parseInt(e)])));for(r=0;r<n.length;r++)u[n[r]]++;var s="",i=t.split(";");for(r=0;r<i.length;r++){let t=i[r].split(" ");if(t[1]=parseInt(t[1]),"MINES"==t[0]){let e=31;if(u.wood<t[1]&&(e=u.wood,s="wood"),u.stone<t[1]&&u.stone<e&&(e=u.stone,s="stone"),u.iron<t[1]&&u.iron<e&&(e=u.iron,s="iron"),""!=s)break}if(u[t[0]]<t[1]){s=t[0];break}}if(""==s)return naplo("√âp√≠t≈ë",'<a href="'+VILL1ST.replace(/(village=)[0-9]+/g,"village="+PMEP[0])+'" target="_BLANK">'+EPIT_REF.game_data.village.name+" ("+EPIT_REF.game_data.village.x+"|"+EPIT_REF.game_data.village.y+")</a> falu teljesen fel√©p√ºlt √©s t√∂rl≈ëd√∂tt a list√°b√≥l"),setTimeout((()=>playSound("falu_kesz")),1500),void szem4_EPITO_addIdo(PMEP[2],"del");var d=EPIT_REF.document.getElementById("main_buildrow_"+s);if(!d)return szem4_EPITO_infoCell(PMEP[2],0==l?"red":"yellow",s+" nem √©p√≠thet≈ë. El≈ëfelt√©tel sz√ºks√©ges? "+writeAllBuildTime(a)),void szem4_EPITO_addIdo(PMEP[2],l>0?l:60);var c={wood:parseInt(d.cells[1].textContent.match(/[0-9]+/g),10),stone:parseInt(d.cells[2].textContent.match(/[0-9]+/g),10),iron:parseInt(d.cells[3].textContent.match(/[0-9]+/g),10),pop:parseInt(d.cells[5].textContent.match(/[0-9]+/g),10)};if(Math.max(c.wood,c.stone,c.iron)>EPIT_REF.game_data.village.storage_max&&(s="storage+"),c.pop>EPIT_REF.game_data.village.pop_max-EPIT_REF.game_data.village.pop&&(s="farm+"),"farm+"==s&&30==EPIT_REF.game_data.village.buildings.farm)return szem4_EPITO_infoCell(PMEP[2],"red","Tanya megtelt, √©p√≠t√©s nem folytathat√≥. "+writeAllBuildTime(a)),void szem4_EPITO_addIdo(PMEP[2],120);if("farm+"==s&&n.includes("farm"))return szem4_EPITO_infoCell(PMEP[2],"yellow","Tanya megtelt, de m√°r √©p√≠t√©s alatt... "+writeAllBuildTime(a)),void szem4_EPITO_addIdo(PMEP[2],120);if("farm+"!=s&&"storage+"!=s||(s=s.slice(0,-1),d=EPIT_REF.document.getElementById("main_buildrow_"+s),c={wood:parseInt(d.cells[1].textContent.match(/[0-9]+/g),10),stone:parseInt(d.cells[2].textContent.match(/[0-9]+/g),10),iron:parseInt(d.cells[3].textContent.match(/[0-9]+/g),10),pop:0},Math.max(c.wood,c.stone,c.iron)>EPIT_REF.game_data.village.storage_max&&(s="storage",d=EPIT_REF.document.getElementById("main_buildrow_"+s),c={wood:parseInt(d.cells[1].textContent.match(/[0-9]+/g),10),stone:parseInt(d.cells[2].textContent.match(/[0-9]+/g),10),iron:parseInt(d.cells[3].textContent.match(/[0-9]+/g),10),pop:0})),EPIT_REF.game_data.village.wood<c.wood||EPIT_REF.game_data.village.stone<c.stone||EPIT_REF.game_data.village.iron<c.iron)return szem4_EPITO_infoCell(PMEP[2],"yellow","Nyersanyag hi√°ny l√©pett fel. "+writeAllBuildTime(a)),void szem4_EPITO_addIdo(PMEP[2],l>0?Math.min(l,60):60);szem4_EPITO_infoCell(PMEP[2],"alap","√âp√≠t√©s folyamatban.");var m=d.querySelector(".btn.btn-build");if("none"==m.style.display)return n.length<2?szem4_EPITO_infoCell(PMEP[2],"red","Ismeretlen hiba. "+writeAllBuildTime(a)):szem4_EPITO_infoCell(PMEP[2],"alap","√âp√≠tkez√©si sor megtelt. "+writeAllBuildTime(a)),void szem4_EPITO_addIdo(PMEP[2],l>0?l:60);m.click(),playSound("epites")}catch(t){debug("epit_IntelliB",t)}}function szem4_EPITO_motor(){try{var t=2e3;if(BOT||EPIT_PAUSE||USER_ACTIVITY)t=5e3;else switch(EPIT_HIBA>10&&(EPIT_HIBA=0,++EPIT_GHIBA>3&&(EPIT_GHIBA>5&&(naplo("Glob√°l","Nincs internet? Folyamatos hiba az √©p√≠t≈ën√©l"),t=6e4,playSound("bot2")),EPIT_REF.close()),EPIT_LEPES=0),EPIT_LEPES){case 0:(PMEP=szem4_EPITO_Wopen())[0]>0?(EPIT_REF=windowOpener("epit",VILL1ST.replace("screen=overview","screen=main").replace(/village=[0-9]+/,"village="+PMEP[0]),AZON+"_SZEM4EPIT"),EPIT_LEPES=1):1==document.getElementById("epit_lista").rows.length?t=5e3:(t=6e4,MOBILE_MODE&&EPIT_REF.close()),EPIT_REF&&EPIT_REF.document&&(EPIT_REF.document.title="szem4/√©p√≠t≈ë");break;case 1:isPageLoaded(EPIT_REF,PMEP[0],"screen=main")?(EPIT_HIBA=0,EPIT_GHIBA=0,szem4_EPITO_IntettiBuild(PMEP[1])):EPIT_HIBA++,EPIT_LEPES=0;break;default:EPIT_LEPES=0}}catch(t){debug("Epito motor",t),EPIT_LEPES=0}var e=100/(40*Math.random()+80);t=Math.round(t*e);try{worker.postMessage({id:"epit",time:t})}catch(t){debug("epit","Worker engine error: "+t),setTimeout((function(){szem4_EPITO_motor()}),3e3)}}szem4_VIJE_motor(),ujkieg_hang("Bej√∂v≈ë t√°mad√°sok","bejovo"),ujkieg("idtamad","Bej√∂v≈ë t√°mad√°sok",'<tr><td align="center"><table class="vis" id="idtamad_Bejovok" style="vertical-align:top; display: inline-block;"><tr><th>Id≈ëpont</th><th>T√°mad√°sok sz√°ma</th></tr></table> </td></tr>'),ujkieg_hang("√âp√≠t≈ë","epites;falu_kesz;kritikus_hiba"),ujkieg("epit","√âp√≠t≈ë",'<tr><td><h2 align="center">√âp√≠t√©si list√°k</h2><table align="center" class="vis" style="border:1px solid black;color: black;"><tr><th onmouseover=\'sugo(this,"√âp√≠t√©si lista neve, amire k√©s≈ëbb hivatkozhatunk")\'>Csoport neve</th><th onmouseover=\'sugo(this,"Az √©p√≠t√©si sorrend megad√°sa. Saj√°t lista eset√©n ellen≈ërizz√ºk az OK? linkre kattintva annak helyess√©g√©t!")\' style="width:800px">√âp√≠t√©si lista</th></tr><tr><td>Alap√©rtelmezett</td><td><input type="text" disabled="disabled" value="main 10;storage 10;wall 10;main 15;wall 15;storage 15;farm 10;main 20;wall 20;MINES 10;smith 5;barracks 5;stable 5;storage 20;farm 20;market 10;main 22;smith 12;farm 25;storage 28;farm 26;MINES 24;market 19;barracks 15;stable 10;garage 5;MINES 26;farm 28;storage 30;barracks 20;stable 15;farm 30;barracks 25;stable 20;MINES 30;smith 20;snob 1" size="125"><a onclick="szem4_EPITO_cscheck(this)" style="color:blue; cursor:pointer;"> OK?</a></td></tr></table><p align="center">Csoportn√©v: <input type="text" value="" size="30" id="epit_ujcsopnev" placeholder="Nem tartalmazhat . _ ; karaktereket"> <a href="javascript: szem4_EPITO_ujCsop()" style="color:white;text-decoration:none;"><img src="'+pic("plus.png")+' " height="17px"> √öj csoport</a></p></td></tr><tr><td><h2 align="center">√âp√≠tend≈ë faluk</h2><table align="center" class="vis" style="border:1px solid black;color: black;width:900px" id="epit_lista"><tr><th style="width: 75px; cursor: pointer;" onclick=\'rendez("szoveg",false,this,"epit_lista",0)\' onmouseover=\'sugo(this,"Rendezhet≈ë. Itt √©p√≠tek. Dupla klikk a falura = sor t√∂rl√©se")\'>Falu koord.</th><th onclick=\'rendez("lista",false,this,"epit_lista",1)\' onmouseover=\'sugo(this,"Rendezhet≈ë. Fels≈ë t√°bl√°zatban haszn√°lt lista k√∂z√ºl v√°laszthatsz egyet, melyet k√©s≈ëbb b√°rmikor megv√°ltoztathatsz.")\' style="width: 135px; cursor: pointer">Haszn√°lt lista</th><th style="width: 220px; cursor: pointer;" onclick=\'rendez("datum",false,this,"epit_lista",2)\' onmouseover=\'sugo(this,"Rendezhet≈ë. Ekkor fogom √∫jran√©zni a falut, hogy lehet e m√°r √©p√≠teni.<br>Dupla klikk=id≈ë azonnalira √°ll√≠t√°sa.")\'>Return</th><th style="cursor: pointer;" onclick=\'rendez("szoveg",false,this,"epit_lista",3)\' onmouseover=\'sugo(this,"Rendezhet≈ë. Sz√∂veges inform√°ci√≥ a faluban zajl√≥ √©p√≠t√©sr≈ël. S√°rga h√°tter≈± sz√∂veg orvosolhat√≥; k√©k jelent√©se hogy nem tud haladni; piros pedig kritikus hib√°t jel√∂l; a sz√≠n n√©lk√ºli a norm√°lis m≈±k√∂d√©st jelzi.<br>Dupla klikk=alaphelyzet")\'><u>Inf√≥</u></th></tr></table><p align="center" id="epit_ujfalu_adat">Csoport: <select><option value="Alap√©rtelmezett">Alap√©rtelmezett</option> </select> Faluk: <input type="text" value="" placeholder="Koordin√°t√°k: 123|321 123|322 ..." size="50"> <a href="javascript: szem4_EPITO_ujFalu()" style="color:white;text-decoration:none;"><img src="'+pic("plus.png")+'" height="17px"> √öj falu(k)</a></p></td></tr>');var EPIT_REF,PMEP,EPIT_LEPES=0,EPIT_HIBA=0,EPIT_GHIBA=0,EPIT_PAUSE=!1;function szem4_ADAT_saveNow(t){switch(t){case"farm":szem4_ADAT_farm_save();break;case"epito":szem4_ADAT_epito_save();break;case"sys":szem4_ADAT_sys_save()}}function szem4_ADAT_restart(t){switch(t){case"farm":localStorage.setItem(AZON+"_farm","3600.4.0.3600.1.false.false.100.10.500.90;;;;;;"),szem4_ADAT_farm_load();break;case"epito":localStorage.setItem(AZON+"_epito","__"),szem4_ADAT_epito_load();break;case"sys":localStorage.setItem(AZON+"_sys","Fatelep.Agyagb√°nya.Vasb√°nya.Fal.false;false.false.false;http://www youtube com/watch?v=k2a30--j37Q.true.true.true.true.true.true;"),szem4_ADAT_sys_load()}}function szem4_ADAT_StopAll(){for(var t=document.getElementById("adat_opts").rows,e=1;e<t.length;e++)t[e].cells[0].getElementsByTagName("input")[0].checked=!1}function szem4_ADAT_LoadAll(){szem4_ADAT_farm_load(),szem4_ADAT_epito_load(),szem4_ADAT_sys_load()}function szem4_ADAT_sys_save(){try{for(var t="",e=document.getElementById("vije").getElementsByTagName("input"),n=0;n<e.length;n++)"checkbox"==e[n].getAttribute("type")?e[n].checked?t+="true":t+="false":t+=e[n].value,n<e.length-1&&(t+=".");t+="."+JSON.stringify(ALL_VIJE_SAVED),t+=";";for(e=document.getElementById("adatok").getElementsByTagName("input"),n=0;n<e.length;n++)e[n].checked?t+="true":t+="false",n<e.length-1&&(t+=".");t+=";";for(e=document.getElementById("hang").getElementsByTagName("input"),n=0;n<e.length;n++)"checkbox"==e[n].getAttribute("type")?e[n].checked?t+="true":t+="false":t+=e[n].value.replace(/\./g," ").replace(/;/g,"  "),n<e.length-1&&(t+=".");t+=";"+JSON.stringify(SZEM4_SETTINGS),localStorage.setItem(AZON+"_sys",t);var a=new Date;return void(document.getElementById("adat_opts").rows[3].cells[2].textContent=a.toLocaleString())}catch(t){debug("ADAT_sys_save",t)}}function szem4_ADAT_farm_save(){try{var t="";let o=document.getElementById("farmolo_options"),r={};for(let t=0;t<o.elements.length;t++){let e=o.elements[t];e.name&&("checkbox"===e.type?r[e.name]=e.checked:e.value&&(r[e.name]=e.value))}t+=JSON.stringify(r),t+=";",o=document.getElementById("farm_honnan").rows;for(var e=1;e<o.length;e++)t+=o[e].cells[0].textContent,e<o.length-1&&(t+=".");var n;t+=";";for(e=1;e<o.length;e++){n=o[e].cells[1].getElementsByTagName("input");for(var a=0;a<n.length;a++)n[a].checked?t+="true":t+="false",a<n.length-1&&(t+="-");e<o.length-1&&(t+=".")}t+=";",o=document.getElementById("farm_hova").rows;for(e=1;e<o.length;e++)t+=o[e].cells[0].textContent,"red"==o[e].cells[0].style.backgroundColor&&(t+="R"),e<o.length-1&&(t+=".");t+=";";for(e=1;e<o.length;e++)t+=o[e].cells[1].textContent,e<o.length-1&&(t+=".");t+=";";for(e=1;e<o.length;e++)t+=DOMINFO_FARMS[o[e].cells[0].textContent].buildings.wall,e<o.length-1&&(t+=".");t+=";";for(e=1;e<o.length;e++)o[e].cells[4].getElementsByTagName("input")[0].checked?t+="true":t+="false",e<o.length-1&&(t+=".");t+=";"+JSON.stringify(ALL_UNIT_MOVEMENT),t+=";"+JSON.stringify(ALL_SPY_MOVEMENTS),t+=";";for(e=1;e<o.length;e++)t+=o[e].cells[3].textContent,e<o.length-1&&(t+=".");t+=";"+JSON.stringify(DOMINFO_FARMS),localStorage.setItem(AZON+"_farm",t);var l=new Date;return void(document.getElementById("adat_opts").rows[1].cells[2].textContent=l.toLocaleString())}catch(t){debug("ADAT_farm_save",t)}}function szem4_ADAT_epito_save(){try{for(var t="",e=document.getElementById("epit").getElementsByTagName("table")[0].rows,n=2;n<e.length;n++)t+=e[n].cells[0].textContent+"-"+e[n].cells[1].getElementsByTagName("input")[0].value,n<e.length-1&&(t+=".");t+="_",e=document.getElementById("epit").getElementsByTagName("table")[1].rows;for(n=1;n<e.length;n++)t+=e[n].cells[0].textContent,n<e.length-1&&(t+=".");t+="_";for(n=1;n<e.length;n++)t+=e[n].cells[1].getElementsByTagName("select")[0].value,n<e.length-1&&(t+=".");localStorage.setItem(AZON+"_epito",t);var a=new Date;return void(document.getElementById("adat_opts").rows[2].cells[2].textContent=a.toLocaleString())}catch(t){debug("ADAT_epito_save",t)}}function szem4_ADAT_farm_load(){try{if(!localStorage.getItem(AZON+"_farm"))return;var t=localStorage.getItem(AZON+"_farm"),e=document.getElementById("farmolo_options"),n=JSON.parse(t.split(";")[0]);for(let t=0;t<e.elements.length;t++){let a=e.elements[t];a.name&&n[a.name]&&("checkbox"===a.type?a.checked=n[a.name]:a.value&&(a.value=n[a.name]))}for(var a=(e=document.getElementById("farm_honnan")).rows.length-1;a>0;a--)e.deleteRow(a);for(a=(e=document.getElementById("farm_hova")).rows.length-1;a>0;a--)e.deleteRow(a);DOMINFO_FARMS={},document.getElementById("add_farmolo_faluk").value=t.split(";")[1],document.getElementById("add_farmolo_egysegek").getElementsByTagName("input")[0].checked=!0,add_farmolo(),document.getElementById("add_farmolando_faluk").value=t.split(";")[3],add_farmolando(),worker.postMessage({id:"stopTimer",value:"vije"}),setTimeout((function(){try{var t=localStorage.getItem(AZON+"_farm"),e=document.getElementById("farm_honnan").rows;if(1==(n=t.split(";")[2].split(".")).length&&""==n[0]);else for(var a=0;a<n.length;a++)for(var l=e[a+1].cells[1].getElementsByTagName("input"),o=0;o<n[a].split("-").length;o++)"true"==n[a].split("-")[o]?l[o].checked=!0:l[o].checked=!1;e=document.getElementById("farm_hova").rows;const r=t.split(";")[3].match(/[0-9]+(\|)[0-9]+/g);if(1==(n=t.split(";")[4].split(".")).length&&""==n[0]);else for(a=0;a<n.length;a++)e[a+1].cells[1].textContent=n[a],DOMINFO_FARMS[r[a]].prodHour=getProdHour(n[a]);if(1==(n=t.split(";")[5].split(".")).length&&""==n[0]);else for(a=0;a<n.length;a++)"undefined"==n[a]&&(n[a]="-"),e[a+1].cells[2].innerHTML=`\n\t\t\t\t<span class="tooltip_hover">\n\t\t\t\t\t${n[a].match(/-?[0-9]*/g)[0]}\n\t\t\t\t\t<span class="tooltip_text"></span>\n\t\t\t\t</span>`,DOMINFO_FARMS[r[a]].buildings.wall=n[a];if(1==(n=t.split(";")[6].split(".")).length&&""==n[0]);else for(a=0;a<n.length;a++)"true"==n[a]?e[a+1].cells[4].getElementsByTagName("input")[0].checked=!0:e[a+1].cells[4].getElementsByTagName("input")[0].checked=!1,DOMINFO_FARMS[r[a]].isJatekos="true"==n[a];if(n=t.split(";")[7],ALL_UNIT_MOVEMENT=n&&n.length>5?JSON.parse(n):{},n=t.split(";")[8],ALL_SPY_MOVEMENTS=n&&n.length>5?JSON.parse(n):{},n=t.split(";")[9]){n=n.split(".");for(a=0;a<n.length;a++)ALL_VIJE_SAVED[e[a+1].cells[0].textContent]?(e[a+1].cells[3].textContent=n[a],DOMINFO_FARMS[r[a]].nyers=parseInt(n[a],10)):e[a+1].cells[3].textContent=0}n=t.split(";")[10],DOMINFO_FARMS=JSON.parse(n),rebuildDOM_farms(),document.getElementById("add_farmolo_egysegek").getElementsByTagName("input")[0].checked=!1,clearAttacks(),drawWagons(),shorttest(),alert2("Farmol√°si adatok bet√∂lt√©se k√©sz.")}catch(t){alert("ERROR_LOAD\n"+t)}finally{szem4_VIJE_motor()}}),600)}catch(t){debug("ADAT_farm_load",t)}}function szem4_ADAT_epito_load(){try{if(!localStorage.getItem(AZON+"_epito"))return;for(var t=localStorage.getItem(AZON+"_epito"),e=(n=document.getElementById("epit").getElementsByTagName("table")[0]).rows.length-1;e>1;e--)n.deleteRow(e);var n;for(e=(n=document.getElementById("epit").getElementsByTagName("table")[1]).rows.length-1;e>0;e--)n.deleteRow(e);for(n=document.getElementById("epit_ujfalu_adat").getElementsByTagName("select")[0];n.length>1;)n.remove(1);n=t.split("_")[0].split(".");for(e=0;e<n.length;e++)document.getElementById("epit_ujcsopnev").value=n[e].split("-")[0],szem4_EPITO_ujCsop(),document.getElementById("epit").getElementsByTagName("table")[0].rows[e+2].cells[1].getElementsByTagName("input")[0].value=n[e].split("-")[1];n=t.split("_")[1].split("."),document.getElementById("epit_ujfalu_adat").getElementsByTagName("input")[0].value=n,szem4_EPITO_ujFalu(),n=t.split("_")[2].split(".");var a=document.getElementById("epit").getElementsByTagName("table")[1].rows;for(e=0;e<n.length;e++)a[e+1].cells[1].getElementsByTagName("select")[0].value=n[e];return void alert2("√âp√≠t√©si adatok bet√∂lt√©se k√©sz.")}catch(t){debug("ADAT_epito_load",t)}}function szem4_ADAT_sys_load(){try{if(!localStorage.getItem(AZON+"_sys"))return;for(var t=localStorage.getItem(AZON+"_sys"),e=document.getElementById("vije").getElementsByTagName("input"),n=t.split(";")[0].split("."),a=0;a<n.length-1;a++)"true"==n[a]?e[a].checked=!0:"false"==n[a]?e[a].checked=!1:e[a].value=n[a];ALL_VIJE_SAVED=n[n.length-1].length<12?{}:JSON.parse(n[n.length-1]);e=document.getElementById("hang").getElementsByTagName("input"),n=t.split(";")[2].split(".");e[0].value=n[0].replace(/\s\s/g,";").replace(/\s/g,".");for(a=1;a<n.length;a++)"true"==n[a]?e[a].checked=!0:"false"==n[a]&&(e[a].checked=!1);(n=t.split(";")[3])?(SZEM4_SETTINGS=JSON.parse(n),loadSettings(),saveSettings()):setTimeout((()=>saveSettings()),500),alert2("Rendszeradatok bet√∂lt√©se k√©sz.")}catch(t){debug("ADAT_epito_sys",t)}}function szem4_ADAT_del(t){try{if(!confirm("Biztos t√∂rli a(z) "+t+" √∂sszes adat√°t?"))return;return void(localStorage.getItem(AZON+"_"+t)?(localStorage.removeItem(AZON+"_"+t),alert2(t+": T√∂rl√©s sikeres")):alert2(t+": Nincs lementett adat"))}catch(t){debug("ADAT_epito_load",t)}}function szem4_ADAT_kiir(t){try{return void(localStorage.getItem(AZON+"_"+t)?alert2("<textarea onmouseover='this.select()' onclick='this.select()' cols='38' rows='30'>"+localStorage.getItem(AZON+"_"+t)+"</textarea>"):alert2("Nincs lementett adat"))}catch(t){debug("szem4_ADAT_kiir",t)}}function szem4_ADAT_betolt(t){try{var e=prompt("Adja meg a kor√°bban SZEM4 √ÅLTAL KI√çRT ADATOT, melyet be k√≠v√°n t√∂lteni.\n\n Ne pr√≥b√°lj k√©zileg be√≠rni ide b√°rmit is. Helytelen adat megad√°s√°t SZEM4 nem tudja kezelni, az ebb≈ël ad√≥d√≥ m≈±k√∂d√©si rendelleness√©g csak RESET-el√©ssel √°ll√≠that√≥ helyre.");if(null==e||""==e)return;localStorage.setItem(AZON+"_"+t,e),"farm"==t&&szem4_ADAT_farm_load(),"epito"==t&&szem4_ADAT_epito_load(),"sys"==t&&szem4_ADAT_sys_load(),alert2("Az adatok sikeresen bet√∂lt≈ëdtek.")}catch(t){debug("szem4_ADAT_betolt",t)}}function loadCloudSync(){if(!CLOUD_AUTHS)return;try{if(!((CLOUD_AUTHS=JSON.parse(CLOUD_AUTHS)).authDomain&&CLOUD_AUTHS.projectId&&CLOUD_AUTHS.storageBucket&&CLOUD_AUTHS.messagingSenderId&&CLOUD_AUTHS.appId&&CLOUD_AUTHS.email&&CLOUD_AUTHS.password&&CLOUD_AUTHS.collection&&CLOUD_AUTHS.myDocument))throw"Must consist these fields: authDomain projectId storageBucket messagingSenderId appId email password"}catch(t){naplo("Sync","Invalid Auth data "+t)}const t=document.createElement("script");t.type="module",t.innerHTML="\n\t\timport { initializeApp } from \"https://www.gstatic.com/firebasejs/9.20.0/firebase-app.js\";\n\t\timport { getFirestore, collection, updateDoc, getDoc, doc } from \"https://www.gstatic.com/firebasejs/9.20.0/firebase-firestore.js\";\n\t\timport { getAuth, signInWithEmailAndPassword } from \"https://www.gstatic.com/firebasejs/9.20.0/firebase-auth.js\"\n\n\t\tconst app = initializeApp(CLOUD_AUTHS);\n\t\tconst db = getFirestore(app);\n\t\tconst auth = getAuth();\n\n\t\tsignInWithEmailAndPassword(auth, CLOUD_AUTHS.email, CLOUD_AUTHS.password)\n\t\t.then(async (userCredential) => {\n\t\t\tconst user = userCredential.user;\n\n\t\t\twindow.readUpData = async () => {\n\t\t\t\tconst myDoc = await getDoc(doc(db, CLOUD_AUTHS.collection, CLOUD_AUTHS.myDocument));\n\t\t\t\treturn myDoc.data();\n\t\t\t}\n\t\t\twindow.updateData = async (newData) => {\n\t\t\t\ttry {\n\t\t\t\t\tconst myDoc = await getDoc(doc(db, CLOUD_AUTHS.collection, CLOUD_AUTHS.myDocument));\n\t\t\t\t\tawait updateDoc(myDoc.ref, newData);\n\t\t\t\t\treturn 'OK';\n\t\t\t\t} catch(e) {\n\t\t\t\t\treturn 'Error: '+e;\n\t\t\t\t}\n\t\t\t}\n\t\t\twindow.naplo('Sync', 'Firebase felh≈ë kapcsolat l√©trej√∂tt');\n\t\t\tif (confirm(\"Firebase adatszinkroniz√°l√°s helyi adatokra?\")) {\n\t\t\t\twindow.loadCloudDataIntoLocal();\n\t\t\t} else {\n\t\t\t\twindow.szem4_ADAT_LoadAll();\n\t\t\t}\n\t\t})\n\t\t.catch((error) => {\n\t\t\tconst errorCode = error.code;\n\t\t\tconst errorMessage = error.message;\n\t\t});",document.head.appendChild(t)}function loadCloudDataIntoLocal(){CLOUD_AUTHS?(readUpData().then((t=>{localStorage.setItem(AZON+"_farm",t.farm),localStorage.setItem(AZON+"_epito",t.epit),localStorage.setItem(AZON+"_sys",t.vije),szem4_ADAT_LoadAll()})),document.getElementById("adat_opts").rows[4].cells[0].getElementsByTagName("input")[0].checked=!0):alert("Nincs akt√≠v felh≈ë szinkroniz√°ci√≥")}function saveLocalDataToCloud(t){if(CLOUD_AUTHS){t&&(szem4_ADAT_farm_save(),szem4_ADAT_epito_save(),szem4_ADAT_sys_save());var e={farm:localStorage.getItem(AZON+"_farm"),epit:localStorage.getItem(AZON+"_epito"),vije:localStorage.getItem(AZON+"_sys")};updateData(e).then((()=>{var t=new Date;document.getElementById("adat_opts").rows[4].cells[2].textContent=t.toLocaleString()}))}else alert("Nincs akt√≠v felh≈ë szinkroniz√°ci√≥")}function szem4_ADAT_motor(){try{if(!ADAT_PAUSE)if(0===ADAT_FIRST)ADAT_FIRST=1;else{var t=document.getElementById("adat_opts").rows;t[1].cells[0].getElementsByTagName("input")[0].checked&&szem4_ADAT_farm_save(),t[2].cells[0].getElementsByTagName("input")[0].checked&&szem4_ADAT_epito_save(),t[3].cells[0].getElementsByTagName("input")[0].checked&&szem4_ADAT_sys_save(),t[4].cells[0].getElementsByTagName("input")[0].checked&&saveLocalDataToCloud(!1)}}catch(t){debug("ADAT_motor",t)}try{worker.postMessage({id:"adatok",time:6e4})}catch(t){debug("adatok","Worker engine error: "+t),setTimeout((function(){szem4_ADAT_motor()}),3e3)}}function szem4_ADAT_AddImageRow(t){return'\t<img title="Jelenlegi adat bet√∂lt√©se" alt="Bet√∂lt" onclick="szem4_ADAT_'+t+'_load()" width="17px" src="'+pic("load.png")+'"> \t<img title="T√∂rl√©s" alt="T√∂r√∂l" onclick="szem4_ADAT_del(\''+t+'\')" src="'+pic("del.png")+'" width="17px""> \t<img title="Jelenlegi adat kiirat√°sa" alt="Export" onclick="szem4_ADAT_kiir(\''+t+'\')" width="17px" src="'+pic("Export.png")+'"> \t<img title="Saj√°t adat bet√∂lt√©se" alt="Import" onclick="szem4_ADAT_betolt(\''+t+'\')" width="17px" src="'+pic("Import.png")+'"> \t<img title="Ment√©s MOST" alt="Save" onclick="szem4_ADAT_saveNow(\''+t+'\')" width="17px" src="'+pic("saveNow.png")+'">\t<img title="Reset: Helyre√°ll√≠t√°s" alt="Reset" onclick="szem4_ADAT_restart(\''+t+'\')" width="17px" src="'+pic("reset.png")+'">'}szem4_EPITO_motor(),szem4_EPITO_perccsokkento(),ujkieg("adatok","Adatment≈ë",'<tr><td><p align="center"><b>Figyelem!</b> Az adatment≈ë legels≈ë elind√≠t√°sakor bet√∂lti a lementett adatokat (ha van), nem t√∂r≈ëdve azzal, hogy jelenleg mi a munkafolyamat.<br>√öj adatok haszn√°lat√°hoz az adatment≈ë ind√≠t√°sa el≈ëtt haszn√°ld a t√∂rl√©st a lenti t√°bl√°zatb√≥l.</p><table class="vis" id="adat_opts" style="width:100%; margin-bottom: 50px;"><tr><th style="width:105px">Enged√©lyez√©s</th><th style="width:118px">Kieg√©sz√≠t≈ë neve</th><th style="width:250px">Utols√≥ ment√©s ideje</th><th style="width:93px">Adat kezel√©se</th></tr><tr><td><input type="checkbox" checked></td><td>Farmol√≥</td><td></td><td>'+szem4_ADAT_AddImageRow("farm")+'</td></tr><tr><td><input type="checkbox" checked></td><td>√âp√≠t≈ë</td><td></td><td>'+szem4_ADAT_AddImageRow("epito")+'</td></tr><tr><td><input type="checkbox" checked></td><td>VIJE,Adatment≈ë,Hangok</td><td></td><td>'+szem4_ADAT_AddImageRow("sys")+'</td></tr><tr><td><input type="checkbox" unchecked></td><td><img height="17px" src="'+pic("cloud.png")+'"> Cloud sync</td><td></td><td>\t\t\t<img title="Cloud adat bet√∂lt√©se a jelenlegi rendszerbe" alt="Import" onclick="loadCloudDataIntoLocal()" width="17px" src="'+pic("Import.png")+'"> \t\t\t<img title="Local adat lement√©se a Cloud rendszerbe" alt="Save" onclick="saveLocalDataToCloud(true)" width="17px" src="'+pic("saveNow.png")+'"></td></tr></table><p align="center"></p></td></tr>');var FARM_TESZTER_TIMEOUT,ADAT_PAUSE=!1,ADAT_FIRST=0;szem4_ADAT_motor(),$(document).ready((function(){nyit("naplo"),vercheck(),naplo("Indul√°s","SZEM 4.5 elindult."),naplo("Indul√°s","Farmol√≥k sz√ºnetel≈ë m√≥dban."),0!=TIME_ZONE&&naplo("Id≈ëz√≥na üïê",`Id≈ëeltol√≥d√°s friss√≠tve: eltol√≥d√°s ${TIME_ZONE} perccel.`),soundVolume(0),playSound("bot2"),confirm("Enged√©lyezed az adatok ment√©s√©t?\nK√©s≈ëbb elind√≠thatja, ha visszapip√°lja a ment√©s enged√©lyez√©s√©t - ekkor sz√ºks√©ges k√©zi adatbet√∂lt√©s is el≈ëtte.")?CLOUD_AUTHS?(naplo("Sync","Connecting to Firebase Cloud System..."),loadCloudSync()):(naplo("Sync","Firebase Cloud System is not setup. Create 'szem_firebase' localStorage item with credentials"),naplo("Adat","Adatbet√∂lt√©s helyi adatokb√≥l..."),szem4_ADAT_LoadAll()):szem4_ADAT_StopAll(),setTimeout((function(){soundVolume(1)}),2e3),$((function(){$("#alert2").draggable({handle:$("#alert2head")}),$("#sugo").mouseover((function(){sugo(this,"Ez itt a s√∫g√≥")})),$("#fejresz").mouseover((function(){sugo(this,"")}))})),$("#farm_opts input").on("keydown keypress",(function(){FARM_TESZTER_TIMEOUT&&clearTimeout(FARM_TESZTER_TIMEOUT),FARM_TESZTER_TIMEOUT=setTimeout((()=>shorttest()),1e3)})),document.addEventListener("keydown",(function(t){"Escape"===t.key&&alert2("close")})),document.addEventListener("click",addFreezeNotification),document.addEventListener("keypress",addFreezeNotification),addFreezeNotification(),window.onbeforeunload=function(){return!0}}));
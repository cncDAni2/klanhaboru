javascript:var TIME=333;function loadXMLDoc(e){return window.XMLHttpRequest?xhttp=new XMLHttpRequest:xhttp=new ActiveXObject("Microsoft.XMLHTTP"),xhttp.open("GET",e,!1),xhttp.send(),xhttp.responseXML}function saveDataToCookie(){try{for(var e="",t=document.getElementById("Utypes").getElementsByTagName("input"),a=0;a<t.length;a++)a>0&&(e+=","),e+=t[a].checked;e+=";"+document.getElementById("minegyseg").value,e+=";"+document.forms.megvalto.speed.value,e+=";"+document.forms.megvalto.nl.checked,localStorage.setItem("cnc_Megvalto",e)}catch(e){alert("Hiba történt adat-lementéskor\n\n"+e)}}function setDataFromCookie(){try{var e=localStorage.getItem("cnc_Megvalto");if(!e)return;e=e.split(";");for(var t=document.getElementById("Utypes").getElementsByTagName("input"),a=e[0].split(","),n=0;n<t.length;n++)t[n].checked="true"==a[n];document.getElementById("minegyseg").value=e[1],document.forms.megvalto.speed.value=e[2],document.forms.megvalto.nl.checked="true"==e[3]}catch(e){alert("Hiba történt adat-beolvasáskor\n\n"+e)}}function getUnitImg(e){return'<img src="/graphic/unit/unit_'+e+'.png">'}function getfaluk(){try{for(var e=0,t=document.getElementById("production_table"),a=1;a<t.rows.length;a++)"none"!=t.rows[a].style.display&&e++;return Rfaluk2=e,e>100&&(Rfaluk2=e+" <a href=\"javascript: alert('A böngészõ minden falut meg fog nyitni, ami jelen esetbe "+e+" db-ot jelent. A megnyitás lassú lehet, és a böngészõ széteshet.\nJavasolt 100-nál kevesebb falu használata!');\">(!)</a>"),document.getElementById("ofalu").innerHTML=Rfaluk2,e}catch(e){alert(e)}}function bezar(){try{saveDataToCookie();for(var e=0;e<refarray.length;e++)try{refarray[e].close()}catch(e){}return}catch(e){alert(e)}}function slowSuppClick(){try{CIK=0;for(var e=0;e<refarray.length;e++)setTimeout((function(){refarray[CIK].document.forms.units.support.click(),CIK++}),TIME*e)}catch(e){alert("OK-HIBA\n"+e)}}function slowOkClick(){try{CIK=0;for(var e=0;e<refarray.length;e++)setTimeout((function(){refarray[CIK].document.forms.units.support.click(),CIK++}),TIME*e)}catch(e){alert("OK-HIBA\n"+e)}}function okez(){try{CIK=0,saveDataToCookie();for(var e=0;e<refarray.length;e++)setTimeout((function(){try{refarray[CIK].document.getElementById("troop_confirm_submit").click()}catch(e){}CIK++}),TIME*e)}catch(e){alert(e)}}function getNl(){return 1==document.forms.megvalto.nl.checked?4:6}function szamlalS(){try{var e=document.getElementById("beido").getElementsByTagName("input");if(e[0].checked)var t=e[1].value;else t="";if(""!=t){var a=t.match(/[0-9]+/g);for(o=0;o<6;o++)try{""==a[o]&&(a[o]=0),a[o]=parseInt(a[o],10)}catch(e){return void alert("Hibás idõmegadás.\n"+e)}if(a[1]>12||a[2]>31||a[3]>23||a[4]>59||a[5]>59)return void alert("Érvénytelen idõpontmegadás");var n=new Date(a[0],a[1]-1,a[2],a[3],a[4],a[5],0)}else n="";var r=new Array(0,0,0,0,0,0),l=0;if(0==refarray.length)throw"Nincs 1 lap sem megnyitva";for(var o=0;o<refarray.length;o++)if(refarray[o].document.getElementById("unit_input_spear"))r[0]+=parseInt(refarray[o].document.getElementById("unit_input_spear").parentNode.children[2].innerHTML.match(/[0-9]+/g)[0]),r[1]+=parseInt(refarray[o].document.getElementById("unit_input_sword").parentNode.children[2].innerHTML.match(/[0-9]+/g)[0]),ARCHERS&&(r[2]+=parseInt(refarray[o].document.getElementById("unit_input_archer").parentNode.children[2].innerHTML.match(/[0-9]+/g)[0])),r[3]+=parseInt(refarray[o].document.getElementById("unit_input_spy").parentNode.children[2].innerHTML.match(/[0-9]+/g)[0]),r[4]+=parseInt(refarray[o].document.getElementById("unit_input_heavy").parentNode.children[2].innerHTML.match(/[0-9]+/g)[0]),r[5]+=parseInt(refarray[o].document.getElementById("unit_input_catapult").parentNode.children[2].innerHTML.match(/[0-9]+/g)[0]),l+=szumsereg(o,n);else try{refarray[o].close()}catch(e){}l=""!=n?"\n\nA megadott idõre viszont csak "+l+" fõ egységet lehet küldeni":"",alert("Mozgosítható sereg:\n"+r[0]+" lándzsás\n"+r[1]+" kardforgató\n"+r[2]+" íjász\n"+r[3]+" felderítõ\n"+r[4]+" nehézlovas\n"+r[5]+" katapult\n\nÖsszesen: "+(r[0]+r[1]+r[2]+r[4]*getNl())+" fõ egység (kata/kém nélkül)"+l)}catch(e){alert("Nem lehetett sereget összegezni.\n Sereg összegzésére csak akkor van lehetõség, ha a megnyitott lapokon a gyülekezõhely szerepel!\n\n"+e)}}function szumsereg(e,t){var a,n,r=0,l=refarray[e].document,o=document.getElementById("Utypes").getElementsByTagName("input");if(""!=t){var s=refarray[e].game_data.village.coord.split("|"),i=document.getElementById("falu").value.split("|"),d=Math.abs(Math.sqrt(Math.pow(s[0]-i[0],2)+Math.pow(s[1]-i[1],2)))*(1/SPEED)*(1/UNITS);a=d,""!==(n=document.forms.megvalto.speed.value)?(n=n.replace(/[^0-9]+/g,""),(n=parseInt(n))>100&&(n=0),document.forms.megvalto.speed.value=n):n=0,d=a*((100-n)/100);var c=new Date}o[0].checked&&(""!=t?t>new Date(c.getTime()+Math.round(6e4*d*18))&&(r+=parseInt(l.getElementById("unit_input_spear").parentNode.children[2].textContent.match(/[0-9]+/g)[0])):r+=parseInt(l.getElementById("unit_input_spear").parentNode.children[2].textContent.match(/[0-9]+/g)[0]));o[1].checked&&(""!=t?t>new Date(c.getTime()+Math.round(6e4*d*22))&&(r+=parseInt(l.getElementById("unit_input_sword").parentNode.children[2].textContent.match(/[0-9]+/g)[0])):r+=parseInt(l.getElementById("unit_input_sword").parentNode.children[2].textContent.match(/[0-9]+/g)[0]));o[2].checked&&(ARCHERS&&(""!=t?t>new Date(c.getTime()+Math.round(6e4*d*18))&&(r+=parseInt(l.getElementById("unit_input_archer").parentNode.children[2].textContent.match(/[0-9]+/g)[0])):r+=parseInt(l.getElementById("unit_input_archer").parentNode.children[2].textContent.match(/[0-9]+/g)[0])));o[3].checked&&(""!=t?t>new Date(c.getTime()+Math.round(6e4*d*11))&&(r+=parseInt(l.getElementById("unit_input_heavy").parentNode.children[2].textContent.match(/[0-9]+/g)[0])*getNl()):r+=parseInt(l.getElementById("unit_input_heavy").parentNode.children[2].textContent.match(/[0-9]+/g)[0])*getNl());o[4].checked&&(""!=t?t>new Date(c.getTime()+Math.round(6e4*d*30))&&(r+=8*parseInt(l.getElementById("unit_input_catapult").parentNode.children[2].textContent.match(/[0-9]+/g)[0])):r+=8*parseInt(l.getElementById("unit_input_catapult").parentNode.children[2].textContent.match(/[0-9]+/g)[0]));return r}function osszeszamol(e){var t=[],a=[],n={spear:0,allSpear:0,sword:0,allSword:0,archer:0,allArcher:0,heavy:0,allHeavy:0,catapult:0,allCatapult:0,allTogether:0,allAllTogether:0},r=document.getElementById("minegyseg").value;""==r&&(r=0);for(var l={},o=0;o<refarray.length;o++){l=getCurrUnit(refarray[o].document);var s=document.getElementById("beido").getElementsByTagName("input"),i=s[0].checked;if(a[o]="",i){var d=p(),c=m(s[1].value),u=new Date;c>new Date(u.getTime()+Math.round(6e4*d*30))?a[o]="catapult":c>new Date(u.getTime()+Math.round(6e4*d*22))?a[o]="sword":c>new Date(u.getTime()+Math.round(6e4*d*18))?a[o]="spear":c>new Date(u.getTime()+Math.round(6e4*d*11))&&(a[o]="heavy")}else a[o]="catapult";t[o]=g(a[o],l,n)}e&&(alert("Mozgosítható sereg ("+n.allAllTogether+" fõ): \n"+n.allSpear+" lándzsás\n"+n.allSword+" kardforgató\n"+n.allArcher+" íjász\n"+n.allHeavy+" nehézlovas\n"+n.allCatapult+" katapult"+("\n\nA feltételek mellett maximum "+n.allTogether+" fõt tudok küldeni.")),console.info(n));return{slowest:a,unitsDb:t};function g(t,a,n){var r=0,l=document.getElementById("Utypes").getElementsByTagName("input");switch(e&&(n.allCatapult+=a.catapult,n.allSword+=a.sword,n.allSpear+=a.spear,n.allArcher+=a.archer,n.allHeavy+=a.heavy,n.allAllTogether+=8*a.catapult+a.sword+a.spear+a.archer+a.heavy*getNl()),t){case"catapult":l[4].checked&&(r+=8*a.catapult,n.catapult+=a.catapult);case"sword":l[1].checked&&(r+=a.sword,n.sword+=a.sword);case"spear":l[0].checked&&(r+=a.spear,n.spear+=a.spear),l[2].checked&&(r+=a.archer,n.archer+=a.archer);case"heavy":l[3].checked&&(r+=a.heavy*getNl(),n.heavy+=a.heavy)}return r<parseInt(document.getElementById("minegyseg").value,10)&&(r=0),n.allTogether+=r,r}function p(){try{var e=refarray[o].game_data.village.coord.split("|"),t=document.getElementById("falu").value.split("|");return function(e){var t=document.forms.megvalto.speed.value;""!==t?(t=t.replace(/[^0-9]+/g,""),(t=parseInt(t))>100&&(t=0),document.forms.megvalto.speed.value=t):t=0;return e*(t=(100-t)/100)}(Math.abs(Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)))*(1/SPEED)*(1/UNITS))}catch(e){alert("Hibás koordináta megadás\n"+e)}}function m(e){try{for(var t=e.match(/[0-9]+/g),a=0;a<6;a++)""==t[a]&&(t[a]=0),t[a]=parseInt(t[a],10);return t[1]>12||t[2]>31||t[3]>23||t[4]>59||t[5]>59?void alert("Érvénytelen idõpontmegadás"):new Date(t[0],t[1]-1,t[2],t[3],t[4],t[5],0)}catch(e){return void alert("Hibás idõmegadás.\n"+e)}}}function getCurrUnit(e){var t={spear:parseInt(e.getElementById("units_entry_all_spear").innerHTML.match(/[0-9]+/g)[0]),sword:parseInt(e.getElementById("units_entry_all_sword").innerHTML.match(/[0-9]+/g)[0]),heavy:parseInt(e.getElementById("units_entry_all_heavy").innerHTML.match(/[0-9]+/g)[0]),catapult:parseInt(e.getElementById("units_entry_all_catapult").innerHTML.match(/[0-9]+/g)[0]),archer:0};return ARCHERS&&(t.archer=parseInt(e.getElementById("units_entry_all_archer").innerHTML.match(/[0-9]+/g)[0])),t}function seregilleszt(e,t){for(var a={spear:0,sword:0,archer:0,heavy:0,catapult:0},n=document.getElementById("Utypes").getElementsByTagName("input"),r=0;r<e.unitsDb.length;r++){var l,o,s=getCurrUnit(o=refarray[r].document);if(o.getElementById("unit_input_catapult").value="",0!=e.unitsDb[r]){switch(o.getElementById("unit_input_sword").value="",o.getElementById("unit_input_spear").value="",o.getElementById("unit_input_archer").value="",o.getElementById("unit_input_heavy").value="",e.slowest[r]){case"catapult":n[4].checked&&(l=Math.round(s.catapult*t),a.catapult+=l,o.getElementById("unit_input_catapult").value=l);case"sword":n[1].checked&&(l=Math.round(s.sword*t),a.sword+=l,o.getElementById("unit_input_sword").value=l);case"spear":n[0].checked&&(l=Math.round(s.spear*t),a.spear+=l,o.getElementById("unit_input_spear").value=l),n[2].checked&&(l=Math.round(s.archer*t),a.archer+=l,o.getElementById("unit_input_archer")&&(o.getElementById("unit_input_archer").value=l));case"heavy":n[3].checked&&(l=Math.round(s.heavy*t),a.heavy+=l,o.getElementById("unit_input_heavy").value=l)}o.getElementById("place_target").getElementsByTagName("input")[0].value=document.getElementById("falu").value}}return console.info("Kiküldött sereg::",a),a}function beilleszt(){try{if(refarray.length<1)return;saveDataToCookie();for(var e,t=document.getElementById("oegyseg").value,a=osszeszamol(!1),n=0,r=0;r<a.unitsDb.length;r++)n+=a.unitsDb[r];if(0==n)return void alert("A megadott feltételek mellett 1 fõt se tudok küldeni.");"max"==t?e=1:(e=t/n)>1&&(alert("Nincs ennyi sereg a falvakban, ezért a maximumot küldöm, "+n+" fõt."),e=1);var l=seregilleszt(a,e);slowSuppClick(),str="";var o=document.getElementById("Utypes").getElementsByTagName("input");console.info("kikuldottsereg:",l),o[0].checked&&l.spear>0&&(str+="&nbsp;&nbsp;"+getUnitImg("spear")+" "+l.spear+" lándzsás<br>"),o[1].checked&&l.sword>0&&(str+="&nbsp;&nbsp;"+getUnitImg("sword")+" "+l.sword+" kardforgató<br>"),o[2].checked&&l.archer>0&&(str+="&nbsp;&nbsp;"+getUnitImg("archer")+" "+l.archer+" íjász<br>"),o[3].checked&&l.heavy>0&&(str+="&nbsp;&nbsp;"+getUnitImg("heavy")+" "+l.heavy+" nehézlovas<br>"),o[4].checked&&l.catapult>0&&(str+="&nbsp;&nbsp;"+getUnitImg("catapult")+" "+l.catapult+" katapult"),""==str&&(str="Nagy gond van! Szerintem semmit se kell kiküldeni..."),document.getElementById("eredmeny").innerHTML="Kiküldendõ sereg összesen:<br>"+str}catch(e){alert("Beilleszt hiba\n"+e)}}function openIt(e,t){var a=document.getElementById("production_table").rows[t].cells[0].getElementsByTagName("a");0===a.length&&(a=document.getElementById("production_table").rows[t].cells[1].getElementsByTagName("a")),refarray[e]=window.open(a[0].href.replace("overview","place"),"megvalto"+document.getElementById("megvalt_id").getElementsByTagName("input")[0].value+e)}function lapnyit(){try{saveDataToCookie(),refarray=new Array;var e=document.getElementById("production_table");if(getfaluk()>100)var t=confirm(getfaluk()+" db falut (azaz lapot) próbálsz megnyitni! Folytatod?");else t=!0;if(!t)return;for(var a=[],n=1;n<e.rows.length;n++)"none"!=e.rows[n].style.display&&a.push(n);for(CIK=0,n=0;n<a.length;n++)setTimeout((function(){openIt(CIK,a[CIK]),CIK++}),TIME*n)}catch(e){alert(e)}}function init(){try{if(ARCHERS)var e="checked";else e="";var t=new Date,a=t.getFullYear()+"."+(t.getMonth()+1)+"."+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":00";$("body").append('<style>#boxhead{padding-bottom:40px}#eredmeny{border-left: 2px solid blue;padding-left:5px;background: rgba(255,255,255,0.15);width: 250px;border-radius: 0 7px 7px 0}.megvalt_seregsz{background: rgba(0,255,0,0.6);color: #2e42D0;padding: 4px;border-radius: 10px}.megvalt_seregsz:hover{background: #2e42D0;color: white}form[name="megvalto"]{padding-bottom:10px}#megvalt_id {position: absolute; bottom:10px; right:5px; font-size: 80%;}.megvaltTbl{font-weight: bold;} .megvaltTbl tr td:first-child {text-align: right;padding-right: 7px;} .megvaltBtn{margin-left: -5px;border-left: none;width:175px;font-size:110%;text-align:left;margin-bottom:5px;padding:4px;background:linear-gradient(to right,#005,#44A);border:1px solid #66B;border-radius:0 10px 10px 0;color:#fff;cursor:pointer;outline:0}.megvaltBtn:hover{background:linear-gradient(to right,#229,#66C)}.megvaltBtn:active{background:green}</style>'),$("body").append('<div style="background-color: #3F0;  width: 400px; background-image: url(\'https://raw.githubusercontent.com/cncDAni2/klanhaboru/main/images/megvalto_bg.png\'); color: black; font-weight:bold; background-position:center top; background-repeat:no-repeat; position: absolute; left:30%; top:30%; border:3px solid black; padding: 5px; z-index:200;" id="divbox"><div id="boxhead"></div><b>Összes falu:</b> <p id="ofalu" style="display: inline;">???</p><br><form name="megvalto"><table class="megvaltTbl"><tr><td>Erõsítendõ falu</td><td><input type="text" id="falu" placeholder="xxx|xxx" size="7"></td></tr><tr><td>Küldendõ egységtípusok</td><td id="Utypes">'+getUnitImg("spear")+'<input type="checkbox" checked>'+getUnitImg("sword")+'<input type="checkbox" checked>'+getUnitImg("archer")+'<input type="checkbox"'+e+">"+getUnitImg("heavy")+'<input type="checkbox" checked>'+getUnitImg("catapult")+'<input type="checkbox"></td></tr><tr><td>Küldendõ egységek száma</td><td><input type="text" id="oegyseg" placeholder="Értéke lehet \'max\'." size="14"></td></tr><tr><td>Minimum sereg/falu</td><td><input type="text" id="minegyseg" value="100" size="4" placeholder="0"></td></tr><tr id="beido"><td><input type="checkbox" style="transform: scale(1.3, 1.3);"> Max beérkezési idõ <a href="javascript: alert(\'Ha bepipálod, a script figyelni fog arra, hogy a megadott idõn túl ne küldjön ki erõsítést. Ha kell, akkor egységmódosítást hajt végre, és pl. csak nehézlovast küld, hogy elérje célját.\n Ha van valamilyen erõsítés gyorsító bonusz az adott falura, azt megadhatod.\')">(?)</a></td><td><input type="text" size="18" value="'+a+'"></td></tr><tr><td>Sebesség bónusz</td><td><input type="text" size="2" value="0" name="speed" placeholder="0">%</td></tr><tr><td>Nehézló = 4 ?</td><td><input type="checkbox" name="nl" style="transform: scale(1.3, 1.3);" value="false" onchange=""></td></tr></table></form><input class="megvaltBtn" type="button" onclick="lapnyit()" value="1) Lapok megnyitása">&nbsp;&nbsp;&nbsp;&nbsp;&rarr;&nbsp;&nbsp;<a href="javascript: osszeszamol(true)" class="megvalt_seregsz">&Sum; Seregszámlálás</a><br><input class="megvaltBtn" type="button" onclick="beilleszt()" value="2) Sereg beillesztése"><br><input class="megvaltBtn" type="button" onclick="okez()" value="3) Erõsítések leokézása"><br><input class="megvaltBtn" type="button" onclick="bezar()" value="4) Lapok bezárása"><br><p id="eredmeny"></p>C&amp;C Mûhely ~ cncDAni2<div id="megvalt_id">ID: <input type="text" value="M1" size="2"> <a style="color:blue" href="javascript: alert(\'Egyedi ablakcsoport-azonosító. Más ID = más ablaknevek, így pl. nem nyit rá az eddig megnyitott ablakokra.\');">(?)</a></div></div>'),getfaluk(),setDataFromCookie()}catch(e){alert("Indítási hiba:\n"+e)}}"undefined"==typeof MEGVALTO?MEGVALTO=!0:exit(0);try{var BASE_URL=document.location.href.split("game.php")[0],CONFIG=loadXMLDoc(BASE_URL+"interface.php?func=get_config"),ARCHERS=CONFIG.getElementsByTagName("archer")[0].textContent;ARCHERS="0"!=ARCHERS;var SPEED=CONFIG.getElementsByTagName("speed")[0].textContent,UNITS=CONFIG.getElementsByTagName("unit_speed")[0].textContent,CIK=0}catch(e){alert(e)}init(),refarray=new Array,$(document).ready((function(){$((function(){$("#divbox").draggable({handle:$("#boxhead")})}))}));
var a,c=1,d=0,e=0;var f=!1,g=0,h=['bot2.wav','BOMB_SIREN_hosszu.mp3','Intruder_alert.mp3','alarm-frenzy.mp3','bogyo_mese_hosszu.mp3','bubbling-up.mp3','capisci.mp3','decay.mp3','determined.mp3','hell-yeah.mp3','lovely.mp3','may-i-have-your-attention.mp3','nasty-error-long.mp3','nice-cut.mp3','oh-finally.mp3','on-serious-matters.mp3','system-fault.mp3','thats-nasty.mp3'],i={},j=game_data.world+" - K"+(game_data.village.y+'')[0]+(game_data.village.x+'')[0],k=['minimum','maximum','any','some','action','keszlet','autotrans','newMail','newAttack'],l=['min_wood','min_stone','min_iron','max_wood','max_stone','max_iron','action_wood','action_stone','action_iron','keszlet_wood','keszlet_stone','keszlet_iron','nameOfBeerkezo','nameOfElad','nameOfVasarolj'],m=['minRes','minLimit','maxRes','maxLimit'],n=['minRes','minLimit','maxRes','maxLimit'],o={min:[9999,9999,9999],max:[0,0,0],avg:[0,0,0,0],lastStat:new Date(),autoSell:[0,0,0,0],autoBuy:[0,0,0,0]},p='https://raw.githubusercontent.com/cncDAni2/klanhaboru/main/images/szem4/',q='bot2.wav',r={},s={minimum:!0,maximum:!1,any:!1,some:!1,min_wood:500,min_stone:500,min_iron:500,max_wood:1500,max_stone:1500,max_iron:1500,action:!0,action_wood:20,action_stone:20,action_iron:20,keszlet:!1,keszlet_wood:1000,keszlet_stone:1000,keszlet_iron:1000,autotrans:!0,newMail:!1,newAttack:!0,nameOfBeerkezo:'Beérkező',nameOfElad:'Elad',nameOfVasarolj:'Vásárolj',sound:{minimum:q,maximum:q,any:q,some:q,action:q,keszlet:q,autotrans:q,newMail:q,newAttack:q}},t={hangSzunet:new Date(),lastResult:[0,0,0],lastChange:new Date(),noSoundIf:!0,agressiveRefresh:!1,agressiveRefreshTime:0},u={wood:{sell:{},buy:{}},stone:{sell:{},buy:{}},iron:{sell:{},buy:{}}},v={wood:{},stone:{},iron:{}},w={inProgress:!1,startProgress:new Date(),mode:'',type:'',ppValue:0,sellValue:0,minMaxPrice:0,isError:!1,lastSuccess:new Date()},x=0,y,z=window.location.href.split("village="),_temp26=_temp27(self=>self.addEventListener("message",function(e){setTimeout(function(){postMessage('')},e.data)},!1));document.body.style.backgroundImage="none";document.body.style.background="#e3d5b3 url(https://dshu.innogamescdn.com/asset/233cdec1/graphic/index/main_bg.jpg) scroll right top repeat";z=z[0]+'village='+game_data.village.id+'&screen=market&mode=exchange';_temp26.onmessage=()=>_temp53();function _temp27(_a){return new Worker(window.URL.createObjectURL(new Blob([`(${_a.toString()})(self)`], {type:"text/javascript"})))}function _temp28(_a){var _c='<select onchange="changeSound(this, \''+_a+'\')" name="'+_a+'_sound">';for(var i=0;i<h.length;i++)_c+='<option value="'+h[i]+'">'+h[i].split('.')[0]+'</option>';_c+=`</select><button type="button" onclick="csengess('${_a}')">&#9654;</button>`;return _c}function _temp29(_a){var _c=['wood','stone','iron'],_d='<div class="autoChk">';for(var i=0;i<_c.length;i++)_d+='<span class="icon header '+_c[i]+'"> </span> <input type="checkbox" onclick="stopStartAuto(this,\''+_a+'\', \''+_c[i]+'\')"><br>';_d+='</div>';return _d}function _temp30(_a,_c){return '<button type="button" class="plusminusbutton" onclick="changeLimits(\''+_a+'\', \''+_c+'\', 25)">+</button>\
			<button type="button" class="plusminusbutton" onclick="changeLimits(\''+_a+'\', \''+_c+'\', -25)">-</button>'}document.title=`${j} Tőzsde`;document.getElementsByTagName("head")[0].innerHTML+='<style type="text/css">h3 { transition: width 0.5s, background 0.25s; cursor:pointer; width: 700px; margin: 10px auto; padding: 5px; border: 1px solid black; border-radius: 20px} h3:hover {background: rgba(0,0,255,0.3) !important; width: 725px; } h3.openedH3 {background: rgba(255,255,255,0.5); width: 800px; } .autoChk {display: block} h1:hover {color: #555} #cnc_stats {background: #aac; margin: 10px auto; border-collapse: collapse} .plusminusbutton {outline: none; background: lightgray;opacity: 0.7;cursor:pointer} .plusminusbutton:hover {opacity:1.0} #cnc_stats td, #cnc_stats th {min-width: 50px; text-align: center; padding: 3px; border-bottom: 1px solid darkgoldenrod} #cnc_stats td:first-child, #cnc_stats th:first-child {  text-align: left;  border-right: 1px solid black; padding-right: 20px; } #cnc_tozsde input[type="checkbox"] { margin: 0 3px 0 0; zoom: 1.3; } #cnc_tozsde #tozsde_auto td {padding: 4px} #cnc_tozsde td {padding: 2px} #cnc_tozsde #tozsde_auto input[type=number] { width: 55px; } #cnc_tozsde .bigNum input[type=number] {width: 55px } #cnc_tozsde input[type=number] {width: 47px; padding: 2px} #allapot table tr td:not(:first-child), #allapot table tr th:not(:first-child), #cnc_tozsde th:not(:first-child) {text-align: center}.header50 {width: 50px} .header60 {width: 60px} #allapot table tr:hover {background-color: rgba(100,100,255,0.2)} #allapot .item-info {background-image: linear-gradient(to right, rgba(254,0,255,0.3) , transparent 14%, transparent 86%, rgba(254,0,255,0.3))} #allapot .item-sell {background-image: linear-gradient(to right, rgba(100,100,255,0.6), transparent 14%, transparent 86%, rgba(100,100,255,0.6))} #allapot .item-buy {background-image: linear-gradient(to right, rgba(254,100,100,0.3) , transparent 14%, transparent 86%, rgba(254,100,100,0.3))} #allapot .item-incoming-warning { background-image: linear-gradient(to right, rgba(255,0,0,0.8), transparent 24%, transparent 76%, rgba(255,0,0,0.8)) } \
#tozsde_save:not([disabled]), #auto_save:not([disabled]) { background: rgb(236,236,236); animation-name: flash; animation-duration: 1s; animation-timing-function: linear; animation-iteration-count: infinite; } @keyframes flash {      0% { background: rgb(236,236,236); }    50% { background: rgb(100,100,200); }    100% { background: rgb(236,236,236); }} </style>';document.body.innerHTML='<h1 align="center" style="cursor: context-menu;text-shadow: 3px 3px 4px #666; margin-top:10px;">Prémium Tőzsde kezelő ('+j+')</h1>\
<h4 style="text-align: center; margin-top:0;">'+game_data.player.name+' ('+game_data.village.display_name+')</h4>\
<br><h3 align="center" onclick="setTabVisibility(\'h3_1\', this)">Hangjelzés beállítása</h3>\
<form id="cnc_tozsde"><div style="display:none" id="h3_1"><table class="vis" style="margin: auto;">\
<tr><th>Hangjelzés, amikor...</th><th><span class="icon header wood"> </span></th><th><span class="icon header stone"> </span></th><th><span class="icon header iron"> </span></th><th>Hang</th></tr>\
<tr><td><input type="checkbox" name="minimum"> Az árfolyam ez alá csökken:</td><td><input type="number" name="min_wood"></td><td><input type="number" name="min_stone"></td><td><input type="number" name="min_iron"></td><td>'+_temp28('minimum')+'</td></tr>\
<tr><td><input type="checkbox" name="maximum"> Az árfolyam e fölé megy:</td><td><input name="max_wood" type="number"></td><td><input type="number" name="max_stone"></td><td><input type="number" name="max_iron"></td><td>'+_temp28('maximum')+'</td></tr>\
<tr><td colspan="4"><input type="checkbox" name="any"> Lehetséges eladni valamit</td><td>'+_temp28('any')+'</td></tr>\
<tr><td colspan="4"><input type="checkbox" name="some"> Nem lehet eladni valamit</td><td>'+_temp28('some')+'</td></tr>\
<tr><td><input type="checkbox" name="action"> Hirtelen áresés történik:</td><td><input type="number" name="action_wood" type="number">%</td><td><input type="number" name="action_stone">%</td><td><input type="number" name="action_iron">%</td><td>'+_temp28('action')+'</td></tr>\
<tr class="bigNum"><td><input type="checkbox" name="keszlet"> Készleten van ennyi nyersanyag:</td><td><input name="keszlet_wood" type="number"></td><td><input type="number" name="keszlet_stone"></td><td><input type="number" name="keszlet_iron"></td><td>'+_temp28('keszlet')+'</td></tr>\
<tr><td colspan="4"><input type="checkbox" name="autotrans" disabled>Az automata sikeres tranzakciót hajtott végre</td><td>'+_temp28('autotrans')+'</td></tr>\
<tr><td colspan="4"><input type="checkbox" name="newMail"><span class="icon header new_mail" style="height:16px"> </span> Új üzeneted érkezett</td><td>'+_temp28('newMail')+'</td></tr>\
<tr><td colspan="4"><input type="checkbox" name="newAttack"><img src="/graphic/buildings/barracks.png"> Bejövő támadások száma emelkedett</td><td>'+_temp28('newAttack')+'</td></tr>\
<tr><td colspan="4"><input type="checkbox" checked disabled> Bot védelem aktív</td><td>'+_temp28('bot')+'</td></tr>\
</table>\
<div style="margin:auto; width:720px; text-align: center;" id="hangero"><hr><strong>Hangerő: </strong>\
<button type="button" onclick="hangero(-20)">-</button> <p style="display: inline; margin:0; padding: 0;">100%</p> <button type="button" onclick="hangero(20)">+</button> <button type="button" onclick="loadSoundData()">Hangok újrabetöltése</button><br>\
Hangjelzés szüneteltetése <input value="5" type="number" id="stoptime"> percre <button type="button" onclick="stopSound(this)">Hangszünet</button><br>\
<div id="stopSoundTime"></div>\
<input type="checkbox" checked onclick="stopSoundIf(this)"> Ne legyen hangjelzés limit alatt/eladható mennyiség/árzuhanás esetén, ha nincs szabad kereskedőd</div></div>\
<h3 align="center" onclick="setTabVisibility(\'h3_2\', this)"><s>Automatika beállítása</s></h3>\
<div id="h3_2" style="display:none"><table class="vis" style="margin: auto; border-collapse: collapse;" id="tozsde_auto">\
<tr><th colspan="2">Automatika tanítása</th><th><span class="icon header wood"> </span> <button type="button" onclick="copyAuto(0)">=</button></th><th><span class="icon header stone"> </span>  <button type="button" onclick="copyAuto(1)">=</button></th><th><span class="icon header iron"> </span> <button type="button" onclick="copyAuto(2)">=</button></th></tr>\
<tr><td rowspan="4" style="text-align:center; border-right: 2px solid #F88">Nyerseladás '+_temp29('sell')+'</td><td><span class="icon header premium"> </span> Minimum limit '+_temp30("sell","minLimit")+'</td><td><input type="number" name="auto_sell_wood_minLimit"></td><td><input type="number" name="auto_sell_stone_minLimit"></td><td><input type="number" name="auto_sell_iron_minLimit"></td></tr>\
<tr><td><span class="icon header ressources"> </span> Minimum nyers a faluban</td><td><input type="number" name="auto_sell_wood_minRes"></td><td><input type="number" name="auto_sell_stone_minRes"></td><td><input type="number" name="auto_sell_iron_minRes"></td></tr>\
<tr><td><span class="icon header premium"> </span> Maximum limit '+_temp30("sell","maxLimit")+'</td><td><input type="number" name="auto_sell_wood_maxLimit"></td><td><input type="number" name="auto_sell_stone_maxLimit"></td><td><input type="number" name="auto_sell_iron_maxLimit"></td></tr>\
<tr><td><span class="icon header ressources"> </span> Maximum nyers a faluban</td><td><input type="number" name="auto_sell_wood_maxRes"></td><td><input type="number" name="auto_sell_stone_maxRes"></td><td><input type="number" name="auto_sell_iron_maxRes"></td></tr>\
\
<tr style="border-top: 2px solid #F88"><td rowspan="4" style="text-align:center; border-right: 2px solid #F88">Nyersvásárlás '+_temp29('buy')+'</td><td><span class="icon header premium"> </span> Minimum limit '+_temp30("buy","minLimit")+'</td><td><input type="number" name="auto_buy_wood_minLimit"></td><td><input type="number" name="auto_buy_stone_minLimit"></td><td><input type="number" name="auto_buy_iron_minLimit"></td></tr>\
<tr><td><span class="icon header ressources"> </span> Minimum limit tartása</td><td><input type="number" name="auto_buy_wood_minRes"></td><td><input type="number" name="auto_buy_stone_minRes"></td><td><input type="number" name="auto_buy_iron_minRes"></td></tr>\
<tr><td><span class="icon header premium"> </span> Maximum limit '+_temp30("buy","maxLimit")+'</td><td><input type="number" name="auto_buy_wood_maxLimit"></td><td><input type="number" name="auto_buy_stone_maxLimit"></td><td><input type="number" name="auto_buy_iron_maxLimit"></td></tr>\
<tr><td><span class="icon header ressources"> </span> Maximum nyers a faluban</td><td><input type="number" name="auto_buy_wood_maxRes"></td><td><input type="number" name="auto_buy_stone_maxRes"></td><td><input type="number" name="auto_buy_iron_maxRes"></td></tr>\
</table>\
<div style="width:500px; text-align:center;margin:10px auto"><img src="/graphic/buildings/market.png"> Automata által meghagyott kereskedők: <input type="number" name="left_merch"></div></div>\
\
<h3 align="center" onclick="setTabVisibility(\'h3_3\', this)">Egyéb beállítások</h3>\
<div id="h3_3" style="display:none"><table class="vis" style="margin: auto; border-collapse: collapse;" id="tozsde_nyelv">\
<tr><th>Nyelvbeállítás</th><th><i>...a te nyelveden</i></th></tr>\
<tr><td>"Beérkező"</td><td><input name="nameOfBeerkezo"></td>\
<tr><td>"Elad"</td><td><input name="nameOfElad"></td>\
<tr><td>"Vásárolj"</td><td><input name="nameOfVasarolj"></td></tr></table>\
<p style="width: 350px;margin: 10px auto;text-align: center;"><input type="checkbox" onclick="setAgressiveRefresh(this)"> <strong>AGRESSZÍV FRISSÍTÉS</strong> (nem ajánlott)</p></div>\
<div style="width:800px; text-align:center;margin:10px auto"><button type="button" disabled onclick="saveTozsdeData()" id="tozsde_save">Hangbeállítások alkalmazása</button> <button type="button" onclick="loadData(); loadSoundData();">Visszaállítás</button> <button type="button" id="auto_save" onclick="saveAuto()">Automata beállításainak alkalmazása</button></div></form>\
<h3 align="center" class="openedH3" onclick="setTabVisibility(\'h3_4\', this)">Árfolyam alakulása</h3>\
<div id="h3_4"><table id="cnc_stats"><tr><th>Statisztika</th><th><span class="icon header wood"> </span></th><th><span class="icon header stone"> </span></th><th><span class="icon header iron"> </span></th><th><span class="icon header premium"> </span></th></tr>\
<tr><td>Legkisebb észlelt ár</td><td>0</td><td>0</td><td>0</td><td></td></tr>\
<tr><td>Legmagasabb észlelt ár</td><td>0</td><td>0</td><td>0</td><td></td></tr>\
<tr><td>Idő alapú átlag</td><td>-</td><td>-</td><td>-</td><td></td></tr>\
<tr><td>Automata által eladott</td> <td>0</td><td>0</td><td>0</td><td>0</td></tr>\
<tr><td>Automata által vásárolt</td><td>0</td><td>0</td><td>0</td><td>0</td></tr></table>\
<div id="allapot" style="background-color: #622; margin: auto; width: 690px; padding: 0 15px; color: white; height: 300px; overflow: auto;">\
<table><thead style="color: black"><tr><th rowspan="2" style="width: 60px">Dátum</th><th colspan="3" style="width: 200px">Arány 1 <span class="icon header premium"> </span> &LeftArrowRightArrow;</th><th colspan="3" style="width: 250px">Készlet</th><th rowspan="2" style="width:150px">Értesítés</th></tr>\
<tr><th class="header50" style="text-align: center"><span class="icon header wood"> </span></th><th class="header50"><span class="icon header stone"> </span></th><th class="header50"><span class="icon header iron"> </span></th>\
	<th class="header60"><span class="icon header wood"> </span></th><th class="header60"><span class="icon header stone"> </span></th><th class="header60"><span class="icon header iron"> </span></th></tr>\</thead>\
<tbody style="color: white"></tbody></table></div></div>';function _temp31(_a,_c){try {var _d=document.getElementById("allapot").getElementsByTagName("tbody")[0],_e=_d.insertRow(0),_f=_e.insertCell(0),_g;_f.innerHTML=_temp39(new Date());if(_c){_g=_e.insertCell(1);_g.setAttribute("colspan","7");_g.innerHTML=_a;_g.setAttribute("class",`item-${_c}`)}else{for(var i=1;i<4;i++){_g=_e.insertCell(i);_g.innerHTML=_temp(_a[2][i-1])+' '+_a[0][i-1]}for(var i=4;i<7;i++){_g=_e.insertCell(i);_g.innerHTML=_a[3][i-4]}_g=_e.insertCell(7);_g.innerHTML=_a[1].join("<br>")}function _temp(_temp2){switch(_temp2) {case '+':return'<font style="color: red">&mapstoup;</font>';case '-':return'<font style="color: #99F">&DownTeeArrow;</font>';case '=':return'<font style="color: white; opacity: 0.5">&LeftArrowRightArrow;</font>';default:return'?'}}} catch (e) {console.info('AddEvent error:',e)}}function _temp32(){y=!0;_temp31('BOT VÉDELEM AKTÍV! <a href="javascript:BotvedelemKi();" style="color: #66D;">Kattints ide a ha beírtad a kódot.</a>','info');_temp40('bot')}function _temp33(_d){try {if(_d.closed){c=1;return!1}if(_d.document.readyState!=="complete")return!1;if(_d.document.getElementById('bot_check')||_d.document.getElementById('popup_box_bot_protection')||_d.document.title=="Bot védelem"){_temp32();return!1}if(_d.document.location.href.indexOf("sid_wrong")>-1){_temp32();return!1}if(_d.document.location.href.indexOf("exchange")==-1){c=1;return!1}if(_d.document.getElementById("serverTime").innerHTML.length<4)return!1;if(!_d.PremiumExchange||!_d.document.getElementById("premium_exchange_form"))return!1;return!0} catch {return!1}return!1}function _temp34(){var x=document.getElementById('cnc_tozsde'),_d;var _e=['wood','stone','iron'];u={wood:{sell:{},buy:{}},stone:{sell:{},buy:{}},iron:{sell:{},buy:{}},left_merch:0};for(var j=0;j<_e.length;j++)for(var i=0;i<m.length;i++){_d=x['auto_sell_'+_e[j]+'_'+m[i]];u[_e[j]].sell[m[i]]=parseInt(_d.value,10)}for(var j=0;j<_e.length;j++)for(var i=0;i<n.length;i++){_d=x['auto_buy_'+_e[j]+'_'+n[i]];u[_e[j]].buy[n[i]]=parseInt(_d.value,10)}u.left_merch=parseInt(x['left_merch'].value,10);localStorage.setItem(`PF_tozsde_Auto${j}`,JSON.stringify(u));_temp36("auto_save")}function _temp35(){var _d=document.getElementById("cnc_tozsde");r={sound:{}};for(var i=0;i<k.length;i++){r[k[i]]=_d[k[i]].checked;r.sound[k[i]]=_d[k[i]+'_sound'].value};r.sound.bot=_d.bot_sound.value;for(var i=0;i<l.length;i++){l[i].indexOf("nameOf")==-1&&(_d[l[i]].value=_d[l[i]].value.replace(/\D/g,''));_d[l[i]].value==''&&(_d[l[i]].value=s[l[i]]);l[i].indexOf("nameOf")==-1?r[l[i]]=parseInt(_d[l[i]].value,10):r[l[i]]=_d[l[i]].value}localStorage.setItem(`PF_tozsde${j}`,JSON.stringify(r));_temp33(a)&&_temp44();_temp36("tozsde_save")}function _temp36(_d){var _e=document.getElementById(_d);_e.disabled=!0;_e.innerHTML=_e.innerHTML.replace("*","")}function _temp37(){try {r=JSON.parse(localStorage.getItem(`PF_tozsde${j}`))} catch {r=null}var _d=document.getElementById("cnc_tozsde");!r||r==null&&(r=JSON.parse(JSON.stringify(s)));for(var i=0;i<k.length;i++)_d[k[i]].checked=r[k[i]];for(var i=0;i<l.length;i++)_d[l[i]].value=r[l[i]]||s[l[i]];try {u=JSON.parse(localStorage.getItem(`PF_tozsde_Auto${j}`))} catch {u=null}if(!u||u==null)u={wood:{sell:{},buy:{}},stone:{sell:{},buy:{}},iron:{sell:{},buy:{}},left_merch:0};else{for(var i=0;i<m.length;i++){var a=m[i];_d[`auto_sell_wood_${a}`].value=u.wood.sell[a];_d[`auto_sell_stone_${a}`].value=u.stone.sell[a];_d[`auto_sell_iron_${a}`].value=u.iron.sell[a]}for(var i=0;i<n.length;i++){var a=n[i];_d[`auto_buy_wood_${a}`].value=u.wood.buy[a];_d[`auto_buy_stone_${a}`].value=u.stone.buy[a];_d[`auto_buy_iron_${a}`].value=u.iron.buy[a]}_d['left_merch'].value=u.left_merch||0;_temp34()}_temp36("tozsde_save");_temp36("auto_save")}function _temp38(){var i,j,_d=i.bot?i.bot.volume:1;!r.sound&&(r.sound=JSON.parse(JSON.stringify(s.sound)));var _e=document.getElementById("cnc_tozsde");for(j in k){i=k[j];_f(i)}_f('bot');_temp35();setTimeout(function _temp3(){var _temp4=!1;for(var i in i)i[i].readyState!==4&&(_temp4=!0,_temp31('&#9432; Probléma van a '+r.sound[i].split('.')[0]+' hang betöltésével. Használd a hang újrabetöltését vagy a lejátszás gombot.','info'));!_temp4&&_temp31('&#9432; Hangok sikeresen betölve.','info')},3000);function _f(i){!r.sound[i]&&(r.sound[i]=q);_e[`${i}_sound`].value=r.sound[i];i[i]=new Audio(p+r.sound[i]);i[i].volume=_d}}function _temp39(m){return ("0"+m.getHours()).slice(-2)+":"+("0"+m.getMinutes()).slice(-2)+":"+("0"+m.getSeconds()).slice(-2)}function _temp40(_f){try {i[_f].readyState==4?i[_f].play():i[_f].load()} catch (e) {console.error("HIBA::Playsound",e)}}function _temp41(_f,_g){var d=new Date(),_h=(d-o.lastStat)/60000;for(var i=0;i<3;i++){if(_f[i]<30)return;o.min[i]>_f[i]&&(o.min[i]=_f[i]);o.max[i]<_f[i]&&(o.max[i]=_f[i]);o.avg[i]=(o.avg[i]*o.avg[3]+_g[i]*_h)/(o.avg[3]+_h)}o.avg[3]+=_h;o.lastStat=d;_i();function _i(){var x=document.getElementById("cnc_stats");for(var i=0;i<3;i++){x.rows[1].cells[i+1].innerHTML=o.min[i];x.rows[2].cells[i+1].innerHTML=o.max[i];x.rows[3].cells[i+1].innerHTML=Math.round(o.avg[i])}}}function _temp42(_f,_g,_h,_i){var x=document.getElementById("cnc_stats"),_j=0;_g=="stone"&&(_j=1);_g=="iron"&&(_j=2);_f=="sell"?(o.autoSell[_j]+=_h,o.autoSell[3]+=_i):(o.autoBuy[_j]+=_h,o.autoBuy[3]+=_i);for(var i=0;i<4;i++){x.rows[4].cells[i+1].innerHTML=o.autoSell[i];x.rows[5].cells[i+1].innerHTML=o.autoBuy[i]}}function _temp43(e,r,_f,_g){if(_f=="sell")for(var i=63;i<2000;i++)if(_i(e,-i,r)<=-1)break;else for(var i=63;i<2000;i++)if(_i(e,i,r)>=1)break;var _h=a.PremiumExchange.data.capacity[e]-a.PremiumExchange.data.stock[e];if(_g&&_h>0&&_h<(i-1))return _h;return i-1;function _i(e,a,r){var t=a.PremiumExchange.data.capacity[e];return (1+a>=0?a.PremiumExchange.data.tax.buy:a.PremiumExchange.data.tax.sell)*(a.PremiumExchange.calculateMarginalPrice(r,t)+a.PremiumExchange.calculateMarginalPrice(r-a,t))*a/2}}function _temp44(){try {var _f=a.document.getElementById("premium_exchange_form").getElementsByTagName("table")[0],_g=[parseInt(_f.rows[2].cells[1].innerText,10)-parseInt(_f.rows[1].cells[1].innerText,10),parseInt(_f.rows[2].cells[2].innerText,10)-parseInt(_f.rows[1].cells[2].innerText,10),parseInt(_f.rows[2].cells[3].innerText,10)-parseInt(_f.rows[1].cells[3].innerText,10)],_h=a.PremiumExchange.data.merchants,_i=[a.game_data.village.wood,a.game_data.village.stone,a.game_data.village.iron];for(var i=0;i<_g.length;i++){_g[i]>_i[i]&&(_g[i]=_temp5(_i[i],i));_g[i]>(_h*1000)&&(_g[i]=_temp5(_h*1000,i))}if(!_f.classList.contains("cnc_transformed")){var _j=a.document.createElement("script");_j.innerHTML="function setValue(cellId, value) { $('#premium_exchange_sell_'+cellId+' input').val(value).keyup();	}\
							 function setNull(cellId)   { $('#premium_exchange_sell_'+cellId+' input, #premium_exchange_buy_'+cellId+' input').val('').keyup(); }\
							 function setSellValue(cellId, value) { $('#premium_exchange_buy_'+cellId+' input').val(value).keyup(); }";a.document.body.appendChild(_j);_f.rows[5].cells[1].style.position="relative";_f.rows[5].cells[2].style.position="relative";_f.rows[5].cells[3].style.position="relative";for(var i=0;i<3;i++){var _k='',_l=a.document.createElement("div");switch(i) {case 0:_k+='wood';break;case 1:_k+='stone';break;case 2:_k+='iron';break}_l.setAttribute("style","position: absolute; right: 0px; top: 20px;");_l.innerHTML='\
				<button type="button" onclick="setSellValue(\''+_k+'\','+_temp7(i)+')" style="background: #F66">A</button>\
				<button type="button" onclick="setValue(\''+_k+'\','+_temp6(i)+')">A</button><button type="button" onclick="setValue(\''+_k+'\','+_g[i]+')">Max</button><button type="button" style="background: linear-gradient(140deg, #eee 50%, #F66 51%,#F66 100%);" onclick="setNull(\''+_k+'\')">X</button>';list=_f.rows[5].cells[(i+1)].getElementsByClassName("cost-container")[0];list.insertBefore(_l,list.childNodes[i])}}else for(var i=0;i<3;i++){var _k='';switch(i) {case 0:_k+='wood';break;case 1:_k+='stone';break;case 2:_k+='iron';break}_f.rows[5].cells[(i+1)].getElementsByTagName("button")[0].setAttribute("onclick",'setSellValue("'+_k+'",'+_temp7(i)+')');_f.rows[5].cells[(i+1)].getElementsByTagName("button")[1].setAttribute("onclick",'setValue("'+_k+'",'+_temp6(i)+')');_f.rows[5].cells[(i+1)].getElementsByTagName("button")[2].setAttribute("onclick",'setValue("'+_k+'",'+_g[i]+')')}_f.classList.add("cnc_transformed");function _temp5(_temp8,_temp9){_temp9++;var _m=Math.floor(_temp8-(1/a.PremiumExchange.calculateMarginalPrice(parseInt(_f.rows[1].cells[_temp9].innerText,10)+_temp8,parseInt(_f.rows[2].cells[_temp9].innerText,10))));return _m<0?0:_m}function _temp6(_temp10){var _temp11=0,_m,_n=_h*1000;_n>_i[_temp10]&&(_n=_i[_temp10]);switch(_temp10) {case 0:_temp10="wood";_temp11=r.min_wood;break;case 1:_temp10="stone";_temp11=r.min_stone;break;case 2:_temp10="iron";_temp11=r.min_iron;break}var _o=a.PremiumExchange.data.stock[_temp10],_p=0;do{_m=_temp43(_temp10,_o,"sell");_p+=Math.floor(_m);_o+=Math.floor(_m)}while (Math.round(_m)<=_temp11&&_p<=_n)_p-=Math.floor(_m);return Math.floor(_p)}function _temp7(_m){var _n;switch(_m) {case 0:_m="wood";_n=r.max_wood;break;case 1:_m="stone";_n=r.max_stone;break;case 2:_m="iron";_n=r.max_iron;break}var _o=a.PremiumExchange.data.stock[_m],_p;do{_p=_temp43(_m,_o,"buy");_q+=Math.floor(_p);_o-=Math.floor(_p)}while (Math.floor(_p)>=_n)_q-=Math.floor(_p);return Math.floor(0)}} catch (e) {console.error(e)}}function _temp45(_m,_n,_o,_p){try {var _q=a.game_data.village[_o],_r,_s=a.document.getElementById("market_status_bar").getElementsByTagName("table");if(_s.length>1){_s=_s[1].rows[0].cells;if(_s[0].innerText.indexOf(r.nameOfBeerkezo)>-1){_s=$(_s[0]).find('>span');for(var i=0;i<_s.length;i++)if(_s[i].getAttribute("class")=='nowrap'&&_s[i].getElementsByTagName("span")[0].getAttribute("class").indexOf(_o)>-1){_q+=parseInt(_s[i].innerText.replace(".",""));break}}}if(_p=='sell'&&v[_o].sell){_r=u[_o].sell;if(_m>_r.maxLimit||(a.PremiumExchange.data.merchants-u.left_merch)*1000<_n+_m||a.game_data.village[_o]<_n+_m||_r.minRes>(_q-_n-_m)||a.PremiumExchange.data.capacity[_o]>=a.PremiumExchange.data.stock[_o])return!1;if(a.PremiumExchange.data.capacity[_o]<a.PremiumExchange.data.stock[_o]+_n+_m){if(!_n)return a.PremiumExchange.data.capacity[_o]-(a.PremiumExchange.data.stock[_o]+_n);return!1}if(_m<_r.minLimit)return!0;if(_q-_n>_r.minRes+((_m-_r.minLimit)*((_r.maxRes-_r.minRes)/(_r.maxLimit-_r.minLimit))))return!0;return!1}if(_p=='buy'&&v[_o].buy){_r=u[_o].buy;if(_m<_r.minLimit||a.PremiumExchange.data.stock[_o]<_n+_m||_r.maxRes<=(_q+_n+_m))return!1;if(_m>=_r.maxLimit)return _r.maxRes>_q+_n+_m;if(_q+_n<=_r.minRes+((_m-_r.minLimit)*((_r.maxRes-_r.minRes)/(_r.maxLimit-_r.minLimit))))return!0;return!1}return!1} catch (e) {console.error(e);return!1}}function _temp46(){w={inProgress:!1,startProgress:new Date(),mode:'',type:'',ppValue:0,sellValue:0,minMaxPrice:0,isError:!1,lastSuccess:new Date()};e=0;a.location.reload()}function _temp47(){var _m,_n,_o=['wood','stone','iron'],_p;if(w.inProgress&&w.isError){var _q=parseInt(a.document.getElementById("premium_exchange_form")[w.mode+'_'+w.type].value,10);_q-=(w.minMaxPrice*1.1);if(isNaN(_q)||_q<=0){_temp46();return}a.document.getElementById("premium_exchange_form")[mode+'_'+type].value=_q;a.$('#premium_exchange_form .btn.btn-premium-exchange-buy').click()}else for(var i=0;i<_o.length;i++){_n=a.PremiumExchange.data.stock[_o[i]];_m=_temp43(_o[i],_n,"sell",!0);_p=_temp45(_m,0,_o[i],'sell');if(_p){_r(_o[i],'sell',_m);return}if(typeof _p=="number"&&_p>0){_r(_o[i],'sell',_p);return}_m=_temp43(_o[i],_n,"buy");if(_temp45(_m,0,_o[i],'buy')){_r(_o[i],'buy',_m);return}}function _r(_temp12,_temp13,_temp14){var _temp15=_temp14,_temp16=0,_temp17,_s=!0;while (_s) {typeof _s=="number"?_temp16+=_s:_temp16+=_temp15;_temp17=_temp15;_temp15=_temp43(_temp12,_temp13=='sell'?a.PremiumExchange.data.stock[_temp12]+_temp16:a.PremiumExchange.data.stock[_temp12]-_temp16,_temp13);_s=_temp45(_temp15,_temp16,_temp12,_temp13)}if(!_temp16)return;w.inProgress=!0;w.startProgress=new Date();w.mode=_temp13;w.type=_temp12;w.minMaxPrice=_temp17;a.document.getElementById("premium_exchange_form")[_temp13+'_'+_temp12].value=Math.floor(_temp16);a.$('#premium_exchange_form .btn.btn-premium-exchange-buy').click();e=1}}function _temp48(){if(a.document.getElementById("premium_exchange")==null||a.document.getElementById("fader").style.display=='none'){new Date()-w.startProgress<5000?a.$('#premium_exchange_form .btn.btn-premium-exchange-buy').click():console.info('WTF-error: Nem jelenik meg a lightbox');return}var _s=a.document.getElementById("confirmation-msg").getElementsByTagName("table")[0].rows[1].cells[1].innerText.match(/\d+/g);_s[0]=parseInt(_s[0],10);_s[1]=parseInt(_s[1],10);switch(w.mode) {case 'sell':if(w.minMaxPrice<(_s[0]/_s[1])*0.97){console.info('Hiba, végső ár nem jó',(_s[0]/_s[1])*0.97,w.minMaxPrice);_temp46();return}break;case 'buy':if(w.minMaxPrice>(_s[0]/_s[1])*1.03){console.info('Hiba, végső ár nem jó',(_s[0]/_s[1])*1.03,w.minMaxPrice);_temp46();return}break}w.sellValue=_s[0];w.ppValue=_s[1];a.document.getElementById("premium_exchange").getElementsByClassName("btn-confirm-yes")[0].click();e=2}function _temp49(){var _s=a.document.getElementById("confirmation-msg");if(a.document.getElementById("fader").style.display=='none'){_temp31('Automata '+!1?'eladás':'vásárlás'+': '+w.sellValue+'<span class="icon header '+w.type+'"> </span> &LeftArrowRightArrow; '+w.ppValue+'<span class="icon header premium"> </span> (Átlagár: '+Math.round(w.sellValue/w.ppValue)+')',w.mode);_temp42(w.mode,w.type,w.sellValue,w.ppValue);e=0;r.autotrans&&_temp40('autotrans');_temp46();w.lastSuccess=new Date()} else if(_s.getElementsByClassName("error").length>0){w.isError=!0;a.document.getElementById("premium_exchange").getElementsByClassName("btn-confirm-no")[0].click();console.info("Error, nem teljesíthető a parancs mert ",_s.getElementById("confirmation-msg").innerHTML);a.location.reload();e=0}else _s.getElementsByClassName("warn").length>0?_temp48():w.isError=!1}function _temp50(_s){if(f)switch(_s) {case 'open':document.getElementById("tozsde_iframe").src=z;a=document.getElementById("tozsde_iframe").contentWindow;break}else switch(_s) {case 'open':a=window.open(z,`PF_tozsde_${j}`);break}}function _temp51(){try {var _s=a.document.getElementById("confirmation-msg"),_t='',_u=!1;if(_s&&_s!==null){_s.classList.contains("cnc_transformed")?_u=!0:_s.classList.add("cnc_transformed");var _v=_s.getElementsByTagName("table")[0].rows[1].cells[1],_w=_v.innerText.match(/\d+/g);_w=Math.round(parseInt(_w[0],10)/parseInt(_w[1],10));_v.innerText.indexOf(r.nameOfElad)>-1&&_v.getElementsByTagName("img")[0].src.indexOf('wood')>-1&&_w<=r.min_wood||_v.getElementsByTagName("img")[0].src.indexOf('stone')>-1&&_w<=r.min_stone||_v.getElementsByTagName("img")[0].src.indexOf('iron')>-1&&_w<=r.min_iron?_t='✔':_t='X';_v.innerText.indexOf(r.nameOfVasarolj)>-1&&_v.getElementsByTagName("img")[0].src.indexOf('wood')>-1&&_w>=r.max_wood||_v.getElementsByTagName("img")[0].src.indexOf('stone')>-1&&_w>=r.max_stone||_v.getElementsByTagName("img")[0].src.indexOf('iron')>-1&&_w>=r.max_iron?_t='✔':_t='X';!_u&&(_s.getElementsByTagName("p")[0].innerHTML+='<br><b>Arány: 1 pp = '+_w+' nyers '+_t+'</b>');return _w}return null} catch (e) {console.error(e)}}function _temp52(){try {var _s=!1,_t='',_u=[parseInt(a.document.getElementById("premium_exchange_rate_wood").innerText.match(/\d+/g)[0],10),parseInt(a.document.getElementById("premium_exchange_rate_stone").innerText.match(/\d+/g)[0],10),parseInt(a.document.getElementById("premium_exchange_rate_iron").innerText.match(/\d+/g)[0],10)],_v=a.document.getElementById("incomings_amount")?parseInt(a.document.getElementById("incomings_amount").innerHTML,10):0,_x=[],_y=!1,_z=['wood','stone','iron'],_temp55=a.document.getElementById("premium_exchange_form").getElementsByTagName("table")[0],_temp56=1+a.PremiumExchange.data.tax.buy,_temp57=[];if(r.newMail&&a.document.getElementById("menu_mail_count").innerHTML.match(/\d+/g)){var _w=a.document.getElementById("menu_mail_count").innerHTML.match(/\d+/g)[0];g<_w&&(_temp40("newMail"),_temp31(`<span class="icon header new_mail" style="height:16px"> </span> Új üzeneted érkezett (${_w})`,'info'));g=_w}else g=0;x<_v&&r.newAttack&&(_temp40("newAttack"),_temp31(`<img src="/graphic/buildings/barracks.png"> Bejövő támadások száma ${_v}-re emelkedett`,'incoming-warning'));x=_v;if(_u[0]<10)return;new Date()-t.lastChange>300000&&(c=1,t.lastChange=new Date());!a.document.getElementById("premium_exchange_form").getElementsByTagName("table")[0].classList.contains("cnc_transformed")&&(_temp44(),_s=!0);if(t.lastResult[0]==_u[0]&&t.lastResult[1]==_u[1]&&t.lastResult[2]==_u[2])return;t.lastChange=new Date();_temp41(_u,t.lastResult);for(var k=0;k<_z.length;k++)a.document.getElementById("premium_exchange_rate_"+_z[k]).style.background='#f4e4bc';if(r.minimum&&(r.min_wood>_u[0]*_temp56||r.min_stone>_u[1]*_temp56||r.min_iron>_u[2]*_temp56)){_x.push('Limit alatti ár');_t='minimum';_y=!0;for(var k=0;k<_z.length;k++)r['min_'+_z[k]]>_u[k]*_temp56&&(a.document.getElementById("premium_exchange_rate_"+_z[k]).style.background='#9bF')}_temp56=1+a.PremiumExchange.data.tax.sell;if(r.maximum&&(r.max_wood<_u[0]*_temp56||r.max_stone<_u[1]*_temp56||r.max_iron<_u[2]*_temp56)){_x.push('Limit feletti ár');_t='maximum';for(var k=0;k<_z.length;k++)r['max_'+_z[k]]<_u[k]*_temp56&&(a.document.getElementById("premium_exchange_rate_"+_z[k]).style.background='#F66')}r.any&&(parseInt(_temp55.rows[2].cells[1].innerText,10)!==parseInt(_temp55.rows[1].cells[1].innerText,10)||parseInt(_temp55.rows[2].cells[2].innerText,10)!==parseInt(_temp55.rows[1].cells[2].innerText,10)||parseInt(_temp55.rows[2].cells[3].innerText,10)!==parseInt(_temp55.rows[1].cells[3].innerText,10))&&(_x.push('Nyers ELADHATÓ'),_t='any',_y=!0);r.keszlet&&(parseInt(_temp55.rows[1].cells[1].innerText,10)>r.keszlet_wood||parseInt(_temp55.rows[1].cells[2].innerText,10)>r.keszlet_stone||parseInt(_temp55.rows[1].cells[3].innerText,10)>r.keszlet_iron)&&(_x.push('Készleten'),_t='keszlet');r.action&&(r.action_wood<(1-(_u[0]/t.lastResult[0]))*100||r.action_stone<(1-(_u[1]/t.lastResult[1]))*100||r.action_iron<(1-(_u[2]/t.lastResult[2]))*100)&&(_x.push('Árzuhanás'),_t='action',_y=!0);r.some&&(a.PremiumExchange.data.capacity.wood==a.PremiumExchange.data.stock.wood||a.PremiumExchange.data.capacity.stone==a.PremiumExchange.data.stock.stone||a.PremiumExchange.data.capacity.iron==a.PremiumExchange.data.stock.iron)&&(_x.push('Nyers TELÍTETT'),_t='some');for(var i=0;i<3;i++)if(t.lastResult[i]<_u[i])_temp57.push('+');else t.lastResult[i]>_u[i]?_temp57.push('-'):_temp57.push('=');t.lastResult=_u.slice(0);t.lastChange=new Date();!_s&&_temp44();_temp31([_u,_x,_temp57,[_temp55.rows[1].cells[1].innerText,_temp55.rows[1].cells[2].innerText,_temp55.rows[1].cells[3].innerText]]);_x.length>0&&t.hangSzunet<new Date()&&!(t.noSoundIf&&_y&&a.PremiumExchange.data.merchants<1)&&_temp40(_t)} catch (e) {c=1;console.error(e)}}function _temp53(){try {next=200;if(!y)switch(c) {case 1:d=0;_temp50('open');c=2;next=1333;break;case 2:if(_temp33(a)){d=0;_temp52();_temp51();_temp54();if(t.agressiveRefresh)if(!e&&!1){a.location.reload();t.agressiveRefreshTime=0}else t.agressiveRefreshTime++}else{next=1000;d++;d>6&&(c=1)}break}} catch (e) {console.error(e)}try {_temp26.postMessage(next)} catch (e) {console.error(e);setTimeout(function(){_temp53()},next)}}function _temp54(){try {switch(e) {case 0:new Date()-w.lastSuccess>3333&&_temp47();break;case 1:_temp48();break;case 2:_temp49();e=0;break}} catch (e) {console.error(e);_temp46()}}_temp37();_temp53();_temp38();window.onbeforeunload=()=>!0;UI.InfoMessage("<b>PF Tőzsde</b><br><br>Automata beállítás letiltva: hasnzálatáért bann jár");$('#h3_2').on('change','input:not([type="checkbox"])',function(){var _s=document.getElementById("auto_save");_s.disabled!==!1&&(_s.disabled=!1,_s.innerHTML=_s.innerHTML+'*')});$('#h3_1 input, #h3_1 select, #h3_3 input:not([type="checkbox"])').on('change',function(){var _s=document.getElementById("tozsde_save");_s.disabled!==!1&&(_s.disabled=!1,_s.innerHTML='*'+_s.innerHTML)});for(const _s of document.getElementById('h3_2').querySelectorAll('input'))_s.disabled=!0;
